import{r as s,c as H,c4 as ye,d as G,j as e,B as i,dT as je,dU as j,dV as Ce,dW as we}from"./index-CNh2Ysd7.js";import{D as Se,E as Te}from"./DataTable-CBDiE-I1.js";import{D as Ae}from"./Delete-BKL8mfiA.js";import{I as Ne}from"./Info-BLOe8JuO.js";import{V as Ie}from"./Visibility-CFK2wX7e.js";import{C as J}from"./Close-CSWdanUp.js";import{S as Z}from"./SweetAlert-DUVT9XWx.js";import{A as Q}from"./Alert-BBsTbpkb.js";import{T as be}from"./ToggleSwitch-CRLgVpk1.js";import{I as $}from"./InputField-Cac7SuVh.js";import{B as q}from"./Button-D2SEshHa.js";import{T as d}from"./Typography-DxP0RQcB.js";import{I as F}from"./AlertTitle-BBXxFqxI.js";import{T as W}from"./Tooltip-B4POfKz-.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./Dialog-CMeqEyOr.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./Chip--RBU-Z22.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";const ve=({editData:C,isEditMode:A,onCancel:r})=>{const[l,N]=s.useState(C||{_id:"",name:"",phone:"",categories:[],cityName:"",cityId:"",categoryId:""}),I=H(),[c,b]=s.useState(null),[m,L]=s.useState(""),[w,f]=s.useState(!1),[v,D]=s.useState(""),[M,y]=s.useState(0),[k,V]=s.useState(10);s.useEffect(()=>{I(ye({search:v,page:M,limit:k}))},[I,v,M,k]);const{CityMaster:B}=G(o=>o.CityMaster),S=o=>{const{name:E,value:P}=o.target;N({...l,[E]:P})},R=async()=>{try{if(A&&(C!=null&&C._id)){const o={name:l.name,phone:l.phone,cityId:l.cityId,categoryId:[l.categoryId]};await I(je({_id:C._id,...o})).unwrap(),b("success"),L("Buyer Profile updated successfully"),f(!0),r(),I(j({search:"",page:0,limit:10}))}}catch(o){b("error"),L("Failed: "+o.message),f(!0)}setTimeout(()=>f(!1),3e3)};return e.jsxs(e.Fragment,{children:[w&&c&&e.jsx("div",{className:"p-4",children:e.jsx(Q,{type:c,title:c==="success"?"Success!":c==="error"&&m.toLowerCase().includes("deleted")?"Deleted!":c==="error"?"Error!":"Warning!",message:m,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)})}),e.jsxs(i,{className:"max-w-8xl mx-auto bg-white shadow-md rounded-xl mb-6",children:[e.jsxs(i,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(d,{className:"font-outfit",variant:"h6",children:A?"Edit Buyer Details":"Add Buyer"}),e.jsx(F,{sx:{color:"white"},onClick:r,children:e.jsx(J,{})})]}),e.jsxs(i,{px:6,py:4,children:[A&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx($,{label:"Name",name:"name",value:l.name,onChange:S,className:"font-outfit"}),e.jsx($,{label:"Phone",name:"phone",value:l.phone,onChange:S,className:"font-outfit"}),e.jsxs(i,{className:"flex flex-col w-full",children:[e.jsxs("label",{className:"text-sm text-gray-600 dark:text-white mb-1 block",children:["City ",e.jsx("span",{className:"text-error-500",children:" * "})]}),e.jsxs("select",{name:"cityId",value:l.cityId,onChange:S,className:"mt-1 p-2 border rounded w-full",children:[e.jsx("option",{value:"",children:"Select City"}),B==null?void 0:B.filter(o=>o.isActive).map(o=>e.jsx("option",{value:o._id,children:o.city_name},o._id))]})]})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[e.jsx(q,{onClick:R,children:A?"Update":"Create User"}),e.jsx(q,{variant:"secondary",onClick:r,children:"Cancel"})]})]})]})]})},De=()=>{var Y;const[C,A]=s.useState({_id:"",name:"",phone:"",productLeadsCount:"",dealerLeadsCount:"",createdAt:"",categories:[]}),[r,l]=s.useState(null),[N,I]=s.useState(""),[c,b]=s.useState(0),[m,L]=s.useState(10),[w,f]=s.useState(null),[v,D]=s.useState(""),[M,y]=s.useState(!1),[k,V]=s.useState(null),[B,S]=s.useState(!1),[R,o]=s.useState(!1),[E,P]=s.useState(null),[X,O]=s.useState(!1),[ke,ee]=s.useState(0),[T,K]=s.useState(null),[te,U]=s.useState(!1),[h,se]=s.useState(""),[p,ae]=s.useState(""),[_,re]=s.useState([]),g=H(),{BuyerManagement:oe,totalItems:ne}=G(t=>t.BuyerManagement);s.useEffect(()=>{const t=setTimeout(()=>{const a={};_.forEach(({id:x,value:n})=>{n&&(x==="isActive"?a[x]=n==="Active":typeof n=="string"&&n.trim()?a[x]=n.trim():a[x]=n)}),g(j({search:N,page:c,limit:m,filters:a}))},500);return()=>clearTimeout(t)},[N,c,m,_,h,p]);const z=s.useRef(null),ie=t=>{re(t),b(0);const a={};t.forEach(({id:n,value:u})=>{u&&(n==="isActive"?a[n]=u==="Active":typeof u=="string"&&u.trim()?a[n]=u.trim():a[n]=u)});const x={filters:a,fromDate:h,toDate:p,page:0,limit:m};z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{g(j(x))},500)},le=async(t,a)=>{I(t),b(0),a&&await g(j({fromDate:h,toDate:p,search:t,exportType:a}))},ce=(t,a)=>{A(t),P(a),o(!0)},ue=t=>{l(t),O(!0),ee(0)},de=t=>{V(t),S(!0)},me=async()=>{if(k){try{await g(we(k)).unwrap(),f("error"),D("Buyer deleted successfully."),y(!0),g(j({search:N,page:c,limit:m}))}catch(t){f("error"),D("Delete failed: "+t),y(!0)}setTimeout(()=>y(!1),3e3),S(!1),V(null)}},fe=()=>{S(!1),V(null)},he=t=>{K(t),U(!0)},pe=async()=>{if(T){try{await g(Ce({_id:T._id,isActive:!T.isActive})).unwrap(),f("success"),D(`Buyer ${T.isActive?"deactivated":"activated"} successfully.`),y(!0),g(j({search:N,page:c,limit:m}))}catch(t){f("error"),D("Status toggle failed: "+t),y(!0)}setTimeout(()=>y(!1),3e3),U(!1),K(null)}},ge=()=>{U(!1),K(null)};s.useEffect(()=>{if(h&&!p||!h&&p)return;g(j({fromDate:h||void 0,toDate:p||void 0}))},[h,p]);const xe=[{accessorKey:"name",header:"Buyer Name",filterVariant:"text"},{accessorKey:"phone",header:"Mobile No",filterVariant:"text"},{accessorKey:"cityName",header:"City",filterVariant:"text",Cell:({cell:t})=>{const a=t.getValue()||"";return a.charAt(0).toUpperCase()+a.slice(1)}},{accessorKey:"isActive",header:"Account Status",Cell:({cell:t})=>t.getValue()?"Active":"Inactive",filterVariant:"select",filterSelectOptions:["Active","Inactive"]},{accessorKey:"createdAt",header:"Registration Date",Cell:({cell:t})=>{const a=t.getValue();return new Date(a).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}},{accessorKey:"updatedAt",header:"Last Updated",Cell:({cell:t})=>{const a=t.getValue();return new Date(a).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}},{header:"Actions",Cell:({row:t})=>(H(),e.jsxs(i,{display:"flex",gap:1,children:[e.jsx(W,{title:"View Details",arrow:!0,children:e.jsx(F,{color:"primary",onClick:()=>ue(t.original),children:e.jsx(Ie,{})})}),e.jsx(W,{title:"Edit Buyer",arrow:!0,children:e.jsx(F,{color:"secondary",onClick:()=>ce(t.original,t.index),children:e.jsx(Te,{})})}),e.jsx(F,{color:"error",onClick:()=>de(t.original._id),children:e.jsx(Ae,{})}),e.jsx(be,{checked:t.original.isActive,onChange:()=>he(t.original),tooltipTitle:t.original.isActive?"Deactivate":"Activate"})]}))}];return e.jsxs(e.Fragment,{children:[e.jsx(Z,{show:te,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${T!=null&&T.isActive?"deactivate":"activate"} this Buyer?`,onConfirm:pe,onCancel:ge,confirmText:"Yes",cancelText:"No"}),e.jsx(Z,{show:B,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this buyer?",onConfirm:me,onCancel:fe,confirmText:"Yes",cancelText:"No"}),M&&w&&e.jsx("div",{className:"p-4",children:e.jsx(Q,{type:w,title:w==="success"?"Success!":w==="error"&&v.toLowerCase().includes("deleted")?"Deleted!":w==="error"?"Error!":"Warning!",message:v,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>y(!1)})}),R?e.jsx(ve,{onCancel:()=>{setTimeout(()=>{o(!1),P(null)},2e3)},editData:E!==null?C:void 0,isEditMode:E!==null}):X&&r?e.jsxs(i,{className:"max-w-8xl mx-auto rounded-xl shadow-md mb-6",sx:{backgroundColor:"white"},children:[e.jsxs(i,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(d,{className:"font-outfit",variant:"h6",children:"Buyer Details"}),e.jsx(F,{sx:{color:"white"},onClick:()=>{O(!1),l(null)},children:e.jsx(J,{})})]}),e.jsx(i,{px:4,py:4,children:e.jsxs(i,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Name:"})," ",r.name]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Mobile No:"})," ",r.phone]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"City:"})," ",r!=null&&r.cityName?r.cityName.charAt(0).toUpperCase()+r.cityName.slice(1):"N/A"]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Product Leads:"})," ",r.productLeadsCount||"N/A"]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Registration Date:"})," ",new Date(r.createdAt).toLocaleDateString("en-IN")]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Dealer Leads:"})," ",r.dealerLeadsCount||"N/A"]}),e.jsxs(d,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Interested Categories:"})," ",(Y=r==null?void 0:r.categories)!=null&&Y.filter(t=>t.isLookingFor).length?r.categories.filter(t=>t.isLookingFor).map(t=>t.categoryName).join(", "):"N/A"]})]})})]}):e.jsxs(i,{children:[e.jsx(i,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(i,{ml:2,children:e.jsxs(d,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Buyer Management  ",e.jsx(W,{title:"View and manage buyer profiles, and update buyer details as needed.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(Ne,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})})}),e.jsx(Se,{exportType:!0,clickHandler:le,data:oe,columns:xe,enableColumnFilters:!0,columnFilters:_,onColumnFiltersChange:ie,rowCount:ne,pageIndex:c,pageSize:m,onPaginationChange:({pageIndex:t,pageSize:a})=>{b(t),L(a);const x={};_.forEach(({id:n,value:u})=>{u&&(x[n]=n==="isActive"?u==="Active":u)}),g(j({filters:x,fromDate:h,toDate:p,page:t,limit:a}))},fromDate:h,toDate:p,onFromDateChange:se,onToDateChange:ae})]})]})},it=()=>e.jsx(e.Fragment,{children:e.jsx(De,{})});export{it as default};
