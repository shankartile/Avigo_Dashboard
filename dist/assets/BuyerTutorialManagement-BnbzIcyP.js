import{r as l,c as Pe,d as Be,eg as C,j as e,B as m,eh as Ee,ei as Re,ej as Ue,ek as We}from"./index-CNh2Ysd7.js";import{I as Le}from"./Info-BLOe8JuO.js";import{P as X}from"./Preview-Bk0MjplR.js";import{A as ze}from"./Add-ONoAddvh.js";import{D as Ve}from"./Delete-BKL8mfiA.js";import{V as Oe}from"./Visibility-CFK2wX7e.js";import{C as P}from"./Close-CSWdanUp.js";import{D as $e,E as He}from"./DataTable-CBDiE-I1.js";import{I as ee}from"./InputField-Cac7SuVh.js";import{B}from"./Button-D2SEshHa.js";import{T as qe}from"./ToggleSwitch-CRLgVpk1.js";import{A as te}from"./Alert-BBsTbpkb.js";import{S as ie}from"./SweetAlert-DUVT9XWx.js";import{F as se}from"./FileInput-Dq-H8wev.js";import{R as le}from"./Radio-CzH1ihw6.js";import{T as Ke}from"./TextArea-DupqjNb0.js";import{v as Ye}from"./imageValidator-hDY72bsR.js";import{D as E,a as R}from"./Dialog-CMeqEyOr.js";import{D as ae}from"./DialogTitle-sP3uGIgc.js";import{I as h}from"./AlertTitle-BBXxFqxI.js";import{T as y}from"./Typography-DxP0RQcB.js";import{T as U}from"./Tooltip-B4POfKz-.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./Chip--RBU-Z22.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";import"./AddPhotoAlternate-DoEGX89n.js";const Ze=()=>{var Q,G;const[i,f]=l.useState({id:"",isFullImage:!1,thumbnail_image:null,title:"",sub_title:"",full_image:null,description:""}),[r,W]=l.useState(null),[I,w]=l.useState(null),[F,v]=l.useState(!1),[T,N]=l.useState(null),[n,o]=l.useState(null),[S,c]=l.useState(""),[L,a]=l.useState(!1),[z,d]=l.useState(!1),[V,D]=l.useState(null),[re,M]=l.useState(!1),[_,ne]=l.useState(""),[x,O]=l.useState(0),[j,oe]=l.useState(10),[$,H]=l.useState(null),[ce,k]=l.useState(!1),[b,q]=l.useState(null),[ue,A]=l.useState(!1),[me,de]=l.useState({description:""}),u=Pe(),{BuyerTutorialManagement:ge=[],totalItems:pe}=Be(t=>t.Buyertutorialmanagement),he=ge.map(t=>({...t,id:t._id}));l.useEffect(()=>{const t=setTimeout(()=>{u(C({search:_,page:x,limit:j}))},500);return()=>clearTimeout(t)},[_,x,j]);const fe=(t,s)=>{if(t==="description"){if(!s.trim())return`${t} is required`;if(!/[a-zA-Z]/.test(s))return`${t} must contain words, not just numbers`;if(s.trim().length<10)return`${t} should be at least 10 characters long`}return""},xe=()=>/[a-zA-Z]/.test(i.description)&&i.description.trim().length>=10,K=t=>{const{name:s,value:g}=t.target;f(p=>({...p,[s]:g}))},je=t=>{const{name:s,value:g}=t.target;f(p=>({...p,[s]:g})),de(p=>({...p,[s]:fe(s,g)}))},be=i.isFullImage?i.full_image!==null:i.title.trim()!==""&&xe()&&i.sub_title.trim()!==""&&i.description.trim()!==""&&i.thumbnail_image!==null,ye=async()=>{if(!F){v(!0);try{const t={isFullImage:i.isFullImage,full_image:i.full_image,thumbnail_image:i.thumbnail_image,title:i.title,sub_title:i.sub_title,description:i.description},s=await u(We(t)).unwrap();o("success"),c("Tutorial Added successfully."),a(!0),setTimeout(()=>a(!1),3e3),u(C({search:_,page:x,limit:j})),d(!1)}catch(t){o("error"),c("Failed to add Tutorial : "+t),a(!0),setTimeout(()=>a(!1),3e3)}finally{v(!1)}}},Te=async(t,s)=>{try{f({id:t._id||"",isFullImage:t.isFullImage??!1,thumbnail_image:t.thumbnail_image??null,title:t.title??"",sub_title:t.sub_title??"",full_image:t.full_image??null,description:t.description??""}),N(s),d(!0)}catch{o("error"),c("Unable to fetch Tutorial details for editing."),a(!0)}},_e=async()=>{if(!F){v(!0);try{const t={_id:i.id,isFullImage:i.isFullImage,full_image:i.full_image,thumbnail_image:i.thumbnail_image,title:i.title,sub_title:i.sub_title,description:i.description};typeof t.thumbnail_image=="object"&&t.thumbnail_image instanceof File||t.thumbnail_image;const s=await u(Ue(t)).unwrap();o("success"),c("Tutorial updated successfully."),a(!0),setTimeout(()=>a(!1),3e3),d(!1),N(null),u(C({search:_,page:x,limit:j}))}catch{o("error"),c("Failed to update Tutorial : "),a(!0),setTimeout(()=>a(!1),3e3)}finally{v(!1)}}},Ce=t=>{D(t),M(!0)},Ie=async()=>{if(V){try{await u(Re(V)).unwrap(),o("error"),c("Tutorial deleted successfully."),a(!0),setTimeout(()=>a(!1),3e3),u(C({search:_,page:x,limit:j}))}catch(t){o("error"),c("Delete failed: "+t),a(!0),setTimeout(()=>a(!1),3e3)}M(!1),D(null)}},we=()=>{M(!1),D(null)},Fe=t=>{W(t)},Y=()=>{W(null),d(!1)},Z=async t=>{var J;const s=(J=t.target.files)==null?void 0:J[0],g=t.target.name;if(!s)return;const p=await Ye(s,"buyerTutorial",g);if(p){w(p);return}f(Me=>({...Me,[g]:s})),w(null)},ve=t=>{ne(t),O(0)},Se=t=>{q(t),A(!0)},ke=async()=>{if(b)try{await u(Ee({_id:b._id,isActive:!b.isActive})).unwrap(),o("success"),c(`Tutorial ${b.isActive?"deactivated":"activated"} successfully.`),a(!0),setTimeout(()=>a(!1),3e3),u(C({search:_,page:x,limit:j})),A(!1)}catch(t){const s=t;o("error"),c(s.message),a(!0),A(!1),setTimeout(()=>a(!1),6e3)}},Ae=()=>{A(!1),q(null)},Ne=(t,s=50)=>t.length>s?t.slice(0,s)+"...":t,De=[{accessorFn:t=>t.title||"N/A",id:"title",header:"Title"},{accessorFn:t=>t.sub_title||"N/A",id:"sub_title",header:"Sub Title"},{accessorKey:"description",header:"Description",Cell:({row:t})=>Ne(t.original.description||"N/A",30)},{accessorKey:"isFullImage",header:"Type",Cell:({cell:t})=>t.getValue()?"Full Image":"Image with Details"},{header:"Actions",Cell:({row:t})=>(t.original,e.jsxs(m,{display:"flex",gap:1,children:[e.jsx(U,{title:"View Tutorial",arrow:!0,children:e.jsx(h,{color:"primary",onClick:()=>Fe(t.original),children:e.jsx(Oe,{})})}),e.jsx(U,{title:"Edit Tutorial",arrow:!0,children:e.jsx(h,{color:"secondary",onClick:()=>Te(t.original,t.index),children:e.jsx(He,{})})}),e.jsx(h,{color:"error",onClick:()=>Ce(t.original._id),children:e.jsx(Ve,{})}),e.jsx(qe,{checked:t.original.isActive,onChange:()=>Se(t.original),tooltipTitle:t.original.isActive?"Deactivate":"Activate"})]}))}];return e.jsxs(e.Fragment,{children:[e.jsx(ie,{show:ue,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${b!=null&&b.isActive?"deactivate":"activate"} this tutorial?`,onConfirm:ke,onCancel:Ae,confirmText:"Yes",cancelText:"No"}),e.jsx(ie,{show:re,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this Tutorial ?",onConfirm:Ie,onCancel:we,confirmText:"Yes",cancelText:"No"}),L&&n&&e.jsx("div",{className:"p-4",children:e.jsx(te,{type:n,title:n==="success"?"Success!":n==="error"&&S.toLowerCase().includes("deleted")?"Deleted!":n==="error"?"Error!":"Warning!",message:S,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>a(!1)})}),e.jsxs(E,{open:ce,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ae,{className:"font-outfit",children:"Image Preview"}),e.jsxs(R,{children:[$&&e.jsx("img",{src:$,alt:"Preview",style:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:12}}),e.jsx(h,{sx:{position:"absolute",top:12,right:12},onClick:()=>k(!1),children:e.jsx(P,{})})]})]}),z?e.jsxs(E,{open:z,onClose:(t,s)=>{s!=="backdropClick"&&d(!1)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:[e.jsxs(m,{sx:{background:"linear-gradient( #255593 103.05%)",height:25,p:4,position:"relative"},children:[e.jsx(ae,{className:"font-outfit",sx:{color:"white",position:"absolute",top:5},children:T!==null?"Edit Buyer Tutorial":"Add Buyer Tutorial"}),e.jsx(h,{sx:{position:"absolute",top:12,right:12,color:"white"},onClick:()=>{d(!1),w(null)},children:e.jsx(P,{})})]}),e.jsxs(R,{children:[L&&n&&e.jsx("div",{className:"mb-4",children:e.jsx(te,{type:n,title:n==="success"?"Success!":n==="error"&&S.toLowerCase().includes("deleted")?"Deleted!":n==="error"?"Error!":"Warning!",message:S,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>a(!1)})}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(le,{id:"fullImage",name:"imageType",checked:i.isFullImage===!0,label:"Full Image",value:"true",onChange:t=>f(s=>({...s,isFullImage:t==="true"}))}),e.jsx(le,{id:"imageWithDetails",name:"imageType",checked:i.isFullImage===!1,label:"Image with details",value:"false",onChange:t=>f(s=>({...s,isFullImage:t==="true"}))})]}),i.isFullImage?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-4",children:["Add Full Image",e.jsx("span",{className:"text-error-500",children:" *  (Image resolution should be 1440×3040px)"})]}),e.jsx(se,{id:"full_image",name:"full_image",onChange:Z}),T!==null&&i.full_image&&e.jsx("span",{className:"text-xs text-gray-500 mb-1 ms-2",children:typeof i.full_image=="string"?i.full_image.split("/").pop():(Q=i.full_image)==null?void 0:Q.name}),I&&e.jsx("span",{className:"text-xs text-error-500",children:I})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{name:"title",value:i.title,label:"Title",onChange:K}),e.jsx(ee,{name:"sub_title",value:i.sub_title,label:"Sub-Title",onChange:K}),e.jsx(Ke,{label:"Description",name:"description",value:i.description,onChange:je,errorMessage:me.description}),e.jsxs("label",{className:"text-sm text-gray-600 mb-4",children:["Add Thumbnail Image",e.jsx("span",{className:"text-error-500",children:" * (Image resolution should be 1080×1200px)"})]}),e.jsx(se,{id:"thumbnail_image",name:"thumbnail_image",onChange:Z}),T!==null&&i.thumbnail_image&&e.jsx("span",{className:"text-xs text-gray-500 mb-1 ms-2",children:typeof i.thumbnail_image=="string"?i.thumbnail_image.split("/").pop():(G=i.thumbnail_image)==null?void 0:G.name}),I&&e.jsx("span",{className:"text-xs text-error-500",children:I})]})]}),e.jsxs(m,{display:"flex",justifyContent:"center",gap:6,mt:4,children:[e.jsx(B,{onClick:T!==null?_e:ye,className:"rounded-[25px]",disabled:!be||F,children:F?T!==null?"Updating...":"Submitting...":T!==null?"Update":"Submit"}),e.jsx(B,{variant:"secondary",onClick:()=>{d(!1),w(null)},className:"rounded-[25px]",children:"Cancel"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(m,{ml:2,children:e.jsxs(y,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Buyer Tutorial Management  ",e.jsx(U,{title:"Manage buyer app tutorial screens by adding new tutorials, deactivating old ones, and configuring up to five active images in full-image or image-with-details format.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(Le,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})}),e.jsxs(B,{onClick:()=>{f({id:"",isFullImage:!1,thumbnail_image:null,title:"",sub_title:"",full_image:null,description:""}),N(null),d(!0)},children:[e.jsx(ze,{}),"Add New Tutorial "]})]}),e.jsx($e,{clickHandler:ve,data:he,columns:De,rowCount:pe,pageIndex:x,pageSize:j,onPaginationChange:({pageIndex:t,pageSize:s})=>{O(t),oe(s)}})]}),e.jsx(E,{open:!!r,onClose:Y,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(m,{className:"rounded-xl overflow-hidden",children:[e.jsxs(m,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(y,{className:"font-outfit",variant:"h6",children:"Tutorial Details"}),e.jsx(h,{sx:{color:"white"},onClick:Y,children:e.jsx(P,{})})]}),e.jsx(R,{children:r&&e.jsx(m,{display:"flex",flexDirection:"column",gap:2,children:r.isFullImage?e.jsx(e.Fragment,{children:e.jsxs(y,{className:"font-outfit",display:"flex",alignItems:"center",gap:1,children:[e.jsx("strong",{children:"Full Image:"}),r.full_image&&e.jsx(h,{onClick:()=>{const t=typeof r.full_image=="string"?r.full_image:r.full_image?URL.createObjectURL(r.full_image):"";H(t),k(!0)},children:e.jsx(X,{color:"primary"})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{className:"font-outfit",children:[e.jsx("strong",{children:"Title:"})," ",r.title]}),e.jsxs(y,{className:"font-outfit",children:[e.jsx("strong",{children:"Sub Title:"})," ",r.sub_title]}),e.jsxs(y,{className:"font-outfit",children:[e.jsx("strong",{children:"Description:"})," ",r.description]}),e.jsxs(m,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(y,{className:"font-outfit",children:e.jsx("strong",{children:"Thumbnail Image:"})}),r.thumbnail_image&&e.jsx(h,{onClick:()=>{const t=typeof r.thumbnail_image=="string"?r.thumbnail_image:r.thumbnail_image?URL.createObjectURL(r.thumbnail_image):"";H(t),k(!0)},children:e.jsx(X,{color:"primary"})})]})]})})})]})})]})},Mt=()=>e.jsx(e.Fragment,{children:e.jsx(Ze,{})});export{Mt as default};
