import{r as i,c as Se,d as ke,c4 as N,c5 as Ae,c6 as Ie,j as e,B as g,c7 as De,c8 as Me,c9 as Ee,ca as Fe}from"./index-CcNgdVLz.js";import{P as Pe}from"./Preview-D_xkNagw.js";import{A as Ue}from"./Add-CQx2oSmS.js";import{V as We}from"./Visibility-Bad1pPYX.js";import{C as W}from"./Close-eApB0hKv.js";import{D as Le,E as Be}from"./DataTable-DIxG5frN.js";import{I as Ve}from"./InputField-BQ5ewBIw.js";import{B as L}from"./Button-B4_V5GRV.js";import{T as Re}from"./ToggleSwitch-CZt8XOld.js";import{A as te}from"./Alert-U3gIVFWt.js";import{S as se}from"./SweetAlert-BfCzCAJa.js";import{F as He}from"./FileInput-0b2TfJ3P.js";import{v as $e}from"./imageValidator-hDY72bsR.js";import{D as B,a as V}from"./Dialog-BdfS6Lfy.js";import{D as ae}from"./DialogTitle-BbPUlM9A.js";import{I as w}from"./AlertTitle-C4QpKbd8.js";import{T as C}from"./Typography-BMOygWke.js";import{T as ie}from"./Tooltip-C-v54PpA.js";import"./createSvgIcon-ClJPFlmG.js";import"./Cancel-CkCQy-6N.js";import"./utils-BtYGnpaM.js";import"./index-CLpR2HuM.js";import"./DateTimeField-CYfYG2Su.js";import"./index-D3LyqDt4.js";import"./useSlotProps-z1QAC-gu.js";import"./CircularProgress-CVM8C023.js";import"./Chip-YFG14ne-.js";import"./dividerClasses-Bv38dMpn.js";import"./Pagination-DR3bn4wR.js";import"./Divider-BePmc644.js";import"./Tabs-CWf6flOX.js";import"./skeleton-DjwwWlQi.js";import"./AddPhotoAlternate-DTvCWNdQ.js";const ze=()=>{var Q,X,Z,ee;const[a,S]=i.useState({country_id:"",state_id:"",country_name:"",id:"",state_name:"",city_name:"",image:""}),[n,R]=i.useState(null),[H,k]=i.useState(null),[$,re]=i.useState(null),[ne,D]=i.useState(!1),[A,M]=i.useState(null),[m,p]=i.useState(null),[I,h]=i.useState(""),[z,r]=i.useState(!1),[O,f]=i.useState(!1),[Oe,Ke]=i.useState(!1),[K,Y]=i.useState(null),[le,q]=i.useState(!1),[u,oe]=i.useState(""),[o,G]=i.useState(0),[x,ce]=i.useState(10),[y,E]=i.useState(null),[de,F]=i.useState(!1),[_,P]=i.useState(!1),c=Se(),{StateMaster:v,CountryMaster:b,CityMaster:me=[],totalItems:ue}=ke(t=>t.CityMaster),xe=me.map(t=>({...t,id:t._id}));i.useEffect(()=>{const t=setTimeout(()=>{c(N({search:u,page:o,limit:x}))},500);return()=>clearTimeout(t)},[u,o,x]),i.useEffect(()=>{const t=setTimeout(()=>{c(Ae({search:u,page:o,limit:x}))},500);return()=>clearTimeout(t)},[u,o,x]),i.useEffect(()=>{const t=setTimeout(()=>{c(Ie({search:u,page:o}))},500);return()=>clearTimeout(t)},[u,o,x]);const U=t=>{const{name:s,value:d}=t.target;S(j=>{if(s==="state_id"){const l=v.find(T=>T._id===d);return{...j,state_id:d,state_name:l?l.state_name:""}}if(s==="country_id"){const l=b.find(T=>T._id===d);return{...j,country_id:d,country_name:l?l.country_name:""}}return{...j,[s]:d}})},pe=async t=>{var l;const s=(l=t.target.files)==null?void 0:l[0],d=t.target.name;if(!s)return;const j=await $e(s,"citymaster",d);if(j){k(j);return}S(T=>({...T,[d]:s})),k(null)},he=(((Q=a.country_id)==null?void 0:Q.trim())??"")!==""&&(((X=a.state_id)==null?void 0:X.trim())??"")!==""&&(((Z=a.city_name)==null?void 0:Z.trim())??"")!=="",fe=async()=>{try{const t=b.find(l=>l._id===a.country_id),s=v.find(l=>l._id===a.state_id),d={istopcities:_?"true":"false",country_id:a.country_id||"",country_name:(t==null?void 0:t.country_name)||"",state_id:(s==null?void 0:s._id)||"",state_name:(s==null?void 0:s.state_name)||"",city_name:a.city_name||"",image:_&&a.image||""},j=await c(Fe(d)).unwrap();p("success"),h("City Added successfully."),r(!0),setTimeout(()=>r(!1),3e3),c(N({search:u,page:o,limit:x})),f(!1)}catch(t){p("error"),h(`${t}`),r(!0),setTimeout(()=>r(!1),3e3)}},ge=async(t,s)=>{try{S({id:t._id||"",country_id:t.country_id||"",country_name:t.country_name||"",state_id:t.state_id||"",state_name:t.state_name||"",city_name:t.city_name||"",image:t.image||""}),P(!!t.istopcities),M(s),f(!0)}catch{p("error"),h("Unable to fetch city details for editing."),r(!0)}},ye=async()=>{try{const t={_id:a.id,country_id:a.country_id||"",country_name:a.country_name||"",state_id:a.state_id||"",state_name:a.state_name||"",city_name:a.city_name||"",istopcities:_?"true":"false",image:_&&a.image||""},s=await c(Ee(t)).unwrap();p("success"),h("City updated successfully."),r(!0),setTimeout(()=>r(!1),3e3),f(!1),M(null),c(N({search:u,page:o,limit:x}))}catch(t){p("error"),h(`${t}`),r(!0),setTimeout(()=>r(!1),3e3)}},je=async()=>{if(K){try{await c(Me(K)).unwrap(),p("error"),h("City deleted successfully."),r(!0),setTimeout(()=>r(!1),3e3),c(N({search:u,page:o,limit:x}))}catch(t){p("error"),h("Delete failed: "+t),r(!0),setTimeout(()=>r(!1),3e3)}q(!1),Y(null)}},Ce=()=>{q(!1),Y(null)},_e=t=>{E(t),F(!0)},we=async()=>{if(y){try{await c(De({_id:y._id,isActive:!y.isActive})).unwrap(),p("success"),h(`City ${y.isActive?"deactivated":"activated"} successfully.`),r(!0),c(N({search:u,page:o,limit:x}))}catch(t){p("error"),h("Status toggle failed: "+t),r(!0)}setTimeout(()=>r(!1),3e3),F(!1),E(null)}},ve=()=>{F(!1),E(null)},be=t=>{R(t)},J=()=>{R(null),f(!1)},Te=t=>{oe(t),G(0)},Ne=[{accessorKey:"city_name",header:"City Name",Cell:({cell:t})=>{const s=t.getValue()||"";return s.charAt(0).toUpperCase()+s.slice(1)}},{accessorKey:"state_name",header:"State Name",Cell:({cell:t})=>{const s=t.getValue()||"";return s.charAt(0).toUpperCase()+s.slice(1)}},{header:"Actions",Cell:({row:t})=>e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(ie,{title:"View Details",children:e.jsx(w,{color:"primary",onClick:()=>be(t.original),children:e.jsx(We,{})})}),e.jsx(ie,{title:"Edit City",children:e.jsx(w,{color:"secondary",onClick:()=>ge(t.original,t.index),children:e.jsx(Be,{})})}),e.jsx(Re,{checked:t.original.isActive,onChange:()=>_e(t.original),tooltipTitle:t.original.isActive?"Deactivate":"Activate"})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(se,{show:de,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${y!=null&&y.isActive?"deactivate":"activate"} this City?`,onConfirm:we,onCancel:ve,confirmText:"Yes",cancelText:"No"}),e.jsx(se,{show:le,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this Country?",onConfirm:je,onCancel:Ce,confirmText:"Yes",cancelText:"No"}),z&&m&&e.jsx("div",{className:"p-4",children:e.jsx(te,{type:m,title:m==="success"?"Success!":m==="error"&&I.toLowerCase().includes("deleted")?"Deleted!":m==="error"?"Error!":"Warning!",message:I,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>r(!1)})}),e.jsxs(B,{open:ne,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ae,{className:"font-outfit",children:"Image Preview"}),e.jsxs(V,{children:[$&&e.jsx("img",{src:$,alt:"Preview",style:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:12}}),e.jsx(w,{sx:{position:"absolute",top:12,right:12},onClick:()=>D(!1),children:e.jsx(W,{})})]})]}),O?e.jsxs(B,{open:O,onClose:(t,s)=>{s!=="backdropClick"&&f(!1)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:[e.jsxs(g,{sx:{background:"linear-gradient( #255593 103.05%)",height:25,p:4,position:"relative"},children:[e.jsx(ae,{className:"font-outfit",sx:{color:"white",position:"absolute",top:5},children:A!==null?"Edit City":"Add City"}),e.jsx(w,{sx:{position:"absolute",top:12,right:12,color:"white"},onClick:()=>{f(!1),k(null)},children:e.jsx(W,{})})]}),e.jsxs(V,{children:[z&&m&&e.jsx("div",{className:"mb-4",children:e.jsx(te,{type:m,title:m==="success"?"Success!":m==="error"&&I.toLowerCase().includes("deleted")?"Deleted!":m==="error"?"Error!":"Warning!",message:I,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>r(!1)})}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm text-gray-600 dark:text-white mb-1 block",children:["Country ",e.jsx("span",{className:"text-error-500",children:" * "})]}),e.jsxs("select",{name:"country_id",value:a.country_id,onChange:U,className:"mt-1 p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select Country"}),b==null?void 0:b.filter(t=>t.isActive).map(t=>e.jsx("option",{value:t._id,children:t.country_name},t._id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm text-gray-600 dark:text-white mb-1 block",children:["State ",e.jsx("span",{className:"text-error-500",children:" * "})]}),e.jsxs("select",{name:"state_id",value:a.state_id,onChange:U,className:"mt-1 p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select State"}),v==null?void 0:v.filter(t=>t.isActive).map(t=>e.jsx("option",{value:t._id,children:t.state_name},t._id))]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ve,{label:"City",name:"city_name",value:a.city_name,onChange:U})}),e.jsxs("div",{className:"flex items-center mt-14",children:[e.jsx("input",{type:"checkbox",id:"isTopCity",checked:_,onChange:t=>P(t.target.checked),className:"mr-2"}),e.jsx("label",{htmlFor:"isTopCity",className:"text-sm text-gray-700 dark:text-white",children:"Mark as Top City"})]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-4",children:["Add Image ",e.jsx("span",{className:"text-error-500",children:"(Image resolution should be 550Ã—385px)"})]}),e.jsx(He,{id:"image",name:"image",onChange:pe}),A!==null&&a.image&&e.jsx("span",{className:"text-xs text-gray-500 mb-1 ms-2",children:typeof a.image=="string"?a.image.split("/").pop():(ee=a.image)==null?void 0:ee.name}),H&&e.jsx("span",{className:"text-xs text-error-500",children:H})]})]}),e.jsxs(g,{display:"flex",justifyContent:"center",gap:6,mt:4,children:[e.jsx(L,{onClick:A!==null?ye:fe,className:"rounded-[25px]",disabled:!he,children:A!==null?"Update City":"Add City"}),e.jsx(L,{variant:"secondary",onClick:()=>{f(!1),k(null)},className:"rounded-[25px]",children:"Cancel"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(g,{ml:2,children:e.jsx(C,{variant:"h5",fontWeight:500,className:"font-outfit",children:"City Management"})}),e.jsxs(L,{onClick:()=>{S({id:"",state_name:"",image:""}),M(null),f(!0),P(!1)},children:[e.jsx(Ue,{}),"Add New City"]})]}),e.jsx(Le,{clickHandler:Te,data:xe,columns:Ne,rowCount:ue,pageIndex:o,pageSize:x,onPaginationChange:({pageIndex:t,pageSize:s})=>{G(t),ce(s)}})]}),e.jsx(B,{open:!!n,onClose:J,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(g,{className:"rounded-xl overflow-hidden",children:[e.jsxs(g,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(C,{className:"font-outfit",variant:"h6",children:"City Details"}),e.jsx(w,{sx:{color:"white"},onClick:J,children:e.jsx(W,{})})]}),e.jsx(V,{children:n&&e.jsxs(g,{display:"flex",flexDirection:"column",gap:2,children:[e.jsxs(C,{className:"font-outfit",children:[e.jsx("strong",{children:"Country:"})," ",n.country_name]}),e.jsxs(C,{className:"font-outfit",children:[e.jsx("strong",{children:"State:"})," ",n.state_name]}),e.jsxs(C,{className:"font-outfit",children:[e.jsx("strong",{children:"City:"})," ",n!=null&&n.city_name?n.city_name.charAt(0).toUpperCase()+n.city_name.slice(1):"N/A"]}),e.jsxs(C,{className:"font-outfit",display:"flex",alignItems:"center",gap:1,children:[e.jsx("strong",{children:"Full Image:"}),n.image?e.jsx(w,{onClick:()=>{const t=typeof n.image=="string"?n.image:n.image?URL.createObjectURL(n.image):"N/A";re(t),D(!0)},children:e.jsx(Pe,{color:"primary"})}):e.jsx(C,{className:"font-outfit",children:" N/A"})]})]})})]})})]})},Nt=()=>e.jsx(e.Fragment,{children:e.jsx(ze,{})});export{Nt as default};
