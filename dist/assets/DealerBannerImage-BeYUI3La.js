import{r as s,c as we,d as Ce,eq as f,j as e,B as j,er as Se,es as Ie,et as Te,eu as ve}from"./index-CNh2Ysd7.js";import{I as De}from"./Info-BLOe8JuO.js";import{A as ke}from"./Add-ONoAddvh.js";import{D as Ae}from"./Delete-BKL8mfiA.js";import{V as Be}from"./Visibility-CFK2wX7e.js";import{C as F}from"./Close-CSWdanUp.js";import{D as Fe,E as Ne}from"./DataTable-CBDiE-I1.js";import{B as N}from"./Button-D2SEshHa.js";import{T as Pe}from"./ToggleSwitch-CRLgVpk1.js";import{A as G}from"./Alert-BBsTbpkb.js";import{S as J}from"./SweetAlert-DUVT9XWx.js";import{F as Ee}from"./FileInput-Dq-H8wev.js";import{v as Me}from"./imageValidator-hDY72bsR.js";import{D as P,a as E}from"./Dialog-CMeqEyOr.js";import{D as M}from"./DialogTitle-sP3uGIgc.js";import{I as h}from"./AlertTitle-BBXxFqxI.js";import{T as We}from"./Typography-DxP0RQcB.js";import{T as W}from"./Tooltip-B4POfKz-.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./Chip--RBU-Z22.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";import"./AddPhotoAlternate-DoEGX89n.js";const Le=()=>{var q;const[c,v]=s.useState({id:"",image:null}),[K,L]=s.useState(null),[U,y]=s.useState(null),[b,w]=s.useState(!1),[x,D]=s.useState(null),[i,l]=s.useState(null),[C,o]=s.useState(""),[R,a]=s.useState(!1),[_,d]=s.useState(!1),[z,k]=s.useState(null),[Q,A]=s.useState(!1),[p,X]=s.useState(""),[u,H]=s.useState(0),[m,Z]=s.useState(10),[S,ee]=s.useState(null),[te,O]=s.useState(!1),[g,I]=s.useState(null),[ae,T]=s.useState(!1),n=we(),{DealerBannerImage:se=[],totalItems:re}=Ce(t=>t.DealerBanner),ie=se.map(t=>({...t,id:t._id}));s.useEffect(()=>{n(f({search:p,page:u,limit:m}))},[p,u,m]);const ne=c.image!==null,le=async()=>{if(!b){w(!0);try{const t={image:c.image},r=await n(ve(t)).unwrap();l("success"),o("Dealer banner Added successfully."),a(!0),setTimeout(()=>a(!1),3e3),n(f({search:p,page:u,limit:m})),d(!1)}catch(t){l("error"),o("Failed to add dealer banner : "+t),a(!0),setTimeout(()=>a(!1),3e3)}finally{w(!1)}}},oe=async(t,r)=>{try{v({id:t._id||"",image:t.image??null}),D(r),d(!0)}catch{l("error"),o("Unable to fetch dealer banner details for editing."),a(!0)}},ce=async()=>{if(!b){w(!0);try{const t={_id:c.id,image:c.image};typeof t.image=="object"&&t.image instanceof File||t.image;const r=await n(Te(t)).unwrap();l("success"),o("Dealer banner updated successfully."),a(!0),setTimeout(()=>a(!1),3e3),d(!1),D(null),n(f({search:p,page:u,limit:m}))}catch{l("error"),o("Failed to update dealer banner : "),a(!0),setTimeout(()=>a(!1),3e3)}finally{w(!1)}}},de=t=>{k(t),A(!0)},me=async()=>{if(z){try{await n(Ie(z)).unwrap(),l("error"),o("Dealer banner deleted successfully."),a(!0),setTimeout(()=>a(!1),3e3),n(f({search:p,page:u,limit:m}))}catch(t){l("error"),o("Delete failed: "+t),a(!0),setTimeout(()=>a(!1),3e3)}A(!1),k(null)}},ue=()=>{A(!1),k(null)},ge=t=>{const r=typeof t.image=="string"?t.image:t.image?URL.createObjectURL(t.image):null;ee(r),L(t)},V=()=>{L(null),d(!1)},pe=async t=>{var $;const r=($=t.target.files)==null?void 0:$[0],B=t.target.name;if(!r)return;const Y=await Me(r,"dealerBanner",B);if(Y){y(Y);return}v(be=>({...be,[B]:r})),y(null)},fe=t=>{X(t),H(0),n(f({search:t,page:1,limit:m}))},he=t=>{I(t),T(!0)},xe=async()=>{if(g){try{await n(Se({_id:g._id,isActive:!g.isActive})).unwrap(),l("success"),o(`Banner ${g.isActive?"deactivated":"activated"} successfully.`),a(!0),setTimeout(()=>a(!1),3e3),T(!1),I(null),n(f({search:p,page:u,limit:m}))}catch(t){l("error"),o("Status toggle failed: "+t),a(!0)}setTimeout(()=>a(!1),3e3),T(!1),I(null)}},je=()=>{T(!1),I(null)},ye=[{header:"Image",accessorFn:t=>t.image||"N/A",Cell:({row:t})=>e.jsx("img",{src:t.original.image,alt:"Banner",style:{width:100,height:60,objectFit:"cover",borderRadius:8}})},{header:"Actions",Cell:({row:t})=>(t.original,e.jsxs(j,{display:"flex",gap:1,children:[e.jsx(W,{title:"Preview Image",arrow:!0,children:e.jsx(h,{color:"primary",onClick:()=>ge(t.original),children:e.jsx(Be,{})})}),e.jsx(W,{title:"Edit Banner",arrow:!0,children:e.jsx(h,{color:"secondary",onClick:()=>oe(t.original,t.index),children:e.jsx(Ne,{})})}),e.jsx(h,{color:"error",onClick:()=>de(t.original._id),children:e.jsx(Ae,{})}),e.jsx(Pe,{checked:t.original.isActive,onChange:()=>he(t.original),tooltipTitle:t.original.isActive?"Deactivate":"Activate"})]}))}];return e.jsxs(e.Fragment,{children:[e.jsx(J,{show:ae,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${g!=null&&g.isActive?"deactivate":"activate"} this banner?`,onConfirm:xe,onCancel:je,confirmText:"Yes",cancelText:"No"}),e.jsx(J,{show:Q,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this dealerbanner ?",onConfirm:me,onCancel:ue,confirmText:"Yes",cancelText:"No"}),R&&i&&e.jsx("div",{className:"p-4",children:e.jsx(G,{type:i,title:i==="success"?"Success!":i==="error"&&C.toLowerCase().includes("deleted")?"Deleted!":i==="error"?"Error!":"Warning!",message:C,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>a(!1)})}),e.jsxs(P,{open:te,onClose:()=>O(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{className:"font-outfit",children:"Image Preview"}),e.jsxs(E,{children:[S&&e.jsx("img",{src:S,alt:"Preview",style:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:12}}),e.jsx(h,{sx:{position:"absolute",top:12,right:12,color:"white"},onClick:()=>O(!1),children:e.jsx(F,{})})]})]}),_?e.jsxs(P,{open:_,onClose:(t,r)=>{r!=="backdropClick"&&d(!1)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:[e.jsxs(j,{sx:{background:"linear-gradient( #255593 103.05%)",height:25,p:4,position:"relative"},children:[e.jsx(M,{className:"font-outfit",sx:{color:"white",position:"absolute",top:5},children:x!==null?"Edit Banner":"Add Banner"}),e.jsx(h,{sx:{position:"absolute",top:12,right:12,color:"white"},onClick:()=>{d(!1),y(null)},children:e.jsx(F,{})})]}),e.jsxs(E,{children:[R&&i&&e.jsx("div",{className:"mb-4",children:e.jsx(G,{type:i,title:i==="success"?"Success!":i==="error"&&C.toLowerCase().includes("deleted")?"Deleted!":i==="error"?"Error!":"Warning!",message:C,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>a(!1)})}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-1 gap-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-4",children:["Add Banner Image",e.jsx("span",{className:"text-error-500",children:" *  (Image resolution should be 1440Ã—540px) "})]}),e.jsx(Ee,{id:"image",name:"image",onChange:pe}),x!==null&&c.image&&e.jsx("span",{className:"text-xs text-gray-500 mb-1 ms-2",children:typeof c.image=="string"?c.image.split("/").pop():(q=c.image)==null?void 0:q.name}),U&&e.jsx("span",{className:"text-xs text-error-500",children:U})]}),e.jsxs(j,{display:"flex",justifyContent:"center",gap:6,mt:4,children:[e.jsx(N,{onClick:x!==null?ce:le,className:"rounded-[25px]",disabled:!ne||b,children:b?x!==null?"Updating...":"Submitting...":x!==null?"Update":"Submit"}),e.jsx(N,{variant:"secondary",onClick:()=>{d(!1),y(null)},className:"rounded-[25px]",children:"Cancel"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(j,{ml:2,children:e.jsxs(We,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Dealer Banner Images  ",e.jsx(W,{title:"Manage banner images for the Dealer App, including adding new and updating existing banners.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(De,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})}),e.jsxs(N,{onClick:()=>{v({id:"",image:null}),D(null),d(!0)},children:[e.jsx(ke,{}),"Add New Banner "]})]}),e.jsx(Fe,{clickHandler:fe,data:ie,columns:ye,rowCount:re,pageIndex:u,pageSize:m,onPaginationChange:({pageIndex:t,pageSize:r})=>{H(t),Z(r)}})]}),e.jsxs(P,{open:!!K,onClose:V,maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{className:"font-outfit",children:"Image Preview"}),e.jsxs(E,{children:[S&&e.jsx("img",{src:S,alt:"Preview",style:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:12}}),e.jsx(h,{sx:{position:"absolute",top:12,right:12},onClick:V,children:e.jsx(F,{})})]})]})]})},xt=()=>e.jsx(e.Fragment,{children:e.jsx(Le,{})});export{xt as default};
