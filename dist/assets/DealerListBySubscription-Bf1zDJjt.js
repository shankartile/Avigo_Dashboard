import{c as _,dH as K,r as n,d as w,eS as p,j as c,B as L,aI as N}from"./index-CcNgdVLz.js";import{D as B}from"./DataTable-DIxG5frN.js";import{P as R}from"./PictureAsPdf-BWh0P8Xv.js";import{T as U}from"./Typography-BMOygWke.js";import{C}from"./Chip-YFG14ne-.js";import"./createSvgIcon-ClJPFlmG.js";import"./Cancel-CkCQy-6N.js";import"./utils-BtYGnpaM.js";import"./Close-eApB0hKv.js";import"./index-CLpR2HuM.js";import"./Tooltip-C-v54PpA.js";import"./useSlotProps-z1QAC-gu.js";import"./AlertTitle-C4QpKbd8.js";import"./CircularProgress-CVM8C023.js";import"./DateTimeField-CYfYG2Su.js";import"./index-D3LyqDt4.js";import"./Dialog-BdfS6Lfy.js";import"./dividerClasses-Bv38dMpn.js";import"./Pagination-DR3bn4wR.js";import"./DialogTitle-BbPUlM9A.js";import"./Divider-BePmc644.js";import"./Tabs-CWf6flOX.js";import"./skeleton-DjwwWlQi.js";const V=()=>{const l=_(),{id:m}=K(),[S,x]=n.useState(""),[d,h]=n.useState(0),[u,b]=n.useState(10),[o,A]=n.useState(""),[i,P]=n.useState(""),[f,v]=n.useState([]),[k,z]=n.useState(""),{dealerList:E=[],dealerTotalItems:F=0}=w(e=>e.Subscription);n.useEffect(()=>{if(m){const e={};f.forEach(({id:t,value:r})=>{r&&(t==="isActive"?e[t]=r==="Active":typeof r=="string"&&r.trim()?e[t]=r.trim():e[t]=r)}),l(p({subscriptionId:m,page:d,limit:u,search:S,fromDate:o,toDate:i,filters:e}))}},[l,m,d,u,S,o,i,f]);const g=n.useRef(null),I=e=>{v(e),h(0);const t={};e.forEach(({id:a,value:s})=>{s&&(a==="isActive"?t[a]=s==="Active":typeof s=="string"&&s.trim()?t[a]=s.trim():t[a]=s)});const r={subscriptionId:m,filters:t,fromDate:o,toDate:i,page:d,limit:u};g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{l(p(r))},500)},T=async(e,t)=>{x(e),h(0),t&&await l(p({subscriptionId:m,fromDate:o,toDate:i,search:e,exportType:t}))};n.useEffect(()=>{if(o&&!i||!o&&i)return;l(p({fromDate:o||void 0,toDate:i||void 0}))},[o,i]);const j=[{accessorKey:"dealer_id.name",header:"Dealer Name",id:"dealerName"},{accessorKey:"dealer_id.email",header:"Email",id:"dealerEmail"},{accessorKey:"dealer_id.phone",header:"Phone",id:"dealerPhone"},{accessorKey:"listings_used",header:"Listings Used",Cell:({cell:e})=>c.jsx(C,{className:"font-outfit",label:e.getValue(),color:"secondary"})},{accessorKey:"start_date",header:"Start Date",Cell:({cell:e})=>{const t=e.getValue();return new Date(t).toLocaleDateString("en-IN")}},{accessorKey:"end_date",header:"End Date",Cell:({cell:e})=>{const t=e.getValue();return new Date(t).toLocaleDateString("en-IN")}},{header:"Status",accessorKey:"isActive",Cell:({row:e})=>{const t=e.original.isActive;return c.jsx(C,{label:t?"Active":"Expired",color:t?"success":"error",size:"small",sx:{fontWeight:500,fontFamily:"Outfit"}})},filterVariant:"select",filterSelectOptions:["Active","Expired"]},{accessorKey:"invoice_url",header:"Invoice",Cell:({row:e})=>{const t=e.original,r=async()=>{var a,s;try{const D=(s=(a=(await N.post(`/dealer/dealerSubscriptionRoute/generate-invoice/${t._id}`)).data)==null?void 0:a.data)==null?void 0:s.invoiceUrl;D?window.open(D,"_blank"):console.error("Invoice URL not found")}catch(y){console.error("Error generating invoice",y)}};return c.jsx(R,{color:t.isActive?"primary":"error",style:{cursor:"pointer"},onClick:r})}}];return c.jsxs(L,{className:"p-4",children:[c.jsx(U,{className:"font-outfit",fontWeight:500,variant:"h5",mb:2,children:"Dealers Subscribed to This Plan"}),c.jsx(B,{exportType:!0,clickHandler:T,data:E,columns:j,rowCount:F,enableColumnFilters:!0,columnFilters:f,onColumnFiltersChange:I,pageIndex:d,pageSize:u,fromDate:o,toDate:i,onFromDateChange:A,onToDateChange:P,onPaginationChange:({pageIndex:e,pageSize:t})=>{h(e),b(t);const r={};f.forEach(({id:a,value:s})=>{s&&(r[a]=a==="isActive"?s==="Active":s)}),l(p({filters:r,fromDate:o,toDate:i,page:e,limit:t}))}})]})},pe=()=>c.jsx(c.Fragment,{children:c.jsx(V,{})});export{pe as default};
