import{r as n,c as de,d as ne,dA as ke,j as e,B as T,dB as Be,dC as Ue,dD as A,a as Ve,dE as Ee,dF as Le,dG as Me}from"./index-N8t8oMzR.js";import{D as Re,E as De}from"./DataTable-BqUD-dAi.js";import{D as Ke}from"./Delete-07TAjR17.js";import{V as pe}from"./Visibility-CgGAKN6P.js";import{C as re}from"./Close-CwR_quIe.js";import{S as ce}from"./SweetAlert-vzLgp13W.js";import{A as fe}from"./Alert-CgNUKTJk.js";import{T as We}from"./ToggleSwitch-DR4b514_.js";import{A as ze}from"./AddPhotoAlternate-DwefdB9m.js";import{I as p}from"./InputField-riaj6edy.js";import{B as ue}from"./Button-CBNcrDpD.js";import{D as he,a as ge}from"./Dialog-BGF2t3L7.js";import{D as xe}from"./DialogTitle-D6DEKDqS.js";import{I as L}from"./AlertTitle-D9ejxV9_.js";import{T as J}from"./Typography-CKlLxaDL.js";import{T as Oe,a as me}from"./Tabs-BUaZVZQS.js";import{I as $e}from"./Info-lyeC1xGk.js";import{T as ae}from"./Tooltip-CwyNn424.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./Chip-Dnlh_trd.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./Divider-TBuFGUUO.js";import"./skeleton-CrFh5em0.js";const Ge=({onCancel:z,editData:a,isEditMode:v=!1})=>{const[B,_]=n.useState(null),[O,w]=n.useState(""),[M,f]=n.useState(!1),[U,u]=n.useState(void 0),[Y,m]=n.useState(!1),[S,N]=n.useState(0),[t,V]=n.useState({_id:(a==null?void 0:a._id)||"",name:(a==null?void 0:a.name)||"",phone:(a==null?void 0:a.phone)||"",email:(a==null?void 0:a.email)||"",city:(a==null?void 0:a.cityId)||"",aadhar_no:(a==null?void 0:a.aadhar_no)||"",selfie:(a==null?void 0:a.selfie)||"",business_name:(a==null?void 0:a.business_name)||"",address:(a==null?void 0:a.address)||"",business_contact_no:(a==null?void 0:a.business_contact_no)||"",business_whatsapp_no:(a==null?void 0:a.business_whatsapp_no)||""}),E=n.useRef(null),[$,x]=n.useState(""),[G,I]=n.useState(!1),[b,F]=n.useState(""),P=de(),{dealerListings:H,totalItems:q}=ne(r=>r.DealerManagement),{CityMaster:R}=ne(r=>r.CityMaster);n.useEffect(()=>{P(ke({}))},[P]);const Q=async r=>{if(r==null?void 0:r.toLowerCase().endsWith(".pdf"))try{const h=await(await fetch(r)).blob(),C=URL.createObjectURL(h);u(C)}catch(d){console.error("Error fetching file:",d),u(void 0)}else u(r);m(!0)},D=r=>["image/jpeg","image/png","image/jpg","image/webp"].includes(r.type)?r.size>1*1024*1024?(F("File size must be less than 1MB"),!1):(F(""),!0):(F("Only JPG, JPEG, PNG images are allowed!"),!1),X=r=>{var d;const l=(d=r.target.files)==null?void 0:d[0];l&&D(l)&&(V(h=>({...h,selfie:l})),x(l.name))},K=r=>{var d;r.preventDefault();const l=(d=r.dataTransfer.files)==null?void 0:d[0];if(l&&D(l)){const h=new FileReader;h.onload=C=>{V(oe=>{var k;return{...oe,selfie:(k=C.target)==null?void 0:k.result}})},h.readAsDataURL(l),x(l.name)}I(!1)},ee=(r,l)=>{N(l)},i=r=>{const{name:l,value:d}=r.target;V(h=>({...h,[l]:d}))},Z=async r=>{r.preventDefault();try{const l=R.find(C=>C._id===t.city),d=l?l.city_name:"",h=l?l._id:"";if(S===0){let C={userId:t._id,name:t.name,phone:t.phone,email:t.email,city:d,cityId:h,aadhar_no:t.aadhar_no,selfie:t.selfie};v&&(a!=null&&a._id)&&(await P(Be({...C})).unwrap(),_("success"),w("Dealer Profile updated successfully"))}else if(S===1){const C={userId:a._id,business_name:t.business_name,business_contact_no:t.business_contact_no,business_whatsapp_no:t.business_whatsapp_no,address:t.address};await P(Ue({userId:a._id,business_name:t.business_name,business_contact_no:t.business_contact_no,business_whatsapp_no:t.business_whatsapp_no,address:t.address})).unwrap(),_("success"),w("Business Details updated successfully")}f(!0),z(),P(A({search:"",page:0,limit:10}))}catch(l){_("error"),w("Failed: "+(l==null?void 0:l.message)),f(!0)}setTimeout(()=>f(!1),3e3)},W=r=>{const l=r.trim();return!(!l||!/[A-Za-z]/.test(l)||/[^A-Za-z0-9.\s]/.test(l)||l.length>30)},se=t.name.trim()&&t.phone.trim()&&t.email.trim(),le=W(t.business_name);return t.name.trim()&&t.phone.trim()&&t.email.trim()&&W(t.business_name),e.jsxs(e.Fragment,{children:[e.jsxs(he,{open:Y,onClose:()=>m(!1),maxWidth:"md",fullWidth:!0,disableEnforceFocus:!0,children:[e.jsxs(xe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Preview",e.jsx(L,{onClick:()=>m(!1),children:e.jsx(re,{})})]}),e.jsx(ge,{children:U?U.toLowerCase().includes("blob")?e.jsx("iframe",{src:U,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:U,alt:"Preview",style:{width:"50%",height:"auto",display:"block",margin:"0 auto"}}):e.jsx(J,{children:"No file selected."})})]}),M&&B&&e.jsx("div",{className:"p-4",children:e.jsx(fe,{type:B,title:B==="success"?"Success!":B==="error"&&O.toLowerCase().includes("deleted")?"Deleted!":B==="error"?"Error!":"Warning!",message:O,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)})}),e.jsxs(T,{className:"max-w-8xl mx-auto rounded-xl shadow-md mb-6",sx:{backgroundColor:"white"},children:[e.jsxs(T,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(J,{className:"font-outfit",variant:"h6",children:v?"Update Dealer Details":"Create Staff User"}),e.jsx(L,{sx:{color:"white"},onClick:z,children:e.jsx(re,{})})]}),v&&e.jsxs(Oe,{value:S,onChange:ee,variant:"fullWidth",children:[e.jsx(me,{className:"font-outfit",label:"Update Dealer Profile"}),e.jsx(me,{className:"font-outfit",label:"Update Business Details"})]}),e.jsxs(T,{component:"form",onSubmit:Z,px:6,py:4,children:[(!v||S===0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Name",name:"name",value:t.name,onChange:i}),e.jsx(p,{label:"Mobile Number",name:"phone",value:t.phone,onChange:i}),e.jsx(p,{label:"Email",name:"email",value:t.email,onChange:i}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm text-gray-600 dark:text-white block mb-2",children:["City ",e.jsx("span",{className:"text-error-500",children:" * "})]}),e.jsxs("select",{name:"city",value:t.city,onChange:i,className:"mt-1 p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select City"}),R==null?void 0:R.filter(r=>r.isActive).map(r=>e.jsx("option",{value:r._id,children:r.city_name},r._id))]})]}),e.jsx(p,{label:"Aadhar Number",name:"aadhar_no",value:t.aadhar_no,onChange:i}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:X,ref:E,className:"hidden",id:"profile-image-upload"}),e.jsx("label",{htmlFor:"profile-image-upload",className:`cursor-pointer text-gray-400 mt-9 hover:text-gray-600 flex items-center gap-2 border-b border-gray-300 px-2 py-1 min-w-[400px] ${G?"border-blue-500 bg-blue-100":""}`,onDragOver:r=>{r.preventDefault(),I(!0)},onDragLeave:()=>I(!1),onDrop:K,children:$?e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:$}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Drag & Drop or Click to Upload"}),e.jsx(ze,{})]})}),(t==null?void 0:t.selfie)&&e.jsxs("div",{onClick:()=>Q(t.selfie),className:"flex items-center cursor-pointer mt-2",children:[e.jsx(pe,{className:"text-blue-600",fontSize:"small"}),e.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"Existing Profile Image"})]}),b?e.jsx("p",{className:"mt-1.5 text-xs text-red-600",children:b}):e.jsx("p",{className:"mt-1 text-xs text-gray-400 italic",children:"* File size should be up to 1 MB"})]})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Business Name",name:"business_name",value:t.business_name,onChange:i}),e.jsx(p,{label:"Business Contact No.",name:"business_contact_no",value:t.business_contact_no,onChange:i}),e.jsx(p,{label:"Business Whatsapp No.",name:"business_whatsapp_no",value:t.business_whatsapp_no,onChange:i}),e.jsx(p,{label:"Business Address",name:"address",value:t.address,onChange:i})]})]}),v&&S===1&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Business Name",name:"business_name",value:t.business_name,onChange:i}),e.jsx(p,{label:"Business Contact No.",name:"business_contact_no",value:t.business_contact_no,onChange:i}),e.jsx(p,{label:"Business Whatsapp No.",name:"business_whatsapp_no",value:t.business_whatsapp_no,onChange:i}),e.jsx(p,{label:"Business Address",name:"address",value:t.address,onChange:i})]})})}),e.jsx("div",{className:"flex justify-center gap-6 mt-6",children:S===0?e.jsx(ue,{disabled:!se,children:v?"Update":"Create User"}):e.jsx(ue,{disabled:!le,children:"Update"})})]})]})]})},He=()=>{const[z,a]=n.useState({_id:"",name:"",phone:"",email:"",createdAt:"",updatedAt:"",pan_no:"",dealershipCategories:[],activeDealershipCategory:"",selfie:"",isActive:void 0}),[v,B]=n.useState(null),[_,O]=n.useState(""),[w,M]=n.useState(0),[f,U]=n.useState(10),[u,Y]=n.useState(""),[m,S]=n.useState(""),[N,t]=n.useState(null),[V,E]=n.useState(""),[$,x]=n.useState(!1),[G,I]=n.useState(null),[b,F]=n.useState(null),[P,H]=n.useState(!1),[q,R]=n.useState(null),[Q,D]=n.useState(!1),[X,K]=n.useState(!1),[ee,i]=n.useState(!1),[Z,W]=n.useState(null),[se,le]=n.useState(!1),[r,l]=n.useState(0),[d,h]=n.useState(!1),[C,oe]=n.useState(null),[k,be]=n.useState([]),[Ze,Je]=n.useState(""),je=Ve();sessionStorage.getItem("activeRole");const j=de(),{dealerList:ye,totalItems:ve}=ne(s=>s.DealerManagement);n.useEffect(()=>{const s=setTimeout(()=>{const o={};k.forEach(({id:g,value:c})=>{c&&(g==="isActive"?o[g]=c==="Active":typeof c=="string"&&c.trim()?o[g]=c.trim():o[g]=c)}),j(A({search:_,filters:o,page:w,limit:f}))},500);return()=>clearTimeout(s)},[_,w,f,k,u,m]);const te=n.useRef(null),we=s=>{be(s),M(0);const o={};s.forEach(({id:c,value:y})=>{y&&(c==="isActive"?o[c]=y==="Active":typeof y=="string"&&y.trim()?o[c]=y.trim():o[c]=y)});const g={filters:o,fromDate:u,toDate:m,page:0,limit:f};te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{j(A(g))},500)},Ce=async(s,o)=>{O(s),M(0),o&&await j(A({fromDate:u,toDate:m,search:s,exportType:o}))},_e=(s,o)=>{a(s),W(o),i(!0)},ie=s=>{j(Me(s));const g=sessionStorage.getItem("activeRole")==="staff"?"staff":"superadmin";je(`/${g}/dealerviewpage/${s._id}`,{state:s})},Se=s=>{I(s),K(!0)},Ae=async()=>{if(G){try{await j(Ee(G)).unwrap(),t("error"),E("Dealer User deleted successfully."),x(!0),j(A({search:_,page:w,limit:f}))}catch(s){t("error"),E("Delete failed: "+s),x(!0)}setTimeout(()=>x(!1),3e3),K(!1),I(null)}},Te=()=>{K(!1),I(null)},Ne=s=>{F(s),H(!0)},Ie=async()=>{if(b){try{await j(Le({_id:b._id,isActive:!b.isActive})).unwrap(),t("success"),E(`User ${b.isActive?"deactivated":"activated"} successfully.`),x(!0),j(A({search:_,page:w,limit:f}))}catch(s){t("error"),E("Status toggle failed: "+s),x(!0)}setTimeout(()=>x(!1),3e3),H(!1),F(null)}},Fe=()=>{H(!1),F(null)};n.useEffect(()=>{if(u&&!m||!u&&m)return;j(A({fromDate:u||void 0,toDate:m||void 0}))},[u,m]);const Pe=[{accessorKey:"name",header:"Dealer Name",filterVariant:"text",Cell:({row:s})=>e.jsx(J,{sx:{cursor:"pointer",fontFamily:"outfit",fontSize:"14px"},onClick:()=>ie(s.original),children:s.original.name})},{accessorKey:"phone",header:"Mobile No",filterVariant:"text"},{accessorKey:"business_name",header:"Business Name",filterVariant:"text"},{accessorKey:"business_contact_no",header:"Business Contact",filterVariant:"text"},{accessorKey:"business_whatsapp_no",header:"Business Whatsapp",filterVariant:"text"},{accessorKey:"email",header:"Email ID",filterVariant:"text"},{accessorKey:"city",header:"City",filterVariant:"text",Cell:({cell:s})=>{const o=s.getValue()||"";return o.charAt(0).toUpperCase()+o.slice(1)}},{accessorKey:"isActive",header:"Account Status",Cell:({cell:s})=>s.getValue()?"Active":"Inactive",filterVariant:"select",filterSelectOptions:["Active","Inactive"]},{accessorKey:"createdAt",header:"Registration Date",Cell:({cell:s})=>{const o=s.getValue();return new Date(o).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}},{accessorKey:"updatedAt",header:"Last Updated",Cell:({cell:s})=>{const o=s.getValue();return new Date(o).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}},{header:"Actions",Cell:({row:s})=>e.jsxs(T,{display:"flex",gap:1,children:[e.jsx(ae,{title:"View Details",arrow:!0,children:e.jsx(L,{color:"primary",onClick:()=>ie(s.original),children:e.jsx(pe,{})})}),e.jsx(ae,{title:"Edit Dealer",arrow:!0,children:e.jsx(L,{color:"secondary",onClick:()=>_e(s.original,s.index),children:e.jsx(De,{})})}),e.jsx(L,{color:"error",onClick:()=>Se(s.original._id),children:e.jsx(Ke,{})}),e.jsx(We,{checked:s.original.isActive,onChange:()=>Ne(s.original),tooltipTitle:s.original.isActive?"Deactivate":"Activate"})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(ce,{show:X,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this dealer?",onConfirm:Ae,onCancel:Te,confirmText:"Yes",cancelText:"No"}),e.jsx(ce,{show:P,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${b!=null&&b.isActive?"deactivate":"activate"} this user?`,onConfirm:Ie,onCancel:Fe,confirmText:"Yes",cancelText:"No"}),e.jsxs(he,{open:Q,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{className:"font-outfit",children:"Image Preview"}),e.jsxs(ge,{children:[q&&e.jsx("img",{src:q,alt:"Preview",style:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:12}}),e.jsx(L,{sx:{position:"absolute",top:12,right:12},onClick:()=>D(!1),children:e.jsx(re,{})})]})]}),$&&N&&e.jsx("div",{className:"p-4",children:e.jsx(fe,{type:N,title:N==="success"?"Success!":N==="error"&&V.toLowerCase().includes("deleted")?"Deleted!":N==="error"?"Error!":"Warning!",message:V,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>x(!1)})}),ee?e.jsx(Ge,{onCancel:()=>{setTimeout(()=>{i(!1),W(null)},1e3)},editData:Z!==null?z:void 0,isEditMode:Z!==null}):se&&v?e.jsx(T,{className:"flex flex-col items-center px-4 pt-1 pb-4"}):e.jsxs(T,{children:[e.jsx(T,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(T,{ml:2,children:e.jsxs(J,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Dealer Management  ",e.jsx(ae,{title:"Manage dealer details, view listings, leads, subscriptions, activity logs, and update profile or business information.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx($e,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:s=>s.stopPropagation()})})]})})}),e.jsx(Re,{exportType:!0,clickHandler:Ce,data:ye,columns:Pe,enableColumnFilters:!0,columnFilters:k,onColumnFiltersChange:we,rowCount:ve,pageIndex:w,pageSize:f,onPaginationChange:({pageIndex:s,pageSize:o})=>{M(s),U(o);const g={};k.forEach(({id:c,value:y})=>{y&&(g[c]=c==="isActive"?y==="Active":y)}),j(A({filters:g,fromDate:u,toDate:m,page:s,limit:o}))},fromDate:u,toDate:m,onFromDateChange:Y,onToDateChange:S})]})]})},Ts=()=>e.jsx(e.Fragment,{children:e.jsx(He,{})});export{Ts as default};
