import{j as e,B as l,c as W,r,K as te,M as se,d as re,N as F,Q as ie,R as ne}from"./index-CNh2Ysd7.js";import{A as ae}from"./Add-ONoAddvh.js";import{D as oe,E as le}from"./DataTable-CBDiE-I1.js";import{D as ce}from"./Delete-BKL8mfiA.js";import{V as de}from"./Visibility-CFK2wX7e.js";import{I as me}from"./Info-BLOe8JuO.js";import{B}from"./Button-D2SEshHa.js";import{S as L}from"./SweetAlert-DUVT9XWx.js";import{T as ue}from"./ToggleSwitch-CRLgVpk1.js";import{C as H}from"./Close-CSWdanUp.js";import{D as he,a as xe}from"./Dialog-CMeqEyOr.js";import{T as d}from"./Typography-DxP0RQcB.js";import{I as V}from"./AlertTitle-BBXxFqxI.js";import{C as b}from"./Chip--RBU-Z22.js";import{D as K}from"./Divider-1omdH51K.js";import{I}from"./InputField-Cac7SuVh.js";import{A as pe}from"./Alert-BBsTbpkb.js";import{T as O}from"./Tooltip-B4POfKz-.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";const fe=({open:n,data:s,onClose:m})=>s?e.jsx(he,{open:n,onClose:m,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",overflow:"hidden"}},children:e.jsx(xe,{sx:{p:0},children:e.jsxs(l,{className:"bg-white rounded-xl",children:[e.jsxs(l,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[e.jsx(d,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"18px",fontWeight:600},children:"Contact Details"}),e.jsx(V,{sx:{color:"white"},onClick:m,children:e.jsx(H,{})})]}),e.jsxs(l,{px:6,py:4,children:[e.jsx(d,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"22px",fontWeight:600,color:"#1f2937",mb:1},children:s.contact_name}),e.jsxs(l,{display:"flex",gap:2,mb:2,children:[e.jsx(b,{label:s.category,color:"primary"}),e.jsx(b,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error"}),e.jsx(b,{label:s.visibility==="admin"?"Admin Only":"Visible to Residents",color:s.visibility==="admin"?"secondary":"info"})]}),e.jsx(K,{sx:{my:2}}),e.jsxs(l,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Role / Service:"})," ",s.role_or_service]}),e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Phone:"})," ",s.phone]}),s.alternate_phone&&e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Alternate Number:"})," ",s.alternate_phone]}),s.email&&e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Email:"})," ",s.email]})]}),e.jsx(K,{sx:{my:3}}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx(d,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:1},children:"Description / Notes"}),e.jsx(l,{sx:{border:"1px solid #e5e7eb",borderRadius:1,p:2,backgroundColor:"#fafafa",fontFamily:"Outfit, sans-serif",fontSize:"14px",lineHeight:"22px"},children:s.description}),e.jsx(K,{sx:{my:3}})]}),e.jsxs(l,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Created On:"})," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs(d,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(s.updatedAt).toLocaleDateString()]})]})]})]})})}):null,U={contact_name:"",category:"",role_or_service:"",phone:"",alternate_phone:"",email:"",description:"",visibility:"resident"},ge=["Committee","Emergency","Vendor","Utility"],ye=({onCancel:n,editData:s,isEditMode:m,isViewMode:a=!1})=>{const g=W(),[i,v]=r.useState(U),[S,C]=r.useState(!1),[y,h]=r.useState(null),[D,j]=r.useState(""),[w,x]=r.useState(!1);r.useEffect(()=>{v(s?{contact_name:s.contact_name||"",category:s.category||"",role_or_service:s.role_or_service||"",phone:s.phone||"",alternate_phone:s.alternate_phone||"",email:s.email||"",description:s.description||"",visibility:s.visibility||"resident"}:U)},[s]);const c=u=>{const{name:A,value:N}=u.target;v(_=>({..._,[A]:N}))},k=async u=>{if(u.preventDefault(),!S){C(!0);try{m&&(s!=null&&s._id)?(await g(te({_id:s._id,data:i})).unwrap(),j("Contact updated successfully")):(await g(se(i)).unwrap(),j("Contact added successfully")),h("success"),x(!0),setTimeout(()=>{x(!1),n()},1500)}catch(A){h("error"),j(A||"Something went wrong"),x(!0)}finally{C(!1)}}},P=i.contact_name&&i.category&&i.role_or_service&&i.phone;return e.jsxs(e.Fragment,{children:[w&&y&&e.jsx(pe,{type:y,title:y==="success"?"Success!":"Error!",message:D,variant:"filled",showLink:!1,onClose:()=>x(!1)}),e.jsxs(l,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(l,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(d,{variant:"h6",children:a?"Contact Details":m?"Update Contact":"Add Contact"}),e.jsx(V,{sx:{color:"white"},onClick:n,children:e.jsx(H,{})})]}),e.jsxs(l,{component:"form",onSubmit:k,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{label:"Contact Name",name:"contact_name",value:i.contact_name,onChange:c,disabled:a}),e.jsx(I,{label:"Role / Service Type",name:"role_or_service",value:i.role_or_service,onChange:c,disabled:a}),e.jsx(I,{label:"Phone Number",name:"phone",value:i.phone,onChange:c,disabled:a}),e.jsx(I,{label:"Alternate Number",name:"alternate_phone",value:i.alternate_phone,onChange:c,disabled:a}),e.jsx(I,{label:"Email ID",name:"email",value:i.email,onChange:c,disabled:a}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Category"}),e.jsxs("select",{name:"category",value:i.category,onChange:c,disabled:a,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select Category"}),ge.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Visibility"}),e.jsxs("select",{name:"visibility",value:i.visibility,onChange:c,disabled:a,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"resident",children:"Visible to Residents"}),e.jsx("option",{value:"admin",children:"Admin Only"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Description / Notes"}),e.jsx("textarea",{name:"description",value:i.description,onChange:c,disabled:a,className:"w-full border rounded p-2",rows:4})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!a&&e.jsx(B,{disabled:!P||S,children:S?m?"Updating...":"Saving...":m?"Update Contact":"Save Contact"}),e.jsx(B,{variant:"secondary",onClick:n,children:a?"Back":"Cancel"})]})]})]})]})},je=()=>{const n=W(),{directories:s,totalItems:m}=re(t=>t.directorymanagement),[a,g]=r.useState(0),[i,v]=r.useState(10),[S,C]=r.useState(!1),[y,h]=r.useState(null),[D,j]=r.useState(null),[w,x]=r.useState(null),[c,k]=r.useState(!1),[P,u]=r.useState(!1),[A,N]=r.useState(!1),[_,$]=r.useState(""),[G,Q]=r.useState([]),[p,q]=r.useState(""),[f,J]=r.useState(""),E=r.useRef(null),[R,X]=r.useState("all"),Y=t=>{Q(t),g(0);const o={};t.forEach(({id:T,value:z})=>{z&&(o[T]=T==="isActive"?z==="Active":z)}),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{n(F({search:_,filters:o,fromDate:p||void 0,toDate:f||void 0,page:0,limit:i}))},500)};r.useEffect(()=>{p&&!f||!p&&f||n(F({fromDate:p||void 0,toDate:f||void 0,page:0,limit:i}))},[p,f]);const Z=async(t,o)=>{$(t),g(0),await n(F({search:t,fromDate:p,toDate:f,exportType:o,page:0,limit:i}))},M=[{accessorKey:"contact_name",header:"Contact Name",filterVariant:"text"},{accessorKey:"role_or_service",header:"Role / Service",filterVariant:"text"},{accessorKey:"phone",header:"Phone",filterVariant:"text"},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({cell:t})=>{const o=t.getValue()||"",T=60;return e.jsx("span",{title:o,children:o.length>T?`${o.substring(0,T)}...`:o})}},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["Committee","Emergency","Vendor","Utility"],Cell:({cell:t})=>e.jsx(b,{label:t.getValue(),color:t.getValue()==="Committee"?"primary":t.getValue()==="Emergency"?"secondary":t.getValue()==="Vendor"?"success":"warning",size:"small"})},{accessorKey:"visibility",header:"Visibility",filterVariant:"select",filterSelectOptions:["admin","resident"],Cell:({cell:t})=>e.jsx(b,{label:t.getValue()==="admin"?"Admin Only":"Residents",color:t.getValue()==="admin"?"secondary":"info",size:"small"})},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text",Cell:({cell:t})=>new Date(t.getValue()).toLocaleDateString()},{accessorKey:"updatedAt",header:"Updated Date",filterVariant:"text",Cell:({cell:t})=>new Date(t.getValue()).toLocaleDateString()},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:t})=>t.getValue()?e.jsx(b,{label:"Active",color:"success",size:"small"}):e.jsx(b,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:t})=>e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(O,{title:"View",children:e.jsx(V,{onClick:()=>{h(t.original),N(!0)},children:e.jsx(de,{})})}),e.jsx(O,{title:"Edit",children:e.jsx(V,{onClick:()=>{h(t.original),u(!1),C(!0)},children:e.jsx(le,{})})}),e.jsx(O,{title:"Delete",children:e.jsx(V,{color:"error",onClick:()=>j(t.original._id),children:e.jsx(ce,{})})}),e.jsx(ue,{checked:t.original.isActive,onChange:()=>{x(t.original._id),k(!t.original.isActive)}})]})}],ee=async()=>{D&&(await n(ne(D)),j(null))};return e.jsxs(e.Fragment,{children:[e.jsx(L,{show:!!D,type:"error",title:"Delete Directory",message:"Are you sure you want to delete this directory?",onConfirm:ee,onCancel:()=>j(null)}),e.jsx(L,{show:!!w,type:"warning",title:"Change Directory Status",message:`Are you sure you want to ${c?"activate":"deactivate"} this directory?`,confirmText:c?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{w&&n(ie(w)),x(null)},onCancel:()=>x(null)}),e.jsx(fe,{open:A,data:y,onClose:()=>{N(!1),h(null)}}),S?e.jsx(ye,{editData:y,isEditMode:!!y,onCancel:()=>{C(!1),h(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(d,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Directory Management Module",e.jsx(O,{title:"The Directory Module allows the Society Admin to centrally manage and publish important contact information for residents.",arrow:!0,children:e.jsx(me,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(B,{onClick:()=>{h(null),C(!0)},children:[e.jsx(ae,{})," Add Directory Contact"]})]}),e.jsx(oe,{data:s,columns:M,rowCount:m,pageIndex:a,pageSize:i,enableColumnFilters:!0,columnFilters:G,onColumnFiltersChange:Y,exportType:!0,clickHandler:Z,enableDirectorytypeFilter:!0,directoryTypeValue:R,onDirectorytypeChange:t=>{X(t),g(0),n(F({search:_,filters:t!=="all"?{category:t}:void 0,fromDate:p,toDate:f,page:0,limit:i}))},fromDate:p,toDate:f,onFromDateChange:q,onToDateChange:J,onPaginationChange:({pageIndex:t,pageSize:o})=>{g(t),v(o),n(F({search:_,filters:R!=="all"?{category:R}:void 0,page:t,limit:o}))}},R)]})]})},Ye=()=>e.jsx(e.Fragment,{children:e.jsx(je,{})});export{Ye as default};
