import{j as e,B as l,c as H,r,K as te,M as se,d as re,N as R,Q as ie,R as ne}from"./index-N8t8oMzR.js";import{D as ae,E as oe}from"./DataTable-BqUD-dAi.js";import{D as le}from"./Delete-07TAjR17.js";import{V as ce}from"./Visibility-CgGAKN6P.js";import{I as de}from"./Info-lyeC1xGk.js";import{C as me}from"./Contacts-BFbts5d2.js";import{B as W}from"./Button-CBNcrDpD.js";import{S as $}from"./SweetAlert-vzLgp13W.js";import{T as ue}from"./ToggleSwitch-DR4b514_.js";import{C as G}from"./Close-CwR_quIe.js";import{D as xe,a as he}from"./Dialog-BGF2t3L7.js";import{T as c}from"./Typography-CKlLxaDL.js";import{I as O}from"./AlertTitle-D9ejxV9_.js";import{C as S}from"./Chip-Dnlh_trd.js";import{D as U}from"./Divider-TBuFGUUO.js";import{I as E}from"./InputField-riaj6edy.js";import{A as pe}from"./Alert-CgNUKTJk.js";import{T as B}from"./Tooltip-CwyNn424.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./DialogTitle-D6DEKDqS.js";import"./Tabs-BUaZVZQS.js";import"./skeleton-CrFh5em0.js";const fe=({open:n,data:s,onClose:u})=>s?e.jsx(xe,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",overflow:"hidden"}},children:e.jsx(he,{sx:{p:0},children:e.jsxs(l,{className:"bg-white rounded-xl",children:[e.jsxs(l,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[e.jsx(c,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"18px",fontWeight:600},children:"Contact Details"}),e.jsx(O,{sx:{color:"white"},onClick:u,children:e.jsx(G,{})})]}),e.jsxs(l,{px:6,py:4,children:[e.jsx(c,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"22px",fontWeight:600,color:"#1f2937",mb:1},children:s.contact_name}),e.jsxs(l,{display:"flex",gap:2,mb:2,children:[e.jsx(S,{label:s.category,color:"primary"}),e.jsx(S,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error"}),e.jsx(S,{label:s.visibility==="admin"?"Admin Only":"Visible to Residents",color:s.visibility==="admin"?"secondary":"info"})]}),e.jsx(U,{sx:{my:2}}),e.jsxs(l,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Role / Service:"})," ",s.role_or_service]}),e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Phone:"})," ",s.phone]}),s.alternate_phone&&e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Alternate Number:"})," ",s.alternate_phone]}),s.email&&e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Email:"})," ",s.email]})]}),e.jsx(U,{sx:{my:3}}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:1},children:"Description / Notes"}),e.jsx(l,{sx:{border:"1px solid #e5e7eb",borderRadius:1,p:2,backgroundColor:"#fafafa",fontFamily:"Outfit, sans-serif",fontSize:"14px",lineHeight:"22px"},children:s.description}),e.jsx(U,{sx:{my:3}})]}),e.jsxs(l,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Created On:"})," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs(c,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(s.updatedAt).toLocaleDateString()]})]})]})]})})}):null,q={contact_name:"",category:"",role_or_service:"",phone:"",alternate_phone:"",email:"",description:"",visibility:"resident"},ge=["Committee","Emergency","Vendor","Utility"],ye=({onCancel:n,editData:s,isEditMode:u,isViewMode:a=!1})=>{const y=H(),[i,D]=r.useState(q),[w,h]=r.useState(!1),[j,p]=r.useState(null),[A,b]=r.useState(""),[_,f]=r.useState(!1),[C,T]=r.useState(""),[k,I]=r.useState("");r.useEffect(()=>{D(s?{contact_name:s.contact_name||"",category:s.category||"",role_or_service:s.role_or_service||"",phone:s.phone||"",alternate_phone:s.alternate_phone||"",email:s.email||"",description:s.description||"",visibility:s.visibility||"resident"}:q)},[s]);const d=x=>{const{name:v,value:V}=x.target;v==="category"&&T(V?"":"Category is required"),v==="visibility"&&(["resident","admin"].includes(V)?I(""):I("Invalid visibility option")),D(m=>({...m,[v]:V}))},z=async x=>{if(x.preventDefault(),!i.category){T("Category is required"),h(!1);return}if(!["resident","admin"].includes(i.visibility)){I("Invalid visibility option"),h(!1);return}if(!w){h(!0);try{u&&(s!=null&&s._id)?(await y(te({_id:s._id,data:i})).unwrap(),b("Contact updated successfully")):(await y(se(i)).unwrap(),b("Contact added successfully")),p("success"),f(!0),setTimeout(()=>{f(!1),n()},1500)}catch(v){p("error"),b(v||"Something went wrong"),f(!0)}finally{h(!1)}}},F=i.contact_name&&i.category&&i.role_or_service&&i.phone&&["resident","admin"].includes(i.visibility)&&!C;return e.jsxs(e.Fragment,{children:[_&&j&&e.jsx(pe,{type:j,title:j==="success"?"Success!":"Error!",message:A,variant:"filled",showLink:!1,onClose:()=>f(!1)}),e.jsxs(l,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(l,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(c,{variant:"h6",children:a?"Contact Details":u?"Update Contact":"Add Contact"}),e.jsx(O,{sx:{color:"white"},onClick:n,children:e.jsx(G,{})})]}),e.jsxs(l,{component:"form",onSubmit:z,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(E,{label:"Contact Name",name:"contact_name",value:i.contact_name,onChange:d,disabled:a}),e.jsx(E,{label:"Role / Service Type",name:"role_or_service",value:i.role_or_service,onChange:d,disabled:a}),e.jsx(E,{label:"Phone Number",name:"phone",value:i.phone,onChange:d,disabled:a}),e.jsx(E,{label:"Alternate Number",name:"alternate_phone",value:i.alternate_phone,onChange:d,disabled:a}),e.jsx(E,{label:"Email ID",name:"email",value:i.email,onChange:d,disabled:a}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Category ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("select",{name:"category",value:i.category,onChange:d,disabled:a,className:`w-full p-2 rounded ${C?"border border-error-500":"border border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select Category"}),ge.map(x=>e.jsx("option",{value:x,children:x},x))]}),C&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:C})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Visibility ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("select",{name:"visibility",value:i.visibility,onChange:d,disabled:a,className:`w-full p-2 rounded ${k?"border-error-500":"border-gray-300"}`,children:[e.jsx("option",{value:"resident",children:"Visible to Residents"}),e.jsx("option",{value:"admin",children:"Admin Only"})]}),k&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:k})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Description / Notes"}),e.jsx("textarea",{name:"description",value:i.description,onChange:d,disabled:a,className:"w-full border rounded p-2",rows:4})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!a&&e.jsx(W,{disabled:!F||w,children:w?u?"Updating...":"Saving...":u?"Update Contact":"Save Contact"}),e.jsx(W,{variant:"secondary",onClick:n,children:a?"Back":"Cancel"})]})]})]})]})},je=()=>{const n=H(),{directories:s,totalItems:u}=re(t=>t.directorymanagement),[a,y]=r.useState(0),[i,D]=r.useState(10),[w,h]=r.useState(!1),[j,p]=r.useState(null),[A,b]=r.useState(null),[_,f]=r.useState(null),[C,T]=r.useState(!1),[k,I]=r.useState(!1),[d,z]=r.useState(!1),[F,x]=r.useState(""),[v,V]=r.useState([]),[m,Q]=r.useState(""),[g,J]=r.useState(""),P=r.useRef(null),[K,X]=r.useState("all"),Y=t=>{V(t),y(0);const o={};t.forEach(({id:N,value:L})=>{L&&(o[N]=N==="isActive"?L==="Active":L)}),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{n(R({search:F,filters:o,fromDate:m||void 0,toDate:g||void 0,page:0,limit:i}))},500)};r.useEffect(()=>{m&&!g||!m&&g||n(R({fromDate:m||void 0,toDate:g||void 0,page:0,limit:i}))},[m,g]);const Z=async(t,o)=>{x(t),y(0),await n(R({search:t,fromDate:m,toDate:g,exportType:o,page:0,limit:i}))},M=[{accessorKey:"contact_name",header:"Contact Name",filterVariant:"text"},{accessorKey:"role_or_service",header:"Role / Service",filterVariant:"text"},{accessorKey:"phone",header:"Phone",filterVariant:"text"},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({cell:t})=>{const o=t.getValue()||"",N=60;return e.jsx("span",{title:o,children:o.length>N?`${o.substring(0,N)}...`:o})}},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["Committee","Emergency","Vendor","Utility"],Cell:({cell:t})=>e.jsx(S,{label:t.getValue(),color:t.getValue()==="Committee"?"primary":t.getValue()==="Emergency"?"secondary":t.getValue()==="Vendor"?"success":"warning",size:"small"})},{accessorKey:"visibility",header:"Visibility",filterVariant:"select",filterSelectOptions:["admin","resident"],Cell:({cell:t})=>e.jsx(S,{label:t.getValue()==="admin"?"Admin Only":"Residents",color:t.getValue()==="admin"?"secondary":"info",size:"small"})},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text",Cell:({cell:t})=>new Date(t.getValue()).toLocaleDateString()},{accessorKey:"updatedAt",header:"Updated Date",filterVariant:"text",Cell:({cell:t})=>new Date(t.getValue()).toLocaleDateString()},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:t})=>t.getValue()?e.jsx(S,{label:"Active",color:"success",size:"small"}):e.jsx(S,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:t})=>e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(B,{title:"View",children:e.jsx(O,{onClick:()=>{p(t.original),z(!0)},children:e.jsx(ce,{})})}),e.jsx(B,{title:"Edit",children:e.jsx(O,{onClick:()=>{p(t.original),I(!1),h(!0)},children:e.jsx(oe,{})})}),e.jsx(B,{title:"Delete",children:e.jsx(O,{color:"error",onClick:()=>b(t.original._id),children:e.jsx(le,{})})}),e.jsx(ue,{checked:t.original.isActive,onChange:()=>{f(t.original._id),T(!t.original.isActive)}})]})}],ee=async()=>{A&&(await n(ne(A)),b(null))};return e.jsxs(e.Fragment,{children:[e.jsx($,{show:!!A,type:"error",title:"Delete Directory",message:"Are you sure you want to delete this directory?",onConfirm:ee,onCancel:()=>b(null)}),e.jsx($,{show:!!_,type:"warning",title:"Change Directory Status",message:`Are you sure you want to ${C?"activate":"deactivate"} this directory?`,confirmText:C?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{_&&n(ie(_)),f(null)},onCancel:()=>f(null)}),e.jsx(fe,{open:d,data:j,onClose:()=>{z(!1),p(null)}}),w?e.jsx(ye,{editData:j,isEditMode:!!j,onCancel:()=>{h(!1),p(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(c,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Directory Management Module",e.jsx(B,{title:"The Directory Module allows the Society Admin to centrally manage and publish important contact information for residents.",arrow:!0,children:e.jsx(de,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(W,{onClick:()=>{p(null),h(!0)},children:[e.jsx(me,{})," Add Directory Contact"]})]}),e.jsx(ae,{data:s,columns:M,rowCount:u,pageIndex:a,pageSize:i,enableColumnFilters:!0,columnFilters:v,onColumnFiltersChange:Y,exportType:!0,clickHandler:Z,enableDirectorytypeFilter:!0,directoryTypeValue:K,onDirectorytypeChange:t=>{X(t),y(0),n(R({search:F,filters:t!=="all"?{category:t}:void 0,fromDate:m,toDate:g,page:0,limit:i}))},fromDate:m,toDate:g,onFromDateChange:Q,onToDateChange:J,onPaginationChange:({pageIndex:t,pageSize:o})=>{y(t),D(o),n(R({search:F,filters:K!=="all"?{category:K}:void 0,page:t,limit:o}))}},K)]})]})},Ye=()=>e.jsx(e.Fragment,{children:e.jsx(je,{})});export{Ye as default};
