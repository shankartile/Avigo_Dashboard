import{j as e,B as m,c as G,r as a,F as se,G as re,d as ae,H as R,I as ne,J as ie}from"./index-N8t8oMzR.js";import{a as oe,D as le,E as ce}from"./DataTable-BqUD-dAi.js";import{D as me}from"./Delete-07TAjR17.js";import{V as ue}from"./Visibility-CgGAKN6P.js";import{I as de}from"./Info-lyeC1xGk.js";import{B as K}from"./Button-CBNcrDpD.js";import{S as $}from"./SweetAlert-vzLgp13W.js";import{T as pe}from"./ToggleSwitch-DR4b514_.js";import{C as X}from"./Close-CwR_quIe.js";import{D as he,a as fe}from"./Dialog-BGF2t3L7.js";import{T as D}from"./Typography-CKlLxaDL.js";import{I as z}from"./AlertTitle-D9ejxV9_.js";import{C as O}from"./Chip-Dnlh_trd.js";import{D as q}from"./Divider-TBuFGUUO.js";import{J as xe}from"./jodit-react-CujUNROP.js";import{I as ge}from"./InputField-riaj6edy.js";import{A as ye}from"./Alert-CgNUKTJk.js";import{T as P}from"./Tooltip-CwyNn424.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./DialogTitle-D6DEKDqS.js";import"./Tabs-BUaZVZQS.js";import"./skeleton-CrFh5em0.js";const je=o=>{var u;const s=(u=o.split(".").pop())==null?void 0:u.toLowerCase();return s?["jpg","jpeg","png","gif","webp"].includes(s)?"image":s==="pdf"?"pdf":"other":"other"},be=({open:o,data:s,onClose:u})=>s?e.jsx(he,{open:o,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",overflow:"hidden"}},children:e.jsx(fe,{sx:{p:0},children:e.jsxs(m,{className:"bg-white rounded-xl",children:[e.jsxs(m,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[e.jsx(D,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"18px",fontWeight:600},children:"Documents Details"}),e.jsx(z,{sx:{color:"white"},onClick:u,children:e.jsx(X,{})})]}),e.jsxs(m,{px:6,py:4,children:[e.jsx(D,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"22px",fontWeight:600,color:"#1f2937",mb:1},children:s.title}),e.jsxs(m,{display:"flex",gap:2,mb:2,children:[e.jsx(O,{label:s.category,color:"primary"}),e.jsx(O,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error"})]}),e.jsx(q,{sx:{my:2}}),e.jsx(D,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:1},children:"Description"}),e.jsx(m,{sx:{border:"1px solid #e5e7eb",borderRadius:1,p:2,backgroundColor:"#fafafa",fontFamily:"Outfit, sans-serif",fontSize:"14px",lineHeight:"22px"},dangerouslySetInnerHTML:{__html:s.description}}),Array.isArray(s.attachments)&&s.attachments.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{my:3}}),e.jsx(D,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:2},children:"Attachments"}),e.jsx(m,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:2,children:s.attachments.map((l,g)=>{const n=je(l),p=l.split("/").pop();return e.jsxs(m,{sx:{border:"1px solid #e5e7eb",borderRadius:"12px",p:1.5,textAlign:"center",cursor:"pointer",backgroundColor:"#fafafa","&:hover":{boxShadow:3}},onClick:()=>window.open(l,"_blank"),children:[n==="image"&&e.jsx("img",{src:l,alt:p,style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),n==="pdf"&&e.jsx("iframe",{src:l,title:p,style:{width:"100%",height:120,border:"none",borderRadius:8}}),n==="other"&&e.jsx(m,{height:120,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",sx:{fontSize:40},children:"ðŸ“„"}),e.jsx(D,{sx:{fontSize:"12px",mt:1,wordBreak:"break-all",fontFamily:"Outfit, sans-serif"},children:p})]},g)})})]}),e.jsx(q,{sx:{my:3}}),e.jsx(m,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:e.jsxs(D,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Created On:"})," ",new Date(s.createdAt).toLocaleDateString()]})})]})]})})}):null,Ce=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],H=o=>o.replace(/<[^>]*>/g,"").trim(),De=5*1024*1024,J={title:"",category:"",description:"",attachments:[]},Se=["Bylaws","Circulars","Certificates","Agreements"],we=({onCancel:o,editData:s,isEditMode:u,isViewMode:l=!1})=>{const g=G(),[n,p]=a.useState(J),[A,f]=a.useState(!1),[S,y]=a.useState(null),[F,w]=a.useState(""),[I,j]=a.useState(!1),[v,k]=a.useState(""),[V,E]=a.useState(""),[N,b]=a.useState("");a.useEffect(()=>{p(s?{title:s.title||"",category:s.category||"",description:s.description||"",attachments:[]}:J)},[s]);const T=i=>{const{name:d,value:r}=i.target;d==="category"&&k(r?"":"Category is required"),p(h=>({...h,[d]:r}))},L=i=>{const d=i.target.files;if(!d)return;const r=Array.from(d);let h="";r.length===0&&(h="At least one attachment is required");for(const x of r){if(!Ce.includes(x.type)){h="Only PDF, Image, or Doc files are allowed";break}if(x.size>De){h="Each file must be less than 5 MB";break}}if(h){E(h),p(x=>({...x,attachments:[]})),i.target.value="";return}E(""),p(x=>({...x,attachments:r}))},U=async i=>{if(i.preventDefault(),!n.category){k("Category is required"),f(!1);return}const d=H(n.description);if(!d){b("Description is required"),f(!1);return}if(d.length<10){b("Description must be at least 10 characters"),f(!1);return}if(!u&&n.attachments.length===0){E("Attachments are required"),f(!1);return}if(!A){f(!0);try{const r=new FormData;r.append("title",n.title),r.append("category",n.category),r.append("description",n.description),n.attachments.forEach(h=>{r.append("attachments",h)}),u&&(s!=null&&s._id)?(await g(se({_id:s._id,data:r})).unwrap(),w("Document updated successfully")):(await g(re(r)).unwrap(),w("Document published successfully")),y("success"),j(!0),setTimeout(()=>{j(!1),o()},1500)}catch(r){y("error"),w(r||"Something went wrong"),j(!0)}finally{f(!1)}}},W=!!n.title&&!!n.category&&H(n.description).length>=10&&!N&&!v&&!V;return e.jsxs(e.Fragment,{children:[I&&S&&e.jsx(ye,{type:S,title:S==="success"?"Success!":"Error!",message:F,variant:"filled",showLink:!1,onClose:()=>j(!1)}),e.jsxs(m,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(m,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(D,{variant:"h6",children:l?"Document Details":u?"Update Document":"Upload Document"}),e.jsx(z,{sx:{color:"white"},onClick:o,children:e.jsx(X,{})})]}),e.jsxs(m,{component:"form",onSubmit:U,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(ge,{label:"Document Title",name:"title",value:n.title,onChange:T,disabled:l}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Category ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("select",{name:"category",value:n.category,onChange:T,disabled:l,className:`w-full p-2 rounded ${v?"border border-error-500":"border border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select Category"}),Se.map(i=>e.jsx("option",{value:i,children:i},i))]}),v&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:v})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Description ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsx(xe,{value:n.description,config:{readonly:l,height:300},onBlur:i=>{const d=H(i);d?d.length<10?b("Description must be at least 10 characters"):b(""):b("Description is required"),p(r=>({...r,description:i}))}}),N&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:N})]}),!l&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Attachments (PDF / Image / Docs)",e.jsx("span",{className:"text-error-500",children:" *"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:L,className:`w-full border p-2 rounded ${V?"border-error-500":"border-gray-300"}`}),V&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:V})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!l&&e.jsx(K,{disabled:!W||A,children:A?u?"Updating...":"Publishing...":u?"Update Document":"Save Document"}),e.jsx(K,{variant:"secondary",onClick:o,children:l?"Back":"Cancel"})]})]})]})]})},ve=()=>{const o=G(),{documents:s,totalItems:u}=ae(t=>t.documentvaultmanagement),[l,g]=a.useState(0),[n,p]=a.useState(10),[A,f]=a.useState(!1),[S,y]=a.useState(null),[F,w]=a.useState(null),[I,j]=a.useState(null),[v,k]=a.useState(!1),[V,E]=a.useState(!1),[N,b]=a.useState(!1),[T,L]=a.useState(""),[U,W]=a.useState([]),[i,d]=a.useState(""),[r,h]=a.useState(""),x=a.useRef(null),[_,Y]=a.useState("all"),Z=t=>{W(t),g(0);const c={};t.forEach(({id:C,value:B})=>{B&&(c[C]=C==="isActive"?B==="Active":B)}),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{o(R({search:T,filters:c,fromDate:i||void 0,toDate:r||void 0,page:0,limit:n}))},500)};a.useEffect(()=>{i&&!r||!i&&r||o(R({fromDate:i||void 0,toDate:r||void 0,page:0,limit:n}))},[i,r]);const Q=async(t,c)=>{L(t),g(0),await o(R({search:t,fromDate:i,toDate:r,exportType:c,page:0,limit:n}))},ee=[{accessorKey:"title",header:"Document Title",filterVariant:"text"},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({cell:t})=>{const c=t.getValue()||"",C=60;return e.jsx("span",{title:c,children:c.length>C?`${c.substring(0,C)}...`:c})}},{accessorKey:"attachments",header:"File Upload",filterVariant:"text",muiTableBodyCellProps:{align:"center"},muiTableHeadCellProps:{align:"center"},Cell:({row:t})=>{const c=t.original.attachments||[];return c.length?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px"},children:c.map((C,B)=>{const M=C.split("/").pop();return e.jsx("span",{title:M,onClick:()=>window.open(C,"_blank"),style:{cursor:"pointer",color:"#1976d2",fontSize:"13px",textDecoration:"underline",textAlign:"center",wordBreak:"break-all"},children:M},B)})}):e.jsx("span",{children:"-"})}},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["Bylaws","Circulars","Certificates","Agreements"],Cell:({cell:t})=>(t.getValue(),e.jsx(O,{label:t.getValue(),color:t.getValue()==="Bylaws"?"primary":t.getValue()==="Circulars"?"secondary":t.getValue()==="Certificates"?"success":"warning",size:"small"}))},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:t})=>t.getValue()?e.jsx(O,{label:"Active",color:"success",size:"small"}):e.jsx(O,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:t})=>e.jsxs(m,{display:"flex",gap:1,children:[e.jsx(P,{title:"View",children:e.jsx(z,{onClick:()=>{y(t.original),b(!0)},children:e.jsx(ue,{})})}),e.jsx(P,{title:"Edit",children:e.jsx(z,{onClick:()=>{y(t.original),E(!1),f(!0)},children:e.jsx(ce,{})})}),e.jsx(P,{title:"Delete",children:e.jsx(z,{color:"error",onClick:()=>w(t.original._id),children:e.jsx(me,{})})}),e.jsx(pe,{checked:t.original.isActive,onChange:()=>{j(t.original._id),k(!t.original.isActive)}})]})}],te=async()=>{F&&(await o(ie(F)),w(null))};return e.jsxs(e.Fragment,{children:[e.jsx($,{show:!!F,type:"error",title:"Delete Document",message:"Are you sure you want to delete this document?",onConfirm:te,onCancel:()=>w(null)}),e.jsx($,{show:!!I,type:"warning",title:"Change Document Status",message:`Are you sure you want to ${v?"activate":"deactivate"} this document?`,confirmText:v?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{I&&o(ne(I)),j(null)},onCancel:()=>j(null)}),e.jsx(be,{open:N,data:S,onClose:()=>{b(!1),y(null)}}),A?e.jsx(we,{editData:S,isEditMode:!!S,onCancel:()=>{f(!1),y(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(D,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Document Vault Management Module",e.jsx(P,{title:"Create, publish and manage society documentThe Document Vault Module allows the Society Admin to store, manage, and share society-related documents securely.",arrow:!0,children:e.jsx(de,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(K,{onClick:()=>{y(null),f(!0)},children:[e.jsx(oe,{})," Upload Document"]})]}),e.jsx(le,{data:s,columns:ee,rowCount:u,pageIndex:l,pageSize:n,enableColumnFilters:!0,columnFilters:U,onColumnFiltersChange:Z,exportType:!0,clickHandler:Q,enableDocumenttypeFilter:!0,documentTypeValue:_,onDocumenttypeChange:t=>{Y(t),g(0),o(R({search:T,filters:t!=="all"?{category:t}:void 0,fromDate:i,toDate:r,page:0,limit:n}))},fromDate:i,toDate:r,onFromDateChange:d,onToDateChange:h,onPaginationChange:({pageIndex:t,pageSize:c})=>{g(t),p(c),o(R({search:T,filters:_!=="all"?{category:_}:void 0,page:t,limit:c}))}},_)]})]})},rt=()=>e.jsx(e.Fragment,{children:e.jsx(ve,{})});export{rt as default};
