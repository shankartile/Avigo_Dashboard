import{j as e,B as c,c as H,r,F as te,G as se,d as re,H as I,I as ne,J as ae}from"./index-CNh2Ysd7.js";import{A as oe}from"./Add-ONoAddvh.js";import{D as ie,E as le}from"./DataTable-CBDiE-I1.js";import{D as ce}from"./Delete-BKL8mfiA.js";import{V as me}from"./Visibility-CFK2wX7e.js";import{I as ue}from"./Info-BLOe8JuO.js";import{B as _}from"./Button-D2SEshHa.js";import{S as K}from"./SweetAlert-DUVT9XWx.js";import{T as de}from"./ToggleSwitch-CRLgVpk1.js";import{C as J}from"./Close-CSWdanUp.js";import{D as pe,a as he}from"./Dialog-CMeqEyOr.js";import{T as b}from"./Typography-DxP0RQcB.js";import{I as k}from"./AlertTitle-BBXxFqxI.js";import{C as V}from"./Chip--RBU-Z22.js";import{D as P}from"./Divider-1omdH51K.js";import{J as xe}from"./jodit-react-CT8-Abq2.js";import{I as fe}from"./InputField-Cac7SuVh.js";import{A as ge}from"./Alert-BBsTbpkb.js";import{T as R}from"./Tooltip-B4POfKz-.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";const ye=o=>{var u;const s=(u=o.split(".").pop())==null?void 0:u.toLowerCase();return s?["jpg","jpeg","png","gif","webp"].includes(s)?"image":s==="pdf"?"pdf":"other":"other"},je=({open:o,data:s,onClose:u})=>s?e.jsx(pe,{open:o,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",overflow:"hidden"}},children:e.jsx(he,{sx:{p:0},children:e.jsxs(c,{className:"bg-white rounded-xl",children:[e.jsxs(c,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[e.jsx(b,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"18px",fontWeight:600},children:"Documents Details"}),e.jsx(k,{sx:{color:"white"},onClick:u,children:e.jsx(J,{})})]}),e.jsxs(c,{px:6,py:4,children:[e.jsx(b,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"22px",fontWeight:600,color:"#1f2937",mb:1},children:s.title}),e.jsxs(c,{display:"flex",gap:2,mb:2,children:[e.jsx(V,{label:s.category,color:"primary"}),e.jsx(V,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error"})]}),e.jsx(P,{sx:{my:2}}),e.jsx(b,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:1},children:"Description"}),e.jsx(c,{sx:{border:"1px solid #e5e7eb",borderRadius:1,p:2,backgroundColor:"#fafafa",fontFamily:"Outfit, sans-serif",fontSize:"14px",lineHeight:"22px"},dangerouslySetInnerHTML:{__html:s.description}}),Array.isArray(s.attachments)&&s.attachments.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{my:3}}),e.jsx(b,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:2},children:"Attachments"}),e.jsx(c,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(160px, 1fr))",gap:2,children:s.attachments.map((i,p)=>{const n=ye(i),d=i.split("/").pop();return e.jsxs(c,{sx:{border:"1px solid #e5e7eb",borderRadius:"12px",p:1.5,textAlign:"center",cursor:"pointer",backgroundColor:"#fafafa","&:hover":{boxShadow:3}},onClick:()=>window.open(i,"_blank"),children:[n==="image"&&e.jsx("img",{src:i,alt:d,style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),n==="pdf"&&e.jsx("iframe",{src:i,title:d,style:{width:"100%",height:120,border:"none",borderRadius:8}}),n==="other"&&e.jsx(c,{height:120,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",sx:{fontSize:40},children:"ðŸ“„"}),e.jsx(b,{sx:{fontSize:"12px",mt:1,wordBreak:"break-all",fontFamily:"Outfit, sans-serif"},children:d})]},p)})})]}),e.jsx(P,{sx:{my:3}}),e.jsx(c,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:e.jsxs(b,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Created On:"})," ",new Date(s.createdAt).toLocaleDateString()]})})]})]})})}):null,L={title:"",category:"",description:"",attachments:[]},be=["Bylaws","Circulars","Certificates","Agreements"],Ce=({onCancel:o,editData:s,isEditMode:u,isViewMode:i=!1})=>{const p=H(),[n,d]=r.useState(L),[w,S]=r.useState(!1),[C,x]=r.useState(null),[v,D]=r.useState(""),[T,f]=r.useState(!1);r.useEffect(()=>{d(s?{title:s.title||"",category:s.category||"",description:s.description||"",attachments:[]}:L)},[s]);const A=m=>{const{name:a,value:h}=m.target;d(E=>({...E,[a]:h}))},N=m=>{const a=m.target.files;a&&d(h=>({...h,attachments:Array.from(a)}))},U=async m=>{if(m.preventDefault(),!w){S(!0);try{const a=new FormData;a.append("title",n.title),a.append("category",n.category),a.append("description",n.description),n.attachments.forEach(h=>{a.append("attachments",h)}),u&&(s!=null&&s._id)?(await p(te({_id:s._id,data:a})).unwrap(),D("Document updated successfully")):(await p(se(a)).unwrap(),D("Document published successfully")),x("success"),f(!0),setTimeout(()=>{f(!1),o()},1500)}catch(a){x("error"),D(a||"Something went wrong"),f(!0)}finally{S(!1)}}},z=n.title&&n.category&&n.description;return e.jsxs(e.Fragment,{children:[T&&C&&e.jsx(ge,{type:C,title:C==="success"?"Success!":"Error!",message:v,variant:"filled",showLink:!1,onClose:()=>f(!1)}),e.jsxs(c,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(c,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(b,{variant:"h6",children:i?"Document Details":u?"Update Document":"Upload Document"}),e.jsx(k,{sx:{color:"white"},onClick:o,children:e.jsx(J,{})})]}),e.jsxs(c,{component:"form",onSubmit:U,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(fe,{label:"Document Title",name:"title",value:n.title,onChange:A,disabled:i}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Category"}),e.jsxs("select",{name:"category",value:n.category,onChange:A,disabled:i,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select Category"}),be.map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Description"}),e.jsx(xe,{value:n.description,config:{readonly:i,height:300},onBlur:m=>d(a=>({...a,description:m}))})]}),!i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"Attachments (PDF / Image / Docs)"}),e.jsx("input",{type:"file",multiple:!0,onChange:N,className:"w-full border p-2 rounded"})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!i&&e.jsx(_,{disabled:!z||w,children:w?u?"Updating...":"Publishing...":u?"Update Document":"Save Document"}),e.jsx(_,{variant:"secondary",onClick:o,children:i?"Back":"Cancel"})]})]})]})]})},De=()=>{const o=H(),{documents:s,totalItems:u}=re(t=>t.documentvaultmanagement),[i,p]=r.useState(0),[n,d]=r.useState(10),[w,S]=r.useState(!1),[C,x]=r.useState(null),[v,D]=r.useState(null),[T,f]=r.useState(null),[A,N]=r.useState(!1),[U,z]=r.useState(!1),[m,a]=r.useState(!1),[h,E]=r.useState(""),[M,G]=r.useState([]),[g,$]=r.useState(""),[y,q]=r.useState(""),O=r.useRef(null),[B,Q]=r.useState("all"),X=t=>{G(t),p(0);const l={};t.forEach(({id:j,value:F})=>{F&&(l[j]=j==="isActive"?F==="Active":F)}),O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{o(I({search:h,filters:l,fromDate:g||void 0,toDate:y||void 0,page:0,limit:n}))},500)};r.useEffect(()=>{g&&!y||!g&&y||o(I({fromDate:g||void 0,toDate:y||void 0,page:0,limit:n}))},[g,y]);const Y=async(t,l)=>{E(t),p(0),await o(I({search:t,fromDate:g,toDate:y,exportType:l,page:0,limit:n}))},Z=[{accessorKey:"title",header:"Document Title",filterVariant:"text"},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({cell:t})=>{const l=t.getValue()||"",j=60;return e.jsx("span",{title:l,children:l.length>j?`${l.substring(0,j)}...`:l})}},{accessorKey:"attachments",header:"File Upload",filterVariant:"text",muiTableBodyCellProps:{align:"center"},muiTableHeadCellProps:{align:"center"},Cell:({row:t})=>{const l=t.original.attachments||[];return l.length?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px"},children:l.map((j,F)=>{const W=j.split("/").pop();return e.jsx("span",{title:W,onClick:()=>window.open(j,"_blank"),style:{cursor:"pointer",color:"#1976d2",fontSize:"13px",textDecoration:"underline",textAlign:"center",wordBreak:"break-all"},children:W},F)})}):e.jsx("span",{children:"-"})}},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["Bylaws","Circulars","Certificates","Agreements"],Cell:({cell:t})=>(t.getValue(),e.jsx(V,{label:t.getValue(),color:t.getValue()==="Bylaws"?"primary":t.getValue()==="Circulars"?"secondary":t.getValue()==="Certificates"?"success":"warning",size:"small"}))},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:t})=>t.getValue()?e.jsx(V,{label:"Active",color:"success",size:"small"}):e.jsx(V,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:t})=>e.jsxs(c,{display:"flex",gap:1,children:[e.jsx(R,{title:"View",children:e.jsx(k,{onClick:()=>{x(t.original),a(!0)},children:e.jsx(me,{})})}),e.jsx(R,{title:"Edit",children:e.jsx(k,{onClick:()=>{x(t.original),z(!1),S(!0)},children:e.jsx(le,{})})}),e.jsx(R,{title:"Delete",children:e.jsx(k,{color:"error",onClick:()=>D(t.original._id),children:e.jsx(ce,{})})}),e.jsx(de,{checked:t.original.isActive,onChange:()=>{f(t.original._id),N(!t.original.isActive)}})]})}],ee=async()=>{v&&(await o(ae(v)),D(null))};return e.jsxs(e.Fragment,{children:[e.jsx(K,{show:!!v,type:"error",title:"Delete Document",message:"Are you sure you want to delete this document?",onConfirm:ee,onCancel:()=>D(null)}),e.jsx(K,{show:!!T,type:"warning",title:"Change Document Status",message:`Are you sure you want to ${A?"activate":"deactivate"} this document?`,confirmText:A?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{T&&o(ne(T)),f(null)},onCancel:()=>f(null)}),e.jsx(je,{open:m,data:C,onClose:()=>{a(!1),x(null)}}),w?e.jsx(Ce,{editData:C,isEditMode:!!C,onCancel:()=>{S(!1),x(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(b,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Document Vault Management Module",e.jsx(R,{title:"Create, publish and manage society documentThe Document Vault Module allows the Society Admin to store, manage, and share society-related documents securely.",arrow:!0,children:e.jsx(ue,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(_,{onClick:()=>{x(null),S(!0)},children:[e.jsx(oe,{})," Upload Document"]})]}),e.jsx(ie,{data:s,columns:Z,rowCount:u,pageIndex:i,pageSize:n,enableColumnFilters:!0,columnFilters:M,onColumnFiltersChange:X,exportType:!0,clickHandler:Y,enableDocumenttypeFilter:!0,documentTypeValue:B,onDocumenttypeChange:t=>{Q(t),p(0),o(I({search:h,filters:t!=="all"?{category:t}:void 0,fromDate:g,toDate:y,page:0,limit:n}))},fromDate:g,toDate:y,onFromDateChange:$,onToDateChange:q,onPaginationChange:({pageIndex:t,pageSize:l})=>{p(t),d(l),o(I({search:h,filters:B!=="all"?{category:B}:void 0,page:t,limit:l}))}},B)]})]})},tt=()=>e.jsx(e.Fragment,{children:e.jsx(De,{})});export{tt as default};
