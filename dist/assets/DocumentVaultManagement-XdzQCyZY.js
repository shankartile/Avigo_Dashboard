import{j as e,c as J,r as a,B,F as ee,G as te,d as se,H as E,I as re,J as ae}from"./index-CcNgdVLz.js";import{a as ne,D as le,E as oe}from"./DataTable-DIxG5frN.js";import{D as ie}from"./Delete-BWjouR_h.js";import{V as ce}from"./Visibility-Bad1pPYX.js";import{I as me}from"./Info-BLwzYq-V.js";import{B as H}from"./Button-B4_V5GRV.js";import{S as $}from"./SweetAlert-BfCzCAJa.js";import{T as de}from"./ToggleSwitch-CZt8XOld.js";import{A as ue}from"./ArrowBack-Dpb-03kv.js";import{T as U}from"./Typography-BMOygWke.js";import{C as _}from"./Chip-YFG14ne-.js";import{D as pe}from"./Divider-BePmc644.js";import{C as he}from"./Close-eApB0hKv.js";import{J as ge}from"./jodit-react-B7Ng6XVx.js";import{I as xe}from"./InputField-BQ5ewBIw.js";import{A as fe}from"./Alert-U3gIVFWt.js";import{I as L}from"./AlertTitle-C4QpKbd8.js";import{T as P}from"./Tooltip-C-v54PpA.js";import"./createSvgIcon-ClJPFlmG.js";import"./Cancel-CkCQy-6N.js";import"./utils-BtYGnpaM.js";import"./index-CLpR2HuM.js";import"./DateTimeField-CYfYG2Su.js";import"./index-D3LyqDt4.js";import"./Dialog-BdfS6Lfy.js";import"./useSlotProps-z1QAC-gu.js";import"./CircularProgress-CVM8C023.js";import"./dividerClasses-Bv38dMpn.js";import"./Pagination-DR3bn4wR.js";import"./DialogTitle-BbPUlM9A.js";import"./Tabs-CWf6flOX.js";import"./skeleton-DjwwWlQi.js";const je=s=>{var i;const o=(i=s.split(".").pop())==null?void 0:i.toLowerCase();return o?["jpg","jpeg","png","gif","webp"].includes(o)?"image":o==="pdf"?"pdf":["doc","docx"].includes(o)?"word":"other":"other"},ye=({data:s,onClose:o})=>s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-6 pt-6 bg-white flex items-center gap-2",children:e.jsxs("button",{onClick:o,className:"flex items-center text-[#255593] hover:underline",children:[e.jsx(ue,{fontSize:"small"}),e.jsx("span",{className:"ml-1 font-medium",children:"Back"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10 px-6 py-10 bg-white",children:[e.jsxs("div",{children:[e.jsx(U,{variant:"h6",fontWeight:600,mb:2,children:"Attachments"}),Array.isArray(s.attachments)&&s.attachments.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-4",children:s.attachments.map((i,u)=>{const d=je(i),n=i.split("/").pop();return e.jsxs("div",{onClick:()=>window.open(i,"_blank"),className:"border rounded-lg p-2 bg-gray-50 hover:shadow cursor-pointer text-center",children:[d==="image"&&e.jsx("img",{src:i,alt:n,className:"h-100 w-full object-cover rounded"}),d==="pdf"&&e.jsx("iframe",{src:i,title:n,className:"h-100 w-full rounded border-none"}),d==="word"&&e.jsx("iframe",{src:`https://docs.google.com/gview?url=${encodeURIComponent(i)}&embedded=true`,title:n,className:"h-100 w-full rounded border-none"}),d==="other"&&e.jsx("div",{className:"h-100 flex items-center justify-center text-4xl",children:"ðŸ“Ž"}),e.jsx("p",{className:"text-xs mt-2 break-all text-gray-700",children:n})]},u)})}):e.jsx("p",{className:"text-gray-500",children:"No attachments available"})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(U,{variant:"h6",fontWeight:600,children:s.title}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(_,{label:s.category,color:"primary",size:"small"}),e.jsx(_,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error",size:"small"})]})]}),e.jsx(pe,{sx:{borderColor:"#255593",borderBottomWidth:"2px",mb:3}}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),e.jsx("div",{className:"text-gray-800 text-sm leading-6",dangerouslySetInnerHTML:{__html:s.description}})]}),e.jsx("div",{className:"grid grid-cols-2 gap-y-4 gap-x-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Created On"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(s.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})]})})]})]})]}):null,be=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],O=s=>s.replace(/<[^>]*>/g,"").trim(),Ce=5*1024*1024,M={title:"",category:"",description:"",attachments:[]},ve=["Bylaws","Circulars","Certificates","Agreements"],De=({onCancel:s,editData:o,isEditMode:i,isViewMode:u=!1})=>{const d=J(),[n,x]=a.useState(M),[S,h]=a.useState(!1),[C,f]=a.useState(null),[N,v]=a.useState(""),[A,j]=a.useState(!1),[D,I]=a.useState(""),[T,F]=a.useState(""),[k,y]=a.useState("");a.useEffect(()=>{x(o?{title:o.title||"",category:o.category||"",description:o.description||"",attachments:[]}:M)},[o]);const w=l=>{const{name:m,value:r}=l.target;m==="category"&&I(r?"":"Category is required"),x(p=>({...p,[m]:r}))},R=l=>{const m=l.target.files;if(!m)return;const r=Array.from(m);let p="";r.length===0&&(p="At least one attachment is required");for(const g of r){if(!be.includes(g.type)){p="Only PDF, Image, or Doc files are allowed";break}if(g.size>Ce){p="Each file must be less than 5 MB";break}}if(p){F(p),x(g=>({...g,attachments:[]})),l.target.value="";return}F(""),x(g=>({...g,attachments:r}))},q=async l=>{if(l.preventDefault(),!n.category){I("Category is required"),h(!1);return}const m=O(n.description);if(!m){y("Description is required"),h(!1);return}if(m.length<10){y("Description must be at least 10 characters"),h(!1);return}if(!i&&n.attachments.length===0){F("Attachments are required"),h(!1);return}if(!S){h(!0);try{const r=new FormData;r.append("title",n.title),r.append("category",n.category),r.append("description",n.description),n.attachments.forEach(p=>{r.append("attachments",p)}),i&&(o!=null&&o._id)?(await d(ee({_id:o._id,data:r})).unwrap(),v("Document updated successfully")):(await d(te(r)).unwrap(),v("Document published successfully")),f("success"),j(!0),setTimeout(()=>{j(!1),s()},1500)}catch(r){f("error"),v(r||"Something went wrong"),j(!0)}finally{h(!1)}}},K=!!n.title&&!!n.category&&O(n.description).length>=10&&!k&&!D&&!T;return e.jsxs(e.Fragment,{children:[A&&C&&e.jsx(fe,{type:C,title:C==="success"?"Success!":"Error!",message:N,variant:"filled",showLink:!1,onClose:()=>j(!1)}),e.jsxs(B,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(B,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(U,{variant:"h6",children:u?"Document Details":i?"Update Document":"Upload Document"}),e.jsx(L,{sx:{color:"white"},onClick:s,children:e.jsx(he,{})})]}),e.jsxs(B,{component:"form",onSubmit:q,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(xe,{label:"Document Title",name:"title",value:n.title,onChange:w,disabled:u}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Category ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("select",{name:"category",value:n.category,onChange:w,disabled:u,className:`w-full p-2 rounded ${D?"border border-error-500":"border border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select Category"}),ve.map(l=>e.jsx("option",{value:l,children:l},l))]}),D&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:D})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Description ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsx(ge,{value:n.description,config:{readonly:u,height:300},onBlur:l=>{const m=O(l);m?m.length<10?y("Description must be at least 10 characters"):y(""):y("Description is required"),x(r=>({...r,description:l}))}}),k&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:k})]}),!u&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Attachments (PDF / Image / Docs)",e.jsx("span",{className:"text-error-500",children:" *"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:R,className:`w-full border p-2 rounded ${T?"border-error-500":"border-gray-300"}`}),T&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:T})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!u&&e.jsx(H,{disabled:!K||S,children:S?i?"Updating...":"Publishing...":i?"Update Document":"Save Document"}),e.jsx(H,{variant:"secondary",onClick:s,children:u?"Back":"Cancel"})]})]})]})]})},we=()=>{const s=J(),{documents:o,totalItems:i}=se(t=>t.documentvaultmanagement),[u,d]=a.useState(0),[n,x]=a.useState(10),[S,h]=a.useState(!1),[C,f]=a.useState(null),[N,v]=a.useState(null),[A,j]=a.useState(null),[D,I]=a.useState(!1),[T,F]=a.useState(!1),[k,y]=a.useState(!1),[w,R]=a.useState(""),[q,K]=a.useState([]),[l,m]=a.useState(""),[r,p]=a.useState(""),g=a.useRef(null),[z,G]=a.useState("all"),X=t=>{K(t),d(0);const c={};t.forEach(({id:b,value:V})=>{V&&(c[b]=b==="isActive"?V==="Active":V)}),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{s(E({search:w,filters:c,fromDate:l||void 0,toDate:r||void 0,page:0,limit:n}))},500)};a.useEffect(()=>{l&&!r||!l&&r||s(E({fromDate:l||void 0,toDate:r||void 0,page:0,limit:n}))},[l,r]);const Y=async(t,c)=>{R(t),d(0),await s(E({search:t,fromDate:l,toDate:r,exportType:c,page:0,limit:n}))},Z=[{accessorKey:"title",header:"Document Title",filterVariant:"text"},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({cell:t})=>{const c=t.getValue()||"",b=60;return e.jsx("span",{title:c,children:c.length>b?`${c.substring(0,b)}...`:c})}},{accessorKey:"attachments",header:"File Upload",filterVariant:"text",muiTableBodyCellProps:{align:"center"},muiTableHeadCellProps:{align:"center"},Cell:({row:t})=>{const c=t.original.attachments||[];return c.length?e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px"},children:c.map((b,V)=>{const W=b.split("/").pop();return e.jsx("span",{title:W,onClick:()=>window.open(b,"_blank"),style:{cursor:"pointer",color:"#1976d2",fontSize:"13px",textDecoration:"underline",textAlign:"center",wordBreak:"break-all"},children:W},V)})}):e.jsx("span",{children:"-"})}},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["Bylaws","Circulars","Certificates","Agreements"],Cell:({cell:t})=>(t.getValue(),e.jsx(_,{label:t.getValue(),color:t.getValue()==="Bylaws"?"primary":t.getValue()==="Circulars"?"secondary":t.getValue()==="Certificates"?"success":"warning",size:"small"}))},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:t})=>t.getValue()?e.jsx(_,{label:"Active",color:"success",size:"small"}):e.jsx(_,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:t})=>e.jsxs(B,{display:"flex",gap:1,children:[e.jsx(P,{title:"View",children:e.jsx(L,{onClick:()=>{f(t.original),y(!0)},children:e.jsx(ce,{})})}),e.jsx(P,{title:"Edit",children:e.jsx(L,{onClick:()=>{f(t.original),F(!1),h(!0)},children:e.jsx(oe,{})})}),e.jsx(P,{title:"Delete",children:e.jsx(L,{color:"error",onClick:()=>v(t.original._id),children:e.jsx(ie,{})})}),e.jsx(de,{checked:t.original.isActive,onChange:()=>{j(t.original._id),I(!t.original.isActive)}})]})}],Q=async()=>{N&&(await s(ae(N)),v(null))};return e.jsxs(e.Fragment,{children:[e.jsx($,{show:!!N,type:"error",title:"Delete Document",message:"Are you sure you want to delete this document?",onConfirm:Q,onCancel:()=>v(null)}),e.jsx($,{show:!!A,type:"warning",title:"Change Document Status",message:`Are you sure you want to ${D?"activate":"deactivate"} this document?`,confirmText:D?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{A&&s(re(A)),j(null)},onCancel:()=>j(null)}),k?e.jsx(ye,{data:C,onClose:()=>{y(!1),f(null)}}):S?e.jsx(De,{editData:C,isEditMode:!!C,onCancel:()=>{h(!1),f(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(B,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(U,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Document Vault Management Module",e.jsx(P,{title:"Create, publish and manage society documentThe Document Vault Module allows the Society Admin to store, manage, and share society-related documents securely.",arrow:!0,children:e.jsx(me,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(H,{onClick:()=>{f(null),h(!0)},children:[e.jsx(ne,{})," Upload Document"]})]}),e.jsx(le,{data:o,columns:Z,rowCount:i,pageIndex:u,pageSize:n,enableColumnFilters:!0,columnFilters:q,onColumnFiltersChange:X,exportType:!0,clickHandler:Y,enableDocumenttypeFilter:!0,documentTypeValue:z,onDocumenttypeChange:t=>{G(t),d(0),s(E({search:w,filters:t!=="all"?{category:t}:void 0,fromDate:l,toDate:r,page:0,limit:n}))},fromDate:l,toDate:r,onFromDateChange:m,onToDateChange:p,onPaginationChange:({pageIndex:t,pageSize:c})=>{d(t),x(c),s(E({search:w,filters:z!=="all"?{category:z}:void 0,page:t,limit:c}))}},z)]})]})},rt=()=>e.jsx(e.Fragment,{children:e.jsx(we,{})});export{rt as default};
