import{r,c as pe,d as W,E as fe,eM as f,j as e,B as m,eN as he}from"./index-CNh2Ysd7.js";import{I as ge}from"./Info-BLOe8JuO.js";import{D as xe}from"./Delete-BKL8mfiA.js";import{V as ye}from"./Visibility-CFK2wX7e.js";import{C as R}from"./Close-CSWdanUp.js";import{D as je}from"./DataTable-CBDiE-I1.js";import{B as Ce}from"./Button-D2SEshHa.js";import{S as Se}from"./SweetAlert-DUVT9XWx.js";import{A as U}from"./Alert-BBsTbpkb.js";import{I as F}from"./InputField-Cac7SuVh.js";import{T as h}from"./Typography-DxP0RQcB.js";import{T as z}from"./Tooltip-B4POfKz-.js";import{D as _,a as H}from"./Dialog-CMeqEyOr.js";import{D as be}from"./DialogTitle-sP3uGIgc.js";import{I as b}from"./AlertTitle-BBXxFqxI.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./Chip--RBU-Z22.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";const we=()=>{const[w,Z]=r.useState({_id:"",username:"",contact:"",message:"",email:"",createdAt:"",updatedAt:"",isActive:!1}),u=pe(),{enquiryListing:De,loading:Ee}=W(t=>t.enquirylisting),[O,ke]=r.useState(null),[p,L]=r.useState(null),[D,Y]=r.useState(""),[x,y]=r.useState(0),[g,G]=r.useState(10),[n,N]=r.useState(null),[j,P]=r.useState(""),[v,C]=r.useState(!1),[M,E]=r.useState(!1),[V,k]=r.useState(null),[J,T]=r.useState(!1),[Te,qe]=r.useState([]),[S,Q]=r.useState([]),[l,X]=r.useState(""),[c,$]=r.useState(""),[Ae,Ie]=r.useState(""),[d,B]=r.useState("dealer"),[q,ee]=fe(),[Fe,te]=r.useState(!1),{enquiryListing:se=[],totalItems:re}=W(t=>t.enquirylisting),ie=se.map(t=>({...t,id:t._id}));r.useEffect(()=>{const t=setTimeout(()=>{const s={};S.forEach(({id:a,value:i})=>{i&&(a==="isActive"?s[a]=i==="Active":typeof i=="string"&&i.trim()?s[a]=i.trim():s[a]=i)}),u(f({filters:s,search:D,page:x,limit:g,type:d==="dealer"?"":"buyer"}))},500);return()=>clearTimeout(t)},[D,x,g,d,S,l,c]),r.useEffect(()=>{const t=q.get("type");(t==="dealer"||t==="buyer")&&t!==d&&B(t),te(!0)},[]);const A=r.useRef(null),ae=t=>{Q(t),y(0);const s={};t.forEach(({id:i,value:o})=>{o&&(i==="isActive"?s[i]=o==="Active":typeof o=="string"&&o.trim()?s[i]=o.trim():s[i]=o)});const a={filters:s,type:d,fromDate:l,toDate:c,page:x,limit:g};A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{u(f(a))},500)},ne=async(t,s)=>{Y(t),y(0),s&&await u(f({type:d,fromDate:l,toDate:c,search:t,exportType:s}))},oe=t=>{L(t)},K=()=>{L(null)},le=t=>{k(t),T(!0)},I=t=>{const{name:s,value:a}=t.target;Z(i=>({...i,[s]:a}))},ce=async()=>{if(V){try{await u(he({_id:V,type:d})).unwrap(),N("error"),P("Enquiry deleted successfully."),u(f({page:x,limit:g}))}catch(t){N("error"),P("Delete failed: "+t)}C(!0),setTimeout(()=>C(!1),3e3),T(!1),k(null)}},de=()=>{T(!1),k(null)};r.useEffect(()=>{if(l&&!c||!l&&c)return;u(f({fromDate:l||void 0,toDate:c||void 0,type:d}))},[l,c]);const ue=(t,s=50)=>t?t.length>s?t.slice(0,s)+"...":t:"",me=[{accessorKey:"username",header:"Username",filterVariant:"text"},{accessorKey:"email",header:"Email",filterVariant:"text"},{accessorKey:"contact",header:"Contact",filterVariant:"text"},{accessorKey:"message",header:"Message",filterVariant:"text",Cell:({row:t})=>ue(t.original.message,30)},{accessorKey:"createdAt",header:"Enquiry Date",Cell:({row:t})=>{const s=t.original.createdAt,a=s?new Date(s).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"}):"";return e.jsx("span",{children:a})}},{header:"Actions",Cell:({row:t})=>e.jsxs(m,{display:"flex",gap:1,children:[e.jsx(z,{title:"View Enquiry",arrow:!0,children:e.jsx(b,{color:"primary",onClick:()=>oe(t.original),children:e.jsx(ye,{})})}),e.jsx(b,{color:"error",onClick:()=>le(t.original._id),children:e.jsx(xe,{})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(Se,{show:J,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this enquiry?",onConfirm:ce,onCancel:de,confirmText:"Yes",cancelText:"No"}),v&&n&&e.jsx("div",{className:"p-4",children:e.jsx(U,{type:n,title:n==="success"?"Success!":n==="error"&&j.toLowerCase().includes("deleted")?"Deleted!":n==="error"?"Error!":"Warning!",message:j,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>C(!1)})}),M?e.jsxs(_,{open:M,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:[e.jsxs(m,{sx:{background:"linear-gradient( #255593 103.05%)",height:25,p:4,position:"relative"},children:[e.jsx(be,{className:"font-outfit",sx:{color:"white",position:"absolute",top:5},children:O!==null?"Edit Enquiry Listing":"Add Enquiry"}),e.jsx(b,{sx:{position:"absolute",top:12,right:12},onClick:()=>E(!1),children:e.jsx(R,{})})]}),e.jsxs(H,{children:[v&&n&&e.jsx("div",{className:"mb-4",children:e.jsx(U,{type:n,title:n==="success"?"Success!":n==="error"&&j.toLowerCase().includes("deleted")?"Deleted!":n==="error"?"Error!":"Warning!",message:j,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>C(!1)})}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{label:"Username",name:"username",value:w.username,onChange:I}),e.jsx(F,{label:"Contact",name:"contact",value:w.contact,onChange:I}),e.jsx(F,{label:"Message",name:"message",value:w.message,onChange:I})]}),e.jsx(m,{display:"flex",justifyContent:"center",gap:6,mt:4,children:e.jsx(Ce,{variant:"secondary",onClick:()=>E(!1),className:"rounded-[25px]",children:"Cancel"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(m,{ml:2,children:e.jsxs(h,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Enquiry Listing   ",e.jsx(z,{title:"View website enquiries submitted through the Contact Us form, including dealer and buyer-related queries.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(ge,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})})}),e.jsx(je,{exportType:!0,clickHandler:ne,data:ie,columns:me,enableColumnFilters:!0,columnFilters:S,onColumnFiltersChange:ae,rowCount:re,pageIndex:x,pageSize:g,enablefeedbacktypeFilter:!0,productTypeValue:d,onFeedbacktypeChange:t=>{B(t),y(0),q.set("type",t),ee(q),u(f({search:D,type:d,page:0,limit:g}))},onPaginationChange:({pageIndex:t,pageSize:s})=>{y(t),G(s);const a={};S.forEach(({id:i,value:o})=>{o&&(a[i]=i==="isActive"?o==="Active":o)}),u(f({filters:a,fromDate:l,toDate:c,page:t,limit:s}))},fromDate:l,toDate:c,onFromDateChange:X,onToDateChange:$})]}),e.jsx(_,{open:!!p,onClose:K,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(m,{className:"rounded-xl overflow-hidden",children:[e.jsxs(m,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(h,{className:"font-outfit",variant:"h6",children:"Enquiry Details"}),e.jsx(b,{sx:{color:"white"},onClick:K,children:e.jsx(R,{})})]}),e.jsx(H,{children:p&&e.jsxs(m,{display:"flex",flexDirection:"column",gap:2,children:[e.jsxs(h,{className:"font-outfit",children:[e.jsx("strong",{children:"Username:"})," ",p.username]}),e.jsxs(h,{className:"font-outfit",children:[e.jsx("strong",{children:"Contact:"})," ",p.contact]}),e.jsxs(h,{className:"font-outfit",children:[e.jsx("strong",{children:"Email:"})," ",p.email]}),e.jsxs(h,{className:"font-outfit",children:[e.jsx("strong",{children:"Date:"})," ",new Date(p.createdAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),e.jsxs(h,{className:"font-outfit",children:[e.jsx("strong",{children:"Message:"})," ",p.message]})]})})]})})]})},ot=()=>e.jsx(e.Fragment,{children:e.jsx(we,{})});export{ot as default};
