import{c as te,d as K,r,E as se,dX as h,j as e,B as f,dY as re,dZ as ae}from"./index-CcNgdVLz.js";import{I as oe}from"./Info-BLwzYq-V.js";import{V as ie}from"./Visibility-Bad1pPYX.js";import{D as ne}from"./Delete-BWjouR_h.js";import{C as le}from"./Close-eApB0hKv.js";import{D as ce}from"./DataTable-DIxG5frN.js";import{A as de}from"./Alert-U3gIVFWt.js";import{S as me}from"./SweetAlert-BfCzCAJa.js";import{T as o}from"./Typography-BMOygWke.js";import{R as L}from"./Rating-B1ZGYeno.js";import{T as D}from"./Tooltip-C-v54PpA.js";import{I as N}from"./AlertTitle-C4QpKbd8.js";import{D as ue,a as fe}from"./Dialog-BdfS6Lfy.js";import"./createSvgIcon-ClJPFlmG.js";import"./Cancel-CkCQy-6N.js";import"./utils-BtYGnpaM.js";import"./index-CLpR2HuM.js";import"./DateTimeField-CYfYG2Su.js";import"./index-D3LyqDt4.js";import"./useSlotProps-z1QAC-gu.js";import"./CircularProgress-CVM8C023.js";import"./Chip-YFG14ne-.js";import"./dividerClasses-Bv38dMpn.js";import"./Pagination-DR3bn4wR.js";import"./DialogTitle-BbPUlM9A.js";import"./Divider-BePmc644.js";import"./Tabs-CWf6flOX.js";import"./skeleton-DjwwWlQi.js";import"./Button-B4_V5GRV.js";const pe=()=>{const u=te(),T=K(t=>t.feedback.feedbacks),B=K(t=>t.feedback.totalItems),[c,W]=r.useState(""),[d,O]=r.useState(""),[a,I]=r.useState("dealer"),[i,y]=r.useState(null),[x,w]=r.useState("info"),[A,P]=r.useState(""),[U,b]=r.useState(!1),[j,E]=r.useState(""),[S,g]=r.useState(0),[p,Z]=r.useState(10),[M,H]=r.useState([]),[V,he]=r.useState(""),[xe,Y]=r.useState(!1),[k,X]=se(),[q,F]=r.useState(!1),[v,R]=r.useState(null);r.useEffect(()=>{const t=setTimeout(()=>{u(h({fromDate:c,toDate:d,search:j,searchField:V,type:a==="dealer"?"":"buyer",page:S,limit:p}))},500);return()=>clearTimeout(t)},[j,S,p,a,V]),r.useEffect(()=>{const t=k.get("type");(t==="dealer"||t==="buyer")&&t!==a&&I(t),Y(!0)},[]);const C=r.useRef(null),G=t=>{H(t),g(0);const s={};t.forEach(({id:m,value:l})=>{l&&(m==="isActive"?s[m]=l==="Active":typeof l=="string"&&l.trim()?s[m]=l.trim():s[m]=l)});const n={type:a,filters:s,fromDate:c,toDate:d,page:0,limit:p};C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{u(h(n))},500)},J=async()=>{if(v)try{await u(ae({id:v,type:a})).unwrap(),w("error"),P("Feedback deleted successfully"),setTimeout(()=>{b(!1)},1e3)}catch{w("error"),P("Failed to delete feedback")}finally{b(!0),F(!1),R(null)}},Q=async(t,s)=>{E(t),g(0),s&&await u(re({fromDate:c,toDate:d,type:a,search:t,exportType:s}))},_=()=>{y(null)},z=t=>y(t);T.filter(t=>a==="dealer"?!0:t.type===a);const $=(t,s=50)=>t?t.length>s?t.slice(0,s)+"...":t:"";r.useEffect(()=>{if(c&&!d||!c&&d)return;u(h({fromDate:c||void 0,toDate:d||void 0,type:a}))},[c,d]);const ee=r.useMemo(()=>{const t=[{accessorKey:"userType",header:"Submitted by",filterVariant:"text"},{accessorFn:s=>s.userName||"N/A",id:"userName",header:"User Name",filterVariant:"text"}];return a==="dealer"?t.push({accessorFn:s=>s.userEmail,id:"userEmail",header:"Email",filterVariant:"text"}):a==="buyer"&&t.push({accessorFn:s=>s.phone,id:"userPhone",header:"Mobile No",filterVariant:"text"}),t.push({accessorKey:"comment",header:"Feedback",filterVariant:"text",Cell:({row:s})=>e.jsx(o,{sx:{cursor:"pointer",fontFamily:"outfit",fontSize:"14px"},onClick:()=>z(s.original),children:$(s.original.comment,30)})},{accessorKey:"rating",header:"Rating",Cell:({cell:s})=>{const n=Number(s.getValue()??0);return e.jsxs(f,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(L,{value:n>0?1:0,max:1,readOnly:!0,size:"small"}),e.jsx(o,{className:"font-outfit",variant:"body2",children:n.toFixed(1)})]})}},{accessorKey:"submissionDate",header:"Submission Date",Cell:({row:s})=>{const n=s.original.submissionDate,m=n?new Date(n).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"}):"";return e.jsx("span",{children:m})}},{header:"Actions",Cell:({row:s})=>e.jsxs(f,{display:"flex",gap:1,children:[e.jsx(D,{title:"View",children:e.jsx(N,{color:"primary",onClick:()=>z(s.original),children:e.jsx(ie,{})})}),e.jsx(D,{title:"Delete",children:e.jsx(N,{color:"error",onClick:()=>{R(s.original.id),F(!0)},children:e.jsx(ne,{})})})]})}),t},[a]);return e.jsxs(e.Fragment,{children:[U&&e.jsx(de,{type:x,title:x==="success"?"Success!":x==="error"&&A.toLowerCase().includes("deleted")?"Deleted!":x==="error"?"Error!":"Warning!",message:A,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>b(!1)}),e.jsx(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(f,{ml:2,children:e.jsxs(o,{className:"font-outfit",variant:"h5",fontWeight:500,children:["Feedback Management  ",e.jsx(D,{title:"View and manage feedback submitted by dealers and buyers from their respective applications.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(oe,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})})}),e.jsx(ce,{exportType:!0,clickHandler:Q,onSearchChange:t=>E(t),enableColumnFilters:!0,columnFilters:M,onColumnFiltersChange:G,data:T,enablefeedbacktypeFilter:!0,productTypeValue:a,onFeedbacktypeChange:t=>{I(t),g(0),k.set("type",t),X(k),u(h({search:j,type:a,page:0,limit:p}))},fromDate:c,toDate:d,onFromDateChange:W,onToDateChange:O,columns:ee,rowCount:B,pageIndex:S,pageSize:p,onPaginationChange:({pageIndex:t,pageSize:s})=>{g(t),Z(s);const n={};M.forEach(({id:m,value:l})=>{l&&(n[m]=m==="isActive"?l==="Active":l)}),u(h({filters:n,fromDate:c,toDate:d,page:t,limit:s}))}},a),e.jsx(me,{show:q,type:"error",title:"Delete Confirmation",message:"Are you sure you want to delete this feedback?",onConfirm:J,onCancel:()=>F(!1),confirmText:"Yes",cancelText:"No"}),e.jsx(ue,{open:!!i,onClose:()=>y(null),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(f,{className:"rounded-xl overflow-hidden",children:[e.jsxs(f,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(o,{className:"font-outfit",variant:"h6",children:"Feedback Details"}),e.jsx(N,{sx:{color:"white"},onClick:_,children:e.jsx(le,{})})]}),e.jsx(fe,{children:i&&e.jsxs(f,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"Submitted By:"})," ",i.userType]}),e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"User Name:"})," ",i.userName]}),a!=="buyer"&&e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"Email:"})," ",i.userEmail]}),a!=="dealer"&&e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"Mobile No:"})," ",i.phone]}),e.jsxs(o,{className:"font-outfit flex items-center gap-1",children:[e.jsx("strong",{children:"Rating:"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{value:i.rating>0?1:0,max:1,readOnly:!0,size:"small"}),i.rating.toFixed(1)]})]}),e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"Date:"})," ",new Date(i.submissionDate).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),e.jsxs(o,{className:"font-outfit",children:[e.jsx("strong",{children:"Message:"})," ",i.comment]})]})})]})})]})},Ye=()=>e.jsx(e.Fragment,{children:e.jsx(pe,{})});export{Ye as default};
