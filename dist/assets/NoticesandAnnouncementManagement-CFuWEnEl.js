import{j as e,B as c,c as $,r as s,o as Q,p as ee,d as te,q,v as se,w as re}from"./index-N8t8oMzR.js";import{C as ae,D as ne,E as ie}from"./DataTable-BqUD-dAi.js";import{D as oe}from"./Delete-07TAjR17.js";import{V as le}from"./Visibility-CgGAKN6P.js";import{I as ce}from"./Info-lyeC1xGk.js";import{C as de}from"./Campaign-LYI21L9a.js";import{B as W}from"./Button-CBNcrDpD.js";import{S as K}from"./SweetAlert-vzLgp13W.js";import{T as me}from"./ToggleSwitch-DR4b514_.js";import{C as J}from"./Close-CwR_quIe.js";import{D as ue,a as pe}from"./Dialog-BGF2t3L7.js";import{T as x}from"./Typography-CKlLxaDL.js";import{I as E}from"./AlertTitle-D9ejxV9_.js";import{C as P}from"./Chip-Dnlh_trd.js";import{D as G}from"./Divider-TBuFGUUO.js";import{J as fe}from"./jodit-react-CujUNROP.js";import{I as he}from"./InputField-riaj6edy.js";import{A as xe}from"./Alert-CgNUKTJk.js";import{T as O}from"./Tooltip-CwyNn424.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./DialogTitle-D6DEKDqS.js";import"./Tabs-BUaZVZQS.js";import"./skeleton-CrFh5em0.js";const ge=({open:l,data:a,onClose:m})=>a?e.jsx(ue,{open:l,onClose:m,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",overflow:"hidden"}},children:e.jsx(pe,{sx:{p:0},children:e.jsxs(c,{className:"bg-white rounded-xl",children:[e.jsxs(c,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[e.jsx(x,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"18px",fontWeight:600},children:"Notice Details"}),e.jsx(E,{sx:{color:"white"},onClick:m,children:e.jsx(J,{})})]}),e.jsxs(c,{px:6,py:4,children:[e.jsx(x,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"22px",fontWeight:600,color:"#1f2937",mb:1},children:a.title}),e.jsxs(c,{display:"flex",gap:2,mb:2,children:[e.jsx(P,{label:a.category,color:"primary"}),e.jsx(P,{label:a.isActive?"Active":"Inactive",color:a.isActive?"success":"error"})]}),e.jsx(G,{sx:{my:2}}),e.jsx(x,{sx:{fontFamily:"Outfit, sans-serif",fontSize:"15px",fontWeight:600,mb:1},children:"Description"}),e.jsx(c,{sx:{border:"1px solid #e5e7eb",borderRadius:1,p:2,backgroundColor:"#fafafa",fontFamily:"Outfit, sans-serif",fontSize:"14px",lineHeight:"22px"},dangerouslySetInnerHTML:{__html:a.description}}),e.jsx(G,{sx:{my:3}}),e.jsxs(c,{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,children:[e.jsxs(x,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Acknowledge Required:"})," ",a.acknowledgeRequired?"Yes":"No"]}),e.jsxs(x,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Read Count:"})," ",a.readCount]}),e.jsxs(x,{sx:{fontFamily:"Outfit, sans-serif"},children:[e.jsx("strong",{children:"Created On:"})," ",new Date(a.createdAt).toLocaleDateString()]})]})]})]})})}):null,je=["application/pdf","image/jpeg","image/png","image/jpg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],L=l=>l.replace(/<[^>]*>/g,"").trim(),ye=5*1024*1024,U={title:"",category:"",description:"",acknowledgeRequired:!1,attachments:[]},Ce=["General","Emergency","Finance","Event"],be=({onCancel:l,editData:a,isEditMode:m,isViewMode:u=!1})=>{const N=$(),[i,h]=s.useState(U),[D,p]=s.useState(!1),[y,g]=s.useState(null),[I,C]=s.useState(""),[T,j]=s.useState(!1),[b,k]=s.useState(""),[R,S]=s.useState(""),[v,A]=s.useState("");s.useEffect(()=>{h(a?{title:a.title||"",category:a.category||"",description:a.description||"",acknowledgeRequired:a.acknowledgeRequired||!1,attachments:[]}:U)},[a]);const F=r=>{const{name:o,value:t}=r.target;o==="category"&&A(t?"":"Category is required"),h(d=>({...d,[o]:t}))},B=r=>{const o=r.target.files;if(!o)return;const t=Array.from(o);let d="";t.length===0&&(d="At least one attachment is required");for(const f of t){if(!je.includes(f.type)){d="Only PDF, Image, or Doc files are allowed";break}if(f.size>ye){d="Each file must be less than 5 MB";break}}if(d){k(d),h(f=>({...f,attachments:[]})),r.target.value="";return}k(""),h(f=>({...f,attachments:t}))},V=async r=>{if(r.preventDefault(),!i.category){A("Category is required"),p(!1);return}const o=L(i.description);if(!o){S("Description is required"),p(!1);return}if(o.length<10){S("Description must be at least 10 characters"),p(!1);return}if(!m&&i.attachments.length===0){k("Attachments are required"),p(!1);return}if(!D){p(!0);try{const t=new FormData;t.append("title",i.title),t.append("category",i.category),t.append("description",i.description),t.append("acknowledgeRequired",String(i.acknowledgeRequired)),i.attachments.forEach(d=>{t.append("attachments",d)}),m&&(a!=null&&a._id)?(await N(Q({_id:a._id,data:t})).unwrap(),C("Notice updated successfully")):(await N(ee(t)).unwrap(),C("Notice published successfully")),g("success"),j(!0),setTimeout(()=>{j(!1),l()},1500)}catch(t){g("error"),C(t||"Something went wrong"),j(!0)}finally{p(!1)}}},_=!!i.title&&!!i.category&&L(i.description).length>=10&&!R&&!v&&!b;return e.jsxs(e.Fragment,{children:[T&&y&&e.jsx(xe,{type:y,title:y==="success"?"Success!":"Error!",message:I,variant:"filled",showLink:!1,onClose:()=>j(!1)}),e.jsxs(c,{className:"max-w-4xl mx-auto rounded-xl shadow-md bg-white",children:[e.jsxs(c,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(x,{variant:"h6",children:u?"Notice Details":m?"Update Notice":"Create Notice"}),e.jsx(E,{sx:{color:"white"},onClick:l,children:e.jsx(J,{})})]}),e.jsxs(c,{component:"form",onSubmit:V,px:6,py:4,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(he,{label:"Notice Title",name:"title",value:i.title,onChange:F,disabled:u}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Category ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsxs("select",{name:"category",value:i.category,onChange:F,disabled:u,className:`w-full p-2 rounded ${v?"border border-error-500":"border border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select Category"}),Ce.map(r=>e.jsx("option",{value:r,children:r},r))]}),v&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:v})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Description ",e.jsx("span",{className:"text-error-500",children:"*"})]}),e.jsx(fe,{value:i.description,config:{readonly:u,height:300},onBlur:r=>{const o=L(r);o?o.length<10?S("Description must be at least 10 characters"):S(""):S("Description is required"),h(t=>({...t,description:r}))}}),R&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:R})]}),!u&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:["Attachments (PDF / Image / Docs)",e.jsx("span",{className:"text-error-500",children:" *"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:B,className:`w-full border p-2 rounded ${b?"border-error-500":"border-gray-300"}`}),b&&e.jsx("p",{className:"mt-1 text-xs text-error-500",children:b})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(ae,{checked:i.acknowledgeRequired,onChange:r=>h(o=>({...o,acknowledgeRequired:r.target.checked})),disabled:u}),e.jsxs(x,{children:["Acknowledge Required ",e.jsx("span",{className:"text-error-500",children:"*"})]})]}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[!u&&e.jsx(W,{disabled:!_||D,children:D?m?"Updating...":"Publishing...":m?"Update Notice":"Publish Notice"}),e.jsx(W,{variant:"secondary",onClick:l,children:u?"Back":"Cancel"})]})]})]})]})},Se=()=>{const l=$(),{notices:a,totalItems:m}=te(n=>n.noticesandannouncement),[u,N]=s.useState(0),[i,h]=s.useState(10),[D,p]=s.useState(!1),[y,g]=s.useState(null),[I,C]=s.useState(null),[T,j]=s.useState(null),[b,k]=s.useState(!1),[R,S]=s.useState(!1),[v,A]=s.useState(!1),[F,B]=s.useState(""),[V,_]=s.useState([]),[r,o]=s.useState(""),[t,d]=s.useState(""),f=s.useRef(null),M=n=>{_(n),N(0);const w={};n.forEach(({id:H,value:z})=>{z&&(w[H]=H==="isActive"?z==="Active":z)}),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{l(q({search:F,filters:w,fromDate:r||void 0,toDate:t||void 0,page:0,limit:i}))},500)};s.useEffect(()=>{r&&!t||!r&&t||l(q({fromDate:r||void 0,toDate:t||void 0,page:0,limit:i}))},[r,t]);const Y=async(n,w)=>{B(n),N(0),await l(q({search:n,fromDate:r,toDate:t,exportType:w,page:0,limit:i}))},X=[{accessorKey:"title",header:"Title",filterVariant:"text"},{accessorKey:"category",header:"Category",filterVariant:"select",filterSelectOptions:["General","Emergency","Finance","Event"]},{accessorKey:"createdAt",header:"Created Date",filterVariant:"text"},{accessorKey:"readCount",header:"Read Count",filterVariant:"text",muiTableBodyCellProps:{align:"center"},muiTableHeadCellProps:{align:"center"},Cell:({cell:n})=>e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"#ff9800",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,mx:"auto"},children:n.getValue()})},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:n})=>n.getValue()?e.jsx(P,{label:"Active",color:"success",size:"small"}):e.jsx(P,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:n})=>e.jsxs(c,{display:"flex",gap:1,children:[e.jsx(O,{title:"View",children:e.jsx(E,{onClick:()=>{g(n.original),A(!0)},children:e.jsx(le,{})})}),e.jsx(O,{title:"Edit",children:e.jsx(E,{onClick:()=>{g(n.original),S(!1),p(!0)},children:e.jsx(ie,{})})}),e.jsx(O,{title:"Delete",children:e.jsx(E,{color:"error",onClick:()=>C(n.original._id),children:e.jsx(oe,{})})}),e.jsx(me,{checked:n.original.isActive,onChange:()=>{j(n.original._id),k(!n.original.isActive)}})]})}],Z=async()=>{I&&(await l(re(I)),C(null))};return e.jsxs(e.Fragment,{children:[e.jsx(K,{show:!!I,type:"error",title:"Delete Notice",message:"Are you sure you want to delete this notice?",onConfirm:Z,onCancel:()=>C(null)}),e.jsx(K,{show:!!T,type:"warning",title:"Change Notice Status",message:`Are you sure you want to ${b?"activate":"deactivate"} this notice?`,confirmText:b?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{T&&l(se(T)),j(null)},onCancel:()=>j(null)}),e.jsx(ge,{open:v,data:y,onClose:()=>{A(!1),g(null)}}),D?e.jsx(be,{editData:y,isEditMode:!!y,onCancel:()=>{p(!1),g(null)}}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(x,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Notices & Announcements Management Module",e.jsx(O,{title:"Create, publish and manage society notices and announcements.",arrow:!0,children:e.jsx(ce,{sx:{color:"#245492",ml:1}})})]}),e.jsxs(W,{onClick:()=>{g(null),p(!0)},children:[e.jsx(de,{})," Create Notice"]})]}),e.jsx(ne,{data:a,columns:X,rowCount:m,pageIndex:u,pageSize:i,enableColumnFilters:!0,columnFilters:V,onColumnFiltersChange:M,exportType:!0,clickHandler:Y,fromDate:r,toDate:t,onFromDateChange:o,onToDateChange:d,onPaginationChange:({pageIndex:n,pageSize:w})=>{N(n),h(w),l(q({search:F,page:n,limit:w}))}})]})]})},tt=()=>e.jsx(e.Fragment,{children:e.jsx(Se,{})});export{tt as default};
