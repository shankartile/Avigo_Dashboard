import{aH as D,aI as A,aJ as me,r as i,j as s,g as fe,c as pe,a as we,B as U,b}from"./index-CcNgdVLz.js";import{I as E}from"./InputField-BQ5ewBIw.js";import{B as T}from"./Button-B4_V5GRV.js";import{A as he}from"./Alert-U3gIVFWt.js";import{L as ge}from"./Label-C8N3GYzz.js";import{T as Pe}from"./Typography-BMOygWke.js";import{T as xe,a as re}from"./Tabs-CWf6flOX.js";import"./utils-BtYGnpaM.js";import"./createSvgIcon-ClJPFlmG.js";import"./AlertTitle-C4QpKbd8.js";import"./CircularProgress-CVM8C023.js";import"./useSlotProps-z1QAC-gu.js";const Oe={profilesetting:[],loading:!1,error:null,passwordChangeStatus:"idle",requestEmailOtpStatus:"idle",verifyEmailOtpStatus:"idle",requestPasswordOtpStatus:"idle",verifyPasswordOtpStatus:"idle"},q=D("profile/requestEmailChangeOtp",async({adminId:r,oldEmail:e,newEmail:n},{rejectWithValue:d})=>{var t;try{return(await A.post("admin/auth/request-email-change-otp",{adminId:r,oldEmail:e,newEmail:n})).data}catch(o){return d(((t=o.response)==null?void 0:t.data)||{message:"Failed to request email change OTP"})}}),I=D("profile/verifyEmailChangeOtp",async({adminId:r,newEmail:e,enteredOtp:n},{rejectWithValue:d})=>{var t,o;try{return(await A.post("admin/auth/verify-email-change-otp",{adminId:r,newEmail:e,enteredOtp:n})).data}catch(g){return d(((o=(t=g.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to verify email OTP")}}),R=D("profile/requestPasswordChangeOtp",async({email:r,newPassword:e,confirmNewPassword:n},{rejectWithValue:d})=>{var t;try{return(await A.post("admin/auth/request-password-change-otp",{email:r,newPassword:e,confirmNewPassword:n})).data}catch(o){return d(((t=o.response)==null?void 0:t.data)||{message:"Failed to request password OTP"})}}),k=D("profile/verifyPasswordChangeOtp",async({email:r,enteredOtp:e,newPassword:n,confirmNewPassword:d},{rejectWithValue:t})=>{var o,g;try{return(await A.post("admin/auth/verify-password-change-otp",{email:r,enteredOtp:e,newPassword:n,confirmNewPassword:d})).data}catch(f){return t(((g=(o=f.response)==null?void 0:o.data)==null?void 0:g.message)||"Failed to verify password OTP")}});me({name:"profilesetting",initialState:Oe,reducers:{},extraReducers:r=>{r.addCase(q.pending,e=>{e.requestEmailOtpStatus="loading"}).addCase(q.fulfilled,e=>{e.requestEmailOtpStatus="success"}).addCase(q.rejected,(e,n)=>{e.requestEmailOtpStatus="error",e.error=n.payload}).addCase(I.pending,e=>{e.verifyEmailOtpStatus="loading"}).addCase(I.fulfilled,(e,n)=>{var d;e.verifyEmailOtpStatus="success",e.profilesetting.length>0&&(e.profilesetting=e.profilesetting.map(t=>t._id===n.meta.arg.adminId?{...t,email:n.meta.arg.newEmail}:t)),e.successMessage=((d=n.payload.data)==null?void 0:d.message)||"Email updated successfully"}).addCase(I.rejected,(e,n)=>{e.verifyEmailOtpStatus="error",e.error=n.payload}).addCase(R.pending,e=>{e.requestPasswordOtpStatus="loading"}).addCase(R.fulfilled,e=>{e.requestPasswordOtpStatus="success"}).addCase(R.rejected,(e,n)=>{e.requestPasswordOtpStatus="error",e.error=n.payload}).addCase(k.pending,e=>{e.verifyPasswordOtpStatus="loading"}).addCase(k.fulfilled,e=>{e.verifyPasswordOtpStatus="success"}).addCase(k.rejected,(e,n)=>{e.verifyPasswordOtpStatus="error",e.error=n.payload})}});const ne=({showOtp:r,onChangeOtp:e})=>{const[n,d]=i.useState(["","","",""]),t=i.useRef([]),[o,g]=i.useState(null),f=(u,c)=>{var y;if(!/^\d*$/.test(u))return;const m=[...n];m[c]=u,d(m),g(c),setTimeout(()=>g(null),150),u&&c<3&&((y=t.current[c+1])==null||y.focus()),e&&e(m.join(""))},F=(u,c)=>{var m;u.key==="Backspace"&&!n[c]&&c>0&&((m=t.current[c-1])==null||m.focus())},w=u=>{var m;const c=u.clipboardData.getData("Text").slice(0,4);if(/^\d{4}$/.test(c)){const y=c.split("");d(y),y.forEach((x,j)=>{t.current[j]&&(t.current[j].value=x)}),(m=t.current[3])==null||m.focus(),e&&e(c)}u.preventDefault()};return i.useEffect(()=>{var u;r&&((u=t.current[0])==null||u.focus())},[r]),r?s.jsxs("div",{children:[s.jsxs(ge,{className:"block mb-2",children:["Enter OTP ",s.jsx("span",{className:"text-error-500",children:"*"})]}),s.jsx("div",{className:"flex gap-3",children:n.map((u,c)=>s.jsx(E,{type:"text",variant:"otp",value:u?"*":"",onChange:m=>f(m.target.value,c),className:`${o===c?"animate-ping-fast":""}`,inputProps:{inputMode:"numeric",maxLength:1,onKeyDown:m=>F(m,c),onPaste:w},ref:m=>{t.current[c]=m}},c))})]}):null},ye=()=>{const r=fe(),e=(r==null?void 0:r.id)||"",n=(r==null?void 0:r.email)||"",d=pe(),[t,o]=i.useState(null),[g,f]=i.useState(""),[F,w]=i.useState(!1),[u,c]=i.useState(0),[m,y]=i.useState(""),[x,j]=i.useState({newEmail:""}),[V,_]=i.useState(!1),[W,B]=i.useState(""),[P,L]=i.useState({newPassword:"",confirmNewPassword:""}),[H,M]=i.useState(!1),[K,J]=i.useState(""),[$,z]=i.useState(""),[ie,C]=i.useState(60),[G,S]=i.useState(!1),p=i.useRef(null),[le,Q]=i.useState(60),[X,Y]=i.useState(!1),v=i.useRef(null),N=(r==null?void 0:r.role)||"",Z=(r==null?void 0:r.email)||"",ee=we();i.useEffect(()=>()=>{p.current&&clearInterval(p.current)},[]),i.useEffect(()=>()=>{p.current&&clearInterval(p.current),v.current&&clearInterval(v.current)},[]);const oe=(l,a)=>{c(a),_(!1),M(!1),B(""),J("")},ce=l=>{j({...x,[l.target.name]:l.target.value})},se=l=>{const{name:a,value:h}=l.target,O={...P,[a]:h};L(O),O.newPassword&&O.confirmNewPassword&&O.newPassword!==O.confirmNewPassword?z("Passwords do not match"):z("")},te=async()=>{var l;try{await d(q({adminId:e,oldEmail:n,newEmail:x.newEmail})).unwrap(),_(!0),o("success"),f("OTP sent to Mobile no"),Q(60),Y(!1),v.current&&clearInterval(v.current),v.current=setInterval(()=>{Q(a=>a===1?(clearInterval(v.current),Y(!0),0):a-1)},1e3)}catch(a){const h=(l=a==null?void 0:a.meta)==null?void 0:l.waitTime;o("error"),(a==null?void 0:a.code)==="OTP_COOLDOWN"&&h?f(`Please wait ${h} seconds before requesting another OTP.`):f((a==null?void 0:a.message)||"Failed to send OTP")}finally{w(!0),setTimeout(()=>w(!1),3e3)}},de=async()=>{try{await d(I({adminId:e,newEmail:x.newEmail,enteredOtp:W})).unwrap(),y(x.newEmail),o("success"),f("Email changed successfully"),_(!1),j({newEmail:""}),B(""),setTimeout(()=>{N==="admin"?b("admin_user"):N==="staff"&&b("staff_user"),ee("/",{replace:!0})},2e3)}catch(l){o("error"),f((l==null?void 0:l.message)||"Failed to verify OTP")}finally{w(!0),setTimeout(()=>w(!1),3e3)}},ae=async()=>{var l;try{await d(R({email:Z,newPassword:P.newPassword,confirmNewPassword:P.confirmNewPassword})).unwrap(),M(!0),o("success"),f("OTP sent for password change"),setTimeout(()=>w(!1),3e3),L({newPassword:"",confirmNewPassword:""}),C(60),S(!1),p.current&&clearInterval(p.current),p.current=setInterval(()=>{C(h=>h===1?(clearInterval(p.current),S(!0),0):h-1)},1e3)}catch(a){const h=(l=a==null?void 0:a.meta)==null?void 0:l.waitTime;o("error"),(a==null?void 0:a.code)==="OTP_COOLDOWN"&&h?(f(`Please wait ${h} seconds before requesting another OTP.`),C(h),S(!1),p.current&&clearInterval(p.current),p.current=setInterval(()=>{C(O=>O===1?(clearInterval(p.current),S(!0),0):O-1)},1e3)):f((a==null?void 0:a.message)||"Failed to send password OTP")}finally{w(!0)}},ue=async()=>{try{await d(k({email:Z,enteredOtp:K,newPassword:P.newPassword,confirmNewPassword:P.confirmNewPassword})).unwrap(),o("success"),f("Password changed successfully"),M(!1),L({newPassword:"",confirmNewPassword:""}),setTimeout(()=>{N==="admin"?b("admin_user"):N==="staff"&&b("staff_user"),ee("/",{replace:!0})},2e3)}catch(l){o("error"),f((l==null?void 0:l.message)||"Failed to verify OTP")}finally{w(!0),setTimeout(()=>w(!1),4e3)}};return s.jsxs(s.Fragment,{children:[F&&t&&s.jsx("div",{className:"p-4",children:s.jsx(he,{type:t,title:t==="success"?"Success!":t==="error"?"Error!":"Warning!",message:g,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>w(!1)})}),s.jsxs(U,{className:"max-w-6xl mx-auto rounded-xl shadow-md",sx:{backgroundColor:"white"},children:[s.jsx(U,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:s.jsx(Pe,{className:"font-outfit",variant:"h6",children:"Profile Settings"})}),s.jsxs(xe,{value:u,onChange:oe,variant:"fullWidth",children:[s.jsx(re,{className:"font-outfit",label:"Update Admin Email"}),s.jsx(re,{className:"font-outfit",label:"Change Admin Password"})]}),s.jsxs(U,{component:"div",px:6,py:4,children:[u===0&&s.jsxs(s.Fragment,{children:[!V&&s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(E,{label:"Current Email",name:"oldEmail",value:n,disabled:!0}),s.jsx(E,{label:"New Email",name:"newEmail",value:x.newEmail,onChange:ce})]}),V?s.jsxs("div",{className:"flex flex-col items-center justify-center mt-6",children:[s.jsx(ne,{showOtp:!0,onChangeOtp:l=>B(l)}),s.jsx("div",{className:"mt-4 text-center",children:X?s.jsx(T,{onClick:te,variant:"customBlue",children:"Resend OTP"}):s.jsxs("p",{className:"text-sm text-error-500",children:["OTP expires in ",le," sec"]})}),!X&&s.jsx("div",{className:"mt-4 text-center",children:s.jsx(T,{onClick:de,disabled:!W,children:"Verify & Update"})})]}):s.jsx("div",{className:"mt-6 text-center",children:s.jsx(T,{onClick:te,disabled:!x.newEmail.trim(),children:"Request OTP"})})]}),u===1&&s.jsxs(s.Fragment,{children:[!H&&s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(E,{label:"New Password",type:"password",name:"newPassword",value:P.newPassword,onChange:se}),s.jsx(E,{label:"Confirm Password",type:"password",name:"confirmNewPassword",value:P.confirmNewPassword,onChange:se,error:!!$,helperText:$})]}),H?s.jsxs("div",{className:"flex flex-col items-center justify-center mt-6",children:[s.jsx(ne,{showOtp:!0,onChangeOtp:l=>J(l)}),s.jsx("div",{className:"mt-4 text-center",children:G?s.jsx(T,{onClick:ae,variant:"customBlue",children:"Resend OTP"}):s.jsxs("p",{className:"text-sm text-error-500",children:[" OTP expires in ",ie," sec"]})}),!G&&s.jsx("div",{className:"mt-4 text-center",children:s.jsx(T,{onClick:ue,disabled:!K,children:"Verify & Update"})})]}):s.jsx("div",{className:"mt-6 text-center",children:s.jsx(T,{onClick:ae,disabled:!P.newPassword||!P.confirmNewPassword||$!=="",children:"Request OTP"})})]})]})]})]})},De=()=>s.jsx(s.Fragment,{children:s.jsx(ye,{})});export{De as default};
