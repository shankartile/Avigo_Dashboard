import{r as c,c as M,j as a,B as D,aG as X,aH as T,aI as F,g as L,aJ as Y,d as Z}from"./index-CcNgdVLz.js";import{A as ee}from"./Add-CQx2oSmS.js";import{D as te,E as ae}from"./DataTable-DIxG5frN.js";import{D as se}from"./Delete-BWjouR_h.js";import{V as ie}from"./Visibility-Bad1pPYX.js";import{I as ne}from"./Info-BLwzYq-V.js";import{B as $}from"./Button-B4_V5GRV.js";import{S as re}from"./SweetAlert-BfCzCAJa.js";import{T as oe}from"./ToggleSwitch-CZt8XOld.js";import{C as le}from"./Close-eApB0hKv.js";import{I as B}from"./InputField-BQ5ewBIw.js";import{A as ce}from"./Alert-U3gIVFWt.js";import{T as z}from"./Typography-BMOygWke.js";import{I as k}from"./AlertTitle-C4QpKbd8.js";import{T as P}from"./Tooltip-C-v54PpA.js";import{C as K}from"./Chip-YFG14ne-.js";const de={name:"",email:"",mobile:""},me=({onCancel:s,society:e})=>{const[t,i]=c.useState(de),[n,o]=c.useState(!1),[d,A]=c.useState(null),[f,C]=c.useState(""),[p,u]=c.useState(!1),v=M(),l=h=>{const{name:I,value:E}=h.target;i(m=>({...m,[I]:E}))},g=async h=>{if(h.preventDefault(),n||!(e!=null&&e._id)){A("error"),C("Society not selected. Please select a society first."),u(!0);return}o(!0);try{await v(X({societyId:e._id,adminName:t.name,adminEmail:t.email,adminPhone:t.mobile})).unwrap(),A("success"),C("Society admin assigned successfully"),u(!0),setTimeout(()=>{u(!1),s()},1200)}catch(I){A("error"),C(I||"Failed to assign admin"),u(!0)}finally{o(!1)}},b=t.name&&t.email&&t.mobile;return a.jsxs(a.Fragment,{children:[p&&d&&a.jsx(ce,{type:d,title:d==="success"?"Success!":"Error!",message:f,variant:"filled",showLink:!1,onClose:()=>u(!1)}),a.jsxs(D,{className:"max-w-3xl mx-auto rounded-xl shadow-md bg-white",children:[a.jsxs(D,{sx:{background:"linear-gradient(#255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[a.jsx(z,{variant:"h6",children:"Assign Society Admin"}),a.jsx(k,{sx:{color:"white"},onClick:s,children:a.jsx(le,{})})]}),a.jsxs(D,{component:"form",onSubmit:g,px:6,py:4,children:[e&&a.jsxs(z,{className:"font-outfit mb-4 text-sm text-gray-600",children:["Society: ",a.jsx("strong",{children:e.societyName})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(B,{label:"Admin Name",name:"name",value:t.name,onChange:l}),a.jsx(B,{label:"Admin Email",name:"email",value:t.email,onChange:l}),a.jsx(B,{label:"Admin Mobile Number",name:"mobile",value:t.mobile,onChange:l})]}),a.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[a.jsx($,{disabled:!b||n,children:n?"Assigning...":"Assign Admin"}),a.jsx($,{variant:"secondary",onClick:s,children:"Cancel"})]})]})]})]})},ue={admins:[],totalItems:0,totalPages:0,currentPage:0,loading:!1,error:null},R=T("societyAdmin/create",async(s,{rejectWithValue:e})=>{var t,i,n;try{const o=(t=L())==null?void 0:t.accessToken;return(await F.post("society-admin",s,{headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}}})).data.data}catch(o){return e(((n=(i=o.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to create society admin")}}),j=T("societyAdmin/fetch",async({search:s="",page:e=0,limit:t=10,filters:i,fromDate:n,toDate:o,exportType:d},{rejectWithValue:A})=>{var f,C,p,u,v;try{const l=new URLSearchParams;s&&l.append("search",s),e!==void 0&&l.append("page",String(e+1)),t&&l.append("limit",String(t)),n&&l.append("fromDate",n),o&&l.append("toDate",o),d&&l.append("exportType",d),i&&Object.entries(i).forEach(([b,h])=>{h!==void 0&&h!==""&&l.append(`filters[${b}]`,String(h))});const g=await F.get(`society-admin?${l.toString()}`);return{data:g.data.data,totalPages:((f=g.data.pagination)==null?void 0:f.totalPages)||1,currentPage:((C=g.data.pagination)==null?void 0:C.currentPage)||1,totalItems:((p=g.data.pagination)==null?void 0:p.totalItems)||0}}catch(l){return A(((v=(u=l.response)==null?void 0:u.data)==null?void 0:v.message)||"Failed to fetch society admins")}}),_=T("societyAdmin/update",async({_id:s,...e},{rejectWithValue:t})=>{var i,n,o;try{const d=(i=L())==null?void 0:i.accessToken;return(await F.put(`society-admin/${s}`,e,{headers:{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`}:{}}})).data.data}catch(d){return t(((o=(n=d.response)==null?void 0:n.data)==null?void 0:o.message)||"Failed to update admin")}}),H=T("societyAdmin/delete",async(s,{rejectWithValue:e})=>{var t,i;try{return await F.delete(`society-admin/${s}`),s}catch(n){return e(((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to delete admin")}}),O=T("societyAdmin/toggleStatus",async(s,{rejectWithValue:e})=>{var t,i;try{const n=await F.patch(`society-admin/${s}/toggle-status`);return{_id:s,isActive:n.data.data.isActive}}catch(n){return e(((i=(t=n.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to toggle status")}});Y({name:"societyAdmin",initialState:ue,reducers:{},extraReducers:s=>{s.addCase(R.pending,e=>{e.loading=!0,e.error=null}).addCase(R.fulfilled,(e,t)=>{e.loading=!1,e.admins.unshift(t.payload)}).addCase(R.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(j.pending,e=>{e.loading=!0,e.error=null}).addCase(j.fulfilled,(e,t)=>{e.loading=!1,e.admins=t.payload.data,e.totalPages=t.payload.totalPages,e.currentPage=t.payload.currentPage,e.totalItems=t.payload.totalItems}).addCase(j.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(_.pending,e=>{e.loading=!0,e.error=null}).addCase(_.fulfilled,(e,t)=>{e.loading=!1;const i=e.admins.findIndex(n=>n._id===t.payload._id);i!==-1&&(e.admins[i]=t.payload)}).addCase(_.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(H.fulfilled,(e,t)=>{e.loading=!1,e.admins=e.admins.filter(i=>i._id!==t.payload)}).addCase(O.fulfilled,(e,t)=>{const i=e.admins.findIndex(n=>n._id===t.payload._id);i!==-1&&(e.admins[i].isActive=t.payload.isActive)})}});const Fe=()=>{const s=M(),{societies:e,totalItems:t}=Z(r=>r.society),[i,n]=c.useState(0),[o,d]=c.useState(10),[A,f]=c.useState(!1),[C,p]=c.useState(null),[u,v]=c.useState(null),[l,g]=c.useState(null),[b,h]=c.useState(""),[I,E]=c.useState([]),[m,U]=c.useState(""),[y,G]=c.useState(""),N=c.useRef(null),J=r=>{E(r),n(0);const x={};r.forEach(({id:w,value:S})=>{S&&(w==="isActive"?x[w]=S==="Active":typeof S=="string"&&S.trim()&&(x[w]=S.trim()))}),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{s(j({search:b,filters:x,fromDate:m||void 0,toDate:y||void 0,page:0,limit:o}))},500)};c.useEffect(()=>{m&&!y||!m&&y||s(j({fromDate:m||void 0,toDate:y||void 0,page:0,limit:o}))},[m,y]);const W=async(r,x)=>{h(r),n(0),x?await s(j({search:r,fromDate:m,toDate:y,exportType:x})):s(j({search:r,fromDate:m,toDate:y,page:0,limit:o}))},q=[{accessorKey:"name",header:"Admin Name",filterVariant:"text"},{accessorKey:"email",header:"Email",filterVariant:"text"},{accessorKey:"mobile",header:"Mobile",filterVariant:"text"},{accessorKey:"societyName",header:"Society",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:r})=>r.getValue()?a.jsx(K,{label:"Active",color:"success",size:"small"}):a.jsx(K,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:r})=>a.jsxs(D,{display:"flex",gap:1,children:[a.jsx(P,{title:"View",children:a.jsx(k,{onClick:()=>{p(r.original),f(!0)},children:a.jsx(ie,{})})}),a.jsx(P,{title:"Edit",children:a.jsx(k,{onClick:()=>{p(r.original),f(!0)},children:a.jsx(ae,{})})}),a.jsx(P,{title:"Delete",children:a.jsx(k,{color:"error",onClick:()=>g(r.original._id),children:a.jsx(se,{})})}),a.jsx(oe,{checked:r.original.isActive,onChange:()=>s(O(r.original._id))})]})}],Q=async()=>{l&&(await s(H(l)),g(null))};return a.jsxs(a.Fragment,{children:[a.jsx(re,{show:!!l,type:"error",title:"Delete Admin",message:"Are you sure you want to delete this admin?",onConfirm:Q,onCancel:()=>g(null)}),A?a.jsx(me,{society:u,onCancel:()=>{f(!1),p(null)}}):a.jsxs(a.Fragment,{children:[a.jsxs(D,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsxs(z,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Assign Society Admin"," ",a.jsx(P,{title:"Create society admin, edit and manage society admin.",arrow:!0,children:a.jsx(ne,{sx:{color:"#245492",cursor:"pointer",ml:1}})})]}),a.jsxs($,{onClick:()=>{p(null),f(!0)},children:[a.jsx(ee,{})," Add Admin"]})]}),a.jsx(te,{data:e,columns:q,rowCount:t,pageIndex:i,pageSize:o,enableColumnFilters:!0,columnFilters:I,onColumnFiltersChange:J,exportType:!0,clickHandler:W,fromDate:m,toDate:y,onFromDateChange:U,onToDateChange:G,onPaginationChange:({pageIndex:r,pageSize:x})=>{n(r),d(x);const w={};I.forEach(({id:S,value:V})=>{V&&(w[S]=S==="isActive"?V==="Active":V)}),s(j({search:b,filters:w,fromDate:m,toDate:y,page:r,limit:x}))}})]})]})};export{me as A,Fe as S};
