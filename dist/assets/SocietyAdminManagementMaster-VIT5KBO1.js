import{aG as C,aH as j,g as K,aI as W,c as q,d as J,r as c,j as a,B as $}from"./index-CNh2Ysd7.js";import{A as Q}from"./Add-ONoAddvh.js";import{D as X,E as Y}from"./DataTable-CBDiE-I1.js";import{D as Z}from"./Delete-BKL8mfiA.js";import{V as ee}from"./Visibility-CFK2wX7e.js";import{I as te}from"./Info-BLOe8JuO.js";import{B as ae}from"./Button-D2SEshHa.js";import{S as ie}from"./SweetAlert-DUVT9XWx.js";import{T as se}from"./ToggleSwitch-CRLgVpk1.js";import{A as oe}from"./AssignSocietyAdminDialog-BWHtSgSO.js";import{T as re}from"./Typography-DxP0RQcB.js";import{T as F}from"./Tooltip-B4POfKz-.js";import{C as z}from"./Chip--RBU-Z22.js";import{I as k}from"./AlertTitle-BBXxFqxI.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./Close-CSWdanUp.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./Dialog-CMeqEyOr.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";import"./InputField-Cac7SuVh.js";import"./Alert-BBsTbpkb.js";const ne={admins:[],totalItems:0,totalPages:0,currentPage:0,loading:!1,error:null},E=C("societyAdmin/create",async(s,{rejectWithValue:e})=>{var t,i,o;try{const n=(t=K())==null?void 0:t.accessToken;return(await j.post("society-admin",s,{headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}}})).data.data}catch(n){return e(((o=(i=n.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to create society admin")}}),y=C("societyAdmin/fetch",async({search:s="",page:e=0,limit:t=10,filters:i,fromDate:o,toDate:n,exportType:d},{rejectWithValue:I})=>{var h,P,A,D,w;try{const l=new URLSearchParams;s&&l.append("search",s),e!==void 0&&l.append("page",String(e+1)),t&&l.append("limit",String(t)),o&&l.append("fromDate",o),n&&l.append("toDate",n),d&&l.append("exportType",d),i&&Object.entries(i).forEach(([T,x])=>{x!==void 0&&x!==""&&l.append(`filters[${T}]`,String(x))});const f=await j.get(`society-admin?${l.toString()}`);return{data:f.data.data,totalPages:((h=f.data.pagination)==null?void 0:h.totalPages)||1,currentPage:((P=f.data.pagination)==null?void 0:P.currentPage)||1,totalItems:((A=f.data.pagination)==null?void 0:A.totalItems)||0}}catch(l){return I(((w=(D=l.response)==null?void 0:D.data)==null?void 0:w.message)||"Failed to fetch society admins")}}),V=C("societyAdmin/update",async({_id:s,...e},{rejectWithValue:t})=>{var i,o,n;try{const d=(i=K())==null?void 0:i.accessToken;return(await j.put(`society-admin/${s}`,e,{headers:{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`}:{}}})).data.data}catch(d){return t(((n=(o=d.response)==null?void 0:o.data)==null?void 0:n.message)||"Failed to update admin")}}),R=C("societyAdmin/delete",async(s,{rejectWithValue:e})=>{var t,i;try{return await j.delete(`society-admin/${s}`),s}catch(o){return e(((i=(t=o.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to delete admin")}}),_=C("societyAdmin/toggleStatus",async(s,{rejectWithValue:e})=>{var t,i;try{const o=await j.patch(`society-admin/${s}/toggle-status`);return{_id:s,isActive:o.data.data.isActive}}catch(o){return e(((i=(t=o.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to toggle status")}});W({name:"societyAdmin",initialState:ne,reducers:{},extraReducers:s=>{s.addCase(E.pending,e=>{e.loading=!0,e.error=null}).addCase(E.fulfilled,(e,t)=>{e.loading=!1,e.admins.unshift(t.payload)}).addCase(E.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(y.pending,e=>{e.loading=!0,e.error=null}).addCase(y.fulfilled,(e,t)=>{e.loading=!1,e.admins=t.payload.data,e.totalPages=t.payload.totalPages,e.currentPage=t.payload.currentPage,e.totalItems=t.payload.totalItems}).addCase(y.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(V.pending,e=>{e.loading=!0,e.error=null}).addCase(V.fulfilled,(e,t)=>{e.loading=!1;const i=e.admins.findIndex(o=>o._id===t.payload._id);i!==-1&&(e.admins[i]=t.payload)}).addCase(V.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(R.fulfilled,(e,t)=>{e.loading=!1,e.admins=e.admins.filter(i=>i._id!==t.payload)}).addCase(_.fulfilled,(e,t)=>{const i=e.admins.findIndex(o=>o._id===t.payload._id);i!==-1&&(e.admins[i].isActive=t.payload.isActive)})}});const le=()=>{const s=q(),{societies:e,totalItems:t}=J(r=>r.society),[i,o]=c.useState(0),[n,d]=c.useState(10),[I,h]=c.useState(!1),[P,A]=c.useState(null),[D,w]=c.useState(null),[l,f]=c.useState(null),[T,x]=c.useState(""),[B,M]=c.useState([]),[m,N]=c.useState(""),[p,H]=c.useState(""),v=c.useRef(null),O=r=>{M(r),o(0);const u={};r.forEach(({id:S,value:g})=>{g&&(S==="isActive"?u[S]=g==="Active":typeof g=="string"&&g.trim()&&(u[S]=g.trim()))}),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{s(y({search:T,filters:u,fromDate:m||void 0,toDate:p||void 0,page:0,limit:n}))},500)};c.useEffect(()=>{m&&!p||!m&&p||s(y({fromDate:m||void 0,toDate:p||void 0,page:0,limit:n}))},[m,p]);const U=async(r,u)=>{x(r),o(0),u?await s(y({search:r,fromDate:m,toDate:p,exportType:u})):s(y({search:r,fromDate:m,toDate:p,page:0,limit:n}))},G=[{accessorKey:"name",header:"Admin Name",filterVariant:"text"},{accessorKey:"email",header:"Email",filterVariant:"text"},{accessorKey:"mobile",header:"Mobile",filterVariant:"text"},{accessorKey:"societyName",header:"Society",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:r})=>r.getValue()?a.jsx(z,{label:"Active",color:"success",size:"small"}):a.jsx(z,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:r})=>a.jsxs($,{display:"flex",gap:1,children:[a.jsx(F,{title:"View",children:a.jsx(k,{onClick:()=>{A(r.original),h(!0)},children:a.jsx(ee,{})})}),a.jsx(F,{title:"Edit",children:a.jsx(k,{onClick:()=>{A(r.original),h(!0)},children:a.jsx(Y,{})})}),a.jsx(F,{title:"Delete",children:a.jsx(k,{color:"error",onClick:()=>f(r.original._id),children:a.jsx(Z,{})})}),a.jsx(se,{checked:r.original.isActive,onChange:()=>s(_(r.original._id))})]})}],L=async()=>{l&&(await s(R(l)),f(null))};return a.jsxs(a.Fragment,{children:[a.jsx(ie,{show:!!l,type:"error",title:"Delete Admin",message:"Are you sure you want to delete this admin?",onConfirm:L,onCancel:()=>f(null)}),I?a.jsx(oe,{society:D,onCancel:()=>{h(!1),A(null)}}):a.jsxs(a.Fragment,{children:[a.jsxs($,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsxs(re,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Assign Society Admin"," ",a.jsx(F,{title:"Create society admin, edit and manage society admin.",arrow:!0,children:a.jsx(te,{sx:{color:"#245492",cursor:"pointer",ml:1}})})]}),a.jsxs(ae,{onClick:()=>{A(null),h(!0)},children:[a.jsx(Q,{})," Add Admin"]})]}),a.jsx(X,{data:e,columns:G,rowCount:t,pageIndex:i,pageSize:n,enableColumnFilters:!0,columnFilters:B,onColumnFiltersChange:O,exportType:!0,clickHandler:U,fromDate:m,toDate:p,onFromDateChange:N,onToDateChange:H,onPaginationChange:({pageIndex:r,pageSize:u})=>{o(r),d(u);const S={};B.forEach(({id:g,value:b})=>{b&&(S[g]=g==="isActive"?b==="Active":b)}),s(y({search:T,filters:S,fromDate:m,toDate:p,page:r,limit:u}))}})]})]})},Ne=()=>a.jsx(a.Fragment,{children:a.jsx(le,{})});export{Ne as default};
