import{c as W,d as G,r as a,k as m,j as t,t as J,B as D,l as Q}from"./index-CNh2Ysd7.js";import{D as X,E as Y}from"./DataTable-CBDiE-I1.js";import{D as Z}from"./Delete-BKL8mfiA.js";import{V as w}from"./Visibility-CFK2wX7e.js";import{I as ee}from"./Info-BLOe8JuO.js";import{S as R}from"./SweetAlert-DUVT9XWx.js";import{T as te}from"./ToggleSwitch-CRLgVpk1.js";import{A as ie}from"./AddResident-DKKIcfwr.js";import{T as se}from"./Typography-DxP0RQcB.js";import{T as u}from"./Tooltip-B4POfKz-.js";import{C as v}from"./Chip--RBU-Z22.js";import{I as C}from"./AlertTitle-BBXxFqxI.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./Close-CSWdanUp.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./Dialog-CMeqEyOr.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";import"./Button-D2SEshHa.js";import"./InputField-Cac7SuVh.js";import"./Alert-BBsTbpkb.js";const ae=()=>{const o=W(),{residents:I,totalItems:E}=G(i=>i.adminresident),[V,g]=a.useState(0),[d,N]=a.useState(10),[A,p]=a.useState(!1),[F,h]=a.useState(null),[z,re]=a.useState(null),[f,x]=a.useState(null),[S,y]=a.useState(null),[T,M]=a.useState(!1),[b,K]=a.useState(""),[k,P]=a.useState([]),[r,B]=a.useState(""),[n,L]=a.useState(""),j=a.useRef(null),$=i=>{P(i),g(0);const s={};i.forEach(({id:l,value:e})=>{e&&(s[l]=l==="isActive"?e==="Active":e)}),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{o(m({search:b,filters:s,fromDate:r||void 0,toDate:n||void 0,page:0,limit:d}))},500)};a.useEffect(()=>{r&&!n||!r&&n||o(m({fromDate:r||void 0,toDate:n||void 0,page:0,limit:d}))},[r,n]);const q=async(i,s)=>{K(i),g(0),await o(m({search:i,fromDate:r,toDate:n,exportType:s,page:0,limit:d}))},_=i=>{if(!i||!i.length){console.error("Excel file is empty");return}const s=[],l=[];if(i.forEach((e,U)=>{const c=U+2;if(!e.residentName){s.push({row:c,message:"Resident Name is required"});return}if(!e.residentType){s.push({row:c,message:"Resident Type is required"});return}if(!e.mobile||!/^[6-9]\d{9}$/.test(String(e.mobile))){s.push({row:c,message:"Invalid mobile number"});return}if(e.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e.email))){s.push({row:c,message:"Invalid email format"});return}if(e.residentFlatsize&&(isNaN(e.residentFlatsize)||Number(e.residentFlatsize)<=0)){s.push({row:c,message:"Invalid flat size"});return}l.push({residentName:String(e.residentName).trim(),residentType:String(e.residentType).trim(),email:e.email?String(e.email).trim():"",mobile:String(e.mobile).trim(),residentFlatsize:e.residentFlatsize?Number(e.residentFlatsize):null,residentFlatarea:e.residentFlatarea?String(e.residentFlatarea).trim():"",residentParkingname:e.residentParkingname?String(e.residentParkingname).trim():"",secondresidentName:e.secondresidentName?String(e.secondresidentName).trim():"",secondresidentEmail:e.secondresidentEmail?String(e.secondresidentEmail).trim():"",secondresidentMobile:e.secondresidentMobile?String(e.secondresidentMobile).trim():""})}),s.length){console.error("Excel Validation Errors:",s);return}console.log("Validated Excel Data:",l)},H=[{accessorKey:"residentName",header:"Resident Name",filterVariant:"text"},{accessorKey:"residentType",header:"Resident Type",filterVariant:"text"},{accessorKey:"email",header:"Email",filterVariant:"text"},{accessorKey:"mobile",header:"Mobile",filterVariant:"text"},{accessorKey:"societyName",header:"Society",filterVariant:"text"},{accessorKey:"residentFlatsize",header:"Resident Flat Size",filterVariant:"text"},{accessorKey:"residentFlatarea",header:"Resident Flat Area",filterVariant:"text"},{accessorKey:"residentParkingname",header:"Parking Name",filterVariant:"text"},{accessorKey:"secondresidentName",header:"Secondary Resident Name",filterVariant:"text"},{accessorKey:"secondresidentEmail",header:"Secondary Resident Email",filterVariant:"text"},{accessorKey:"secondresidentMobile",header:"Secondary Resident Mobile",filterVariant:"text"},{accessorKey:"isActive",header:"Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:i})=>i.getValue()?t.jsx(v,{label:"Active",color:"success",size:"small"}):t.jsx(v,{label:"Inactive",color:"error",size:"small"})},{header:"Actions",Cell:({row:i})=>t.jsxs(D,{display:"flex",gap:1,children:[t.jsx(u,{title:"View",children:t.jsx(C,{onClick:()=>{h(i.original),p(!0)},children:t.jsx(w,{})})}),t.jsx(u,{title:"Edit",children:t.jsx(C,{onClick:()=>{h(i.original),p(!0)},children:t.jsx(Y,{})})}),t.jsx(u,{title:"Delete",children:t.jsx(C,{color:"error",onClick:()=>x(i.original._id),children:t.jsx(Z,{})})}),t.jsx(te,{checked:i.original.isActive,onChange:()=>{y(i.original._id),M(!i.original.isActive)}})]})}],O=async()=>{f&&(await o(Q(f)),x(null))};return t.jsxs(t.Fragment,{children:[t.jsx(R,{show:!!f,type:"error",title:"Delete Resident",message:"Are you sure you want to delete this resident?",onConfirm:O,onCancel:()=>x(null)}),t.jsx(R,{show:!!S,type:"warning",title:"Change Resident Status",message:`Are you sure you want to ${T?"activate":"deactivate"} this resident?`,confirmText:T?"Activate":"Deactivate",cancelText:"Cancel",onConfirm:()=>{S&&o(J(S)),y(null)},onCancel:()=>y(null)}),A?t.jsx(ie,{society:z,editData:F,isEditMode:!!F,onCancel:()=>{p(!1),h(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(D,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:t.jsxs(se,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Society Ledger Management Module",t.jsx(u,{title:"The Society Ledger Module provides the admin with a complete financial record of all society income and expenses.",arrow:!0,children:t.jsx(ee,{sx:{color:"#245492",ml:1}})})]})}),t.jsx(X,{data:I,columns:H,rowCount:E,pageIndex:V,pageSize:d,enableColumnFilters:!0,columnFilters:k,onColumnFiltersChange:$,exportType:!0,clickHandler:q,fromDate:r,toDate:n,onFromDateChange:B,onToDateChange:L,onPaginationChange:({pageIndex:i,pageSize:s})=>{g(i),N(s),o(m({search:b,page:i,limit:s}))},onFileUpload:_})]})]})},Pe=()=>t.jsx(t.Fragment,{children:t.jsx(ae,{})});export{Pe as default};
