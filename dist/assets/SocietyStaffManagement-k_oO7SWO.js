import{r as t,c as oe,d as ne,aO as re,j as e,B as x,aP as le,aQ as ie,aR as ce,aS as de}from"./index-N8t8oMzR.js";import{F as me,C as fe,D as ue,E as he}from"./DataTable-BqUD-dAi.js";import{D as pe}from"./Delete-07TAjR17.js";import{V as ge}from"./Visibility-CgGAKN6P.js";import{C as J}from"./Close-CwR_quIe.js";import{A as xe}from"./Add-BUtQdix6.js";import{I as we}from"./Info-lyeC1xGk.js";import{S as Q}from"./SweetAlert-vzLgp13W.js";import{A as X}from"./Alert-CgNUKTJk.js";import{B as D}from"./Button-CBNcrDpD.js";import{T as Se}from"./ToggleSwitch-DR4b514_.js";import{I as P}from"./InputField-riaj6edy.js";import{T as h}from"./Typography-CKlLxaDL.js";import{I as F}from"./AlertTitle-D9ejxV9_.js";import{T as je,a as q}from"./Tabs-BUaZVZQS.js";import{T as H}from"./Tooltip-CwyNn424.js";import{D as ye,a as Ce}from"./Dialog-BGF2t3L7.js";import{C as G}from"./Chip-Dnlh_trd.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./DialogTitle-D6DEKDqS.js";import"./Divider-TBuFGUUO.js";import"./skeleton-CrFh5em0.js";const be=({onCancel:A,editData:o,isEditMode:m=!1})=>{const[d,T]=t.useState(!1),[b,w]=t.useState(null),[I,S]=t.useState(""),[K,f]=t.useState(!1),[j,U]=t.useState(0),[u,k]=t.useState({newPassword:"",changePassword:""}),[p,_]=t.useState(""),[i,v]=t.useState({role:(o==null?void 0:o.role)||"",name:(o==null?void 0:o.name)||"",phone:(o==null?void 0:o.phone)||"",email:(o==null?void 0:o.email)||"",password:"",permissions:{}}),y=oe(),g=ne(n=>n.societystaff.permissions);t.useEffect(()=>{y(re())},[y]),t.useEffect(()=>{if(!g.length)return;const n=((o==null?void 0:o.permissions)||[]).reduce((r,c)=>{const a=g.find(W=>W._id===c.permissionId);return a&&(r[a.key]=c.allowed),r},{});v(r=>({...r,permissions:g.reduce((c,a)=>(c[a.key]=a.key==="dashboard"?!0:m&&n[a.key]||!1,c),{})}))},[g,m,o]);const R=(n,r)=>{U(r)},C=n=>{const{name:r,value:c}=n.target;v(a=>({...a,[r]:c}))},L=n=>{const{name:r,value:c}=n.target,a={...u,[r]:c};a.newPassword&&a.changePassword&&a.newPassword!==a.changePassword?_("Password does not match"):_(""),k(a)},N=n=>{const{name:r,checked:c}=n.target;v(a=>({...a,permissions:{...a.permissions,[r]:c}}))},B=async n=>{if(n.preventDefault(),!d){T(!0);try{if(j===0){const r=g.filter(a=>i.permissions[a.key]).map(a=>({permissionId:a._id,allowed:!0}));let c={role:i.role,name:i.name,phone:i.phone,email:i.email,permissions:r};m||(c.password=i.password),m&&(o!=null&&o._id)?(await y(le({_id:o._id,...c})).unwrap(),w("success"),S("Society Staff updated successfully"),f(!0),setTimeout(()=>f(!1),3e3)):(await y(ie(c)).unwrap(),w("success"),S("Society Staff added successfully"),f(!0),setTimeout(()=>f(!1),3e3))}else if(j===1){const r={staffId:o._id,newPassword:u.newPassword,confirmPassword:u.changePassword};await y(ce({_id:o._id,formData:{newPassword:u.newPassword,confirmPassword:u.changePassword}})).unwrap(),w("success"),S("Password updated successfully"),f(!0),setTimeout(()=>f(!1),3e3)}f(!0),setTimeout(()=>{A()},2e3),y(de({search:"",page:0,limit:10}))}catch(r){w("error"),S("Failed: "+(r==null?void 0:r.message)),f(!0)}finally{T(!1)}setTimeout(()=>f(!1),3e3)}},z=i.role.trim()&&i.name.trim()&&i.phone.trim()&&i.email.trim()&&(m||i.password.trim())&&Object.values(i.permissions).some(n=>n),E=u.newPassword.trim()&&u.changePassword.trim();return e.jsxs(e.Fragment,{children:[K&&b&&e.jsx(X,{type:b,title:b==="success"?"Success!":b==="error"&&I.toLowerCase().includes("deleted")?"Deleted!":b==="error"?"Error!":"Warning!",message:I,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)}),e.jsxs(x,{className:"max-w-5xl mx-auto rounded-xl shadow-md mb-6",sx:{backgroundColor:"white"},children:[e.jsxs(x,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(h,{className:"font-outfit",variant:"h6",children:m?"Update Society Staff Role":"Assign Society Staff Role"}),e.jsx(F,{sx:{color:"white"},onClick:A,children:e.jsx(J,{})})]}),m&&e.jsxs(je,{value:j,onChange:R,variant:"fullWidth",children:[e.jsx(q,{className:"font-outfit",label:"Update Staff Details"}),e.jsx(q,{className:"font-outfit",label:"Change Staff Password"})]}),e.jsxs(x,{component:"form",onSubmit:B,px:6,py:4,children:[(!m||j===0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{label:"Role",name:"role",value:i.role,onChange:C}),e.jsx(P,{label:"Society Staff Name",name:"name",value:i.name,onChange:C}),e.jsx(P,{label:"Mobile Number",name:"phone",value:i.phone,onChange:C}),e.jsx(P,{label:"Email",name:"email",value:i.email,onChange:C}),!m&&e.jsx(P,{label:"Password",name:"password",type:"password",value:i.password,onChange:C})]}),e.jsx(h,{className:"font-outfit",variant:"subtitle1",mt:4,mb:2,children:"Module Permissions:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:g.filter(n=>n.key!=="dashboard"&&n.key!=="society-staff-management").map(n=>{var r;return e.jsx(me,{control:e.jsx(fe,{checked:((r=i.permissions)==null?void 0:r[n.key])||!1,onChange:N,name:n.key}),label:e.jsx("span",{className:"font-outfit",children:n.label})},n.key)})})]}),m&&j===1&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{label:"New Password",type:"password",name:"newPassword",value:u.newPassword,onChange:L}),e.jsx(P,{label:"Confirm Password",type:"password",name:"changePassword",value:u.changePassword,onChange:L,error:!!p,helperText:p})]})}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[j===0?e.jsx(D,{disabled:!z||d,children:d?m?"Updating...":"Creating...":m?"Update Society Staff":"Create Society Staff"}):e.jsx(D,{disabled:!E||d,children:d?"Updating...":"Update Password"}),e.jsx(D,{variant:"secondary",onClick:A,children:"Cancel"})]})]})]})]})},ve=[{_id:"p1",label:"Dashboard Access"},{_id:"p2",label:"Resident Management"},{_id:"p3",label:"Billing Module"}],Pe=[{_id:"1",name:"Amit Kulkarni",phone:"9876543210",email:"amit@gmail.com",role:"Treasurer",isActive:!0,createdAt:"2025-01-05T10:30:00",updatedAt:"2025-01-07T09:00:00",permissions:[{permissionId:"p1",allowed:!0},{permissionId:"p2",allowed:!0}]},{_id:"2",name:"Sneha Patil",phone:"9123456789",email:"sneha@gmail.com",role:"Resident",isActive:!1,createdAt:"2025-01-06T11:15:00",updatedAt:"2025-01-08T08:45:00",permissions:[{permissionId:"p3",allowed:!0}]}],Ae=()=>{var $;const[A,o]=t.useState(Pe),[m]=t.useState(ve),[d,T]=t.useState(null),[b,w]=t.useState(!1),[I,S]=t.useState(null),[K,f]=t.useState(null),[j,U]=t.useState(null),[u,k]=t.useState(!1),[p,_]=t.useState(null),[i,v]=t.useState(!1),[y,g]=t.useState(""),[R,C]=t.useState(null),[L,N]=t.useState(!1),[B,z]=t.useState(0),[E,n]=t.useState(10),[r,c]=t.useState([]),[a,W]=t.useState(""),[V,Y]=t.useState(""),Z=s=>{var l;return((l=m.find(M=>M._id===s))==null?void 0:l.label)||"Unknown"},O=t.useMemo(()=>A.filter(s=>{var M;const l=new Date(s.createdAt).getTime();return a&&l<new Date(a).setHours(0,0,0,0)||V&&l>new Date(V).setHours(23,59,59,999)?!1:((M=s.role)==null?void 0:M.toLowerCase())!=="admin"}),[A,a,V]),ee=()=>{o(s=>s.filter(l=>l._id!==j)),C("success"),g("Society Staff User deleted successfully."),N(!0),k(!1)},se=()=>{p&&(o(s=>s.map(l=>l._id===p._id?{...l,isActive:!l.isActive}:l)),C("success"),g(`Society Staff ${p.isActive?"deactivated":"activated"} successfully.`),N(!0),v(!1))},te=(s,l)=>{f(s),S(l),w(!0)},ae=[{accessorKey:"name",header:"Society Staff Name",filterVariant:"text"},{accessorKey:"phone",header:"Mobile No",filterVariant:"text"},{accessorKey:"email",header:"Email ID",filterVariant:"text"},{accessorKey:"role",header:"Role",filterVariant:"text"},{accessorKey:"isActive",header:"Account Status",filterVariant:"select",filterSelectOptions:["Active","Inactive"],Cell:({cell:s})=>{const l=s.getValue();return e.jsx(G,{label:l?"Active":"Inactive",color:l?"success":"error",size:"small",variant:"filled",sx:{borderRadius:"999px"}})}},{accessorKey:"createdAt",header:"Registration Date",Cell:({cell:s})=>new Date(s.getValue()).toLocaleDateString("en-IN")},{accessorKey:"updatedAt",header:"Last Login Time",Cell:({cell:s})=>new Date(s.getValue()).toLocaleString("en-IN")},{header:"Actions",Cell:({row:s})=>e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(H,{title:"View Staff Details",children:e.jsx(F,{onClick:()=>T(s.original),children:e.jsx(ge,{})})}),e.jsx(H,{title:"Edit Staff",children:e.jsx(F,{onClick:()=>te(s.original,s.index),children:e.jsx(he,{})})}),e.jsx(F,{color:"error",onClick:()=>{U(s.original._id),k(!0)},children:e.jsx(pe,{})}),e.jsx(Se,{checked:s.original.isActive,onChange:()=>{_(s.original),v(!0)}})]})}];return e.jsxs(e.Fragment,{children:[L&&R&&e.jsx(X,{type:R,title:"Success!",message:y,variant:"filled",onClose:()=>N(!1)}),b?e.jsx(be,{onCancel:()=>{w(!1),S(null)},editData:I!==null?K??void 0:void 0,isEditMode:I!==null}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(h,{variant:"h5",fontWeight:500,children:["Role & Permission Management"," ",e.jsx(H,{title:"Manage society staff",children:e.jsx(we,{sx:{color:"#245492"}})})]}),e.jsxs(D,{onClick:()=>{f(null),S(null),w(!0)},children:[e.jsx(xe,{})," Add Role"]})]}),e.jsx(ue,{data:O,columns:ae,enableColumnFilters:!0,columnFilters:r,onColumnFiltersChange:c,rowCount:O.length,pageIndex:B,pageSize:E,onPaginationChange:({pageIndex:s,pageSize:l})=>{z(s),n(l)},fromDate:a,toDate:V,onFromDateChange:W,onToDateChange:Y,exportType:!1})]}),e.jsx(ye,{open:!!d,onClose:()=>T(null),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"20px"}},children:e.jsxs(x,{className:"rounded-xl overflow-hidden",children:[e.jsxs(x,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(h,{variant:"h6",children:"Society Staff Details"}),e.jsx(F,{sx:{color:"white"},onClick:()=>T(null),children:e.jsx(J,{})})]}),e.jsx(Ce,{sx:{p:4},children:d&&e.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(h,{children:[e.jsx("strong",{children:"Role:"})," ",d.role]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Society Staff Name:"})," ",d.name]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Mobile No:"})," ",d.phone]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Email:"})," ",d.email]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Registration Date:"})," ",new Date(d.createdAt).toLocaleString("en-IN")]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Last Login Time:"})," ",new Date(d.updatedAt).toLocaleString("en-IN")]}),e.jsxs(h,{className:"col-span-2",children:[e.jsx("strong",{children:"Module Permissions:"}),e.jsx(x,{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:1,mt:1,children:($=d.permissions)==null?void 0:$.filter(s=>s.allowed).map((s,l)=>e.jsx(G,{label:Z(s.permissionId),size:"small",color:"primary"},l))})]})]})})]})}),e.jsx(Q,{show:u,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this society staff?",onConfirm:ee,onCancel:()=>k(!1)}),e.jsx(Q,{show:i,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${p!=null&&p.isActive?"deactivate":"activate"} this society staff?`,onConfirm:se,onCancel:()=>v(!1)})]})},os=()=>e.jsx(e.Fragment,{children:e.jsx(Ae,{})});export{os as default};
