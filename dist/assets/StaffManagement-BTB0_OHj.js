import{r as a,c as q,d as se,bJ as te,j as e,B as j,bK as be,bL as Te,bM as Pe,bN as v,bO as Ae,bP as ve}from"./index-N8t8oMzR.js";import{F as ke,C as Ne,D as Ie,E as Fe}from"./DataTable-BqUD-dAi.js";import{D as De}from"./Delete-07TAjR17.js";import{V as Le}from"./Visibility-CgGAKN6P.js";import{C as ae}from"./Close-CwR_quIe.js";import{S as X}from"./SweetAlert-vzLgp13W.js";import{A as re}from"./Alert-CgNUKTJk.js";import{B as H}from"./Button-CBNcrDpD.js";import{A as Me}from"./Add-BUtQdix6.js";import{I as _e}from"./Info-lyeC1xGk.js";import{T as Ee}from"./ToggleSwitch-DR4b514_.js";import{I as M}from"./InputField-riaj6edy.js";import{T as b}from"./Typography-CKlLxaDL.js";import{I as R}from"./AlertTitle-D9ejxV9_.js";import{T as Ve,a as ee}from"./Tabs-BUaZVZQS.js";import{T as Z}from"./Tooltip-CwyNn424.js";import{D as Ue,a as Ke}from"./Dialog-BGF2t3L7.js";import{C as Be}from"./Chip-Dnlh_trd.js";import"./createSvgIcon-DUEWsKfg.js";import"./Cancel-BzUm9XFt.js";import"./utils-D3TFH80g.js";import"./index-LlRZSLEd.js";import"./DateTimeField-BNev5xzk.js";import"./index-CY0vqa8Z.js";import"./useSlotProps-CaIca8GW.js";import"./CircularProgress-BJr-bAJD.js";import"./dividerClasses-D-RO7W6F.js";import"./Pagination-DjFC1aKN.js";import"./DialogTitle-D6DEKDqS.js";import"./Divider-TBuFGUUO.js";import"./skeleton-CrFh5em0.js";const Re=({onCancel:_,editData:c,isEditMode:i=!1})=>{const[P,k]=a.useState(!1),[N,S]=a.useState(null),[F,x]=a.useState(""),[W,f]=a.useState(!1),[w,$]=a.useState(0),[u,z]=a.useState({newPassword:"",changePassword:""}),[C,E]=a.useState(""),[m,V]=a.useState({name:(c==null?void 0:c.name)||"",phone:(c==null?void 0:c.phone)||"",email:(c==null?void 0:c.email)||"",password:"",permissions:{}}),y=q(),A=se(t=>t.staff.permissions);a.useEffect(()=>{y(te())},[y]),a.useEffect(()=>{if(!A.length)return;const t=((c==null?void 0:c.permissions)||[]).reduce((n,o)=>{const l=A.find(L=>L._id===o.permissionId);return l&&(n[l.key]=o.allowed),n},{});V(n=>({...n,permissions:A.reduce((o,l)=>(o[l.key]=l.key==="dashboard"?!0:i&&t[l.key]||!1,o),{})}))},[A,i,c]);const U=(t,n)=>{$(n)},I=t=>{const{name:n,value:o}=t.target;V(l=>({...l,[n]:o}))},D=t=>{const{name:n,value:o}=t.target,l={...u,[n]:o};l.newPassword&&l.changePassword&&l.newPassword!==l.changePassword?E("Password does not match"):E(""),z(l)},T=t=>{const{name:n,checked:o}=t.target;V(l=>({...l,permissions:{...l.permissions,[n]:o}}))},K=async t=>{if(t.preventDefault(),!P){k(!0);try{if(w===0){const n=A.filter(l=>m.permissions[l.key]).map(l=>({permissionId:l._id,allowed:!0}));let o={name:m.name,phone:m.phone,email:m.email,permissions:n};i||(o.password=m.password),i&&(c!=null&&c._id)?(await y(be({_id:c._id,...o})).unwrap(),S("success"),x("Staff updated successfully"),f(!0),setTimeout(()=>f(!1),3e3)):(await y(Te(o)).unwrap(),S("success"),x("Staff added successfully"),f(!0),setTimeout(()=>f(!1),3e3))}else if(w===1){const n={staffId:c._id,newPassword:u.newPassword,confirmPassword:u.changePassword};await y(Pe({_id:c._id,formData:{newPassword:u.newPassword,confirmPassword:u.changePassword}})).unwrap(),S("success"),x("Password updated successfully"),f(!0),setTimeout(()=>f(!1),3e3)}f(!0),setTimeout(()=>{_()},2e3),y(v({search:"",page:0,limit:10}))}catch(n){S("error"),x("Failed: "+(n==null?void 0:n.message)),f(!0)}finally{k(!1)}setTimeout(()=>f(!1),3e3)}},O=m.name.trim()&&m.phone.trim()&&m.email.trim()&&(i||m.password.trim())&&Object.values(m.permissions).some(t=>t),B=u.newPassword.trim()&&u.changePassword.trim();return e.jsxs(e.Fragment,{children:[W&&N&&e.jsx(re,{type:N,title:N==="success"?"Success!":N==="error"&&F.toLowerCase().includes("deleted")?"Deleted!":N==="error"?"Error!":"Warning!",message:F,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)}),e.jsxs(j,{className:"max-w-5xl mx-auto rounded-xl shadow-md mb-6",sx:{backgroundColor:"white"},children:[e.jsxs(j,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(b,{className:"font-outfit",variant:"h6",children:i?"Update Staff User":"Create Staff User"}),e.jsx(R,{sx:{color:"white"},onClick:_,children:e.jsx(ae,{})})]}),i&&e.jsxs(Ve,{value:w,onChange:U,variant:"fullWidth",children:[e.jsx(ee,{className:"font-outfit",label:"Update Staff Details"}),e.jsx(ee,{className:"font-outfit",label:"Change Staff Password"})]}),e.jsxs(j,{component:"form",onSubmit:K,px:6,py:4,children:[(!i||w===0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(M,{label:"Name",name:"name",value:m.name,onChange:I}),e.jsx(M,{label:"Mobile Number",name:"phone",value:m.phone,onChange:I}),e.jsx(M,{label:"Email",name:"email",value:m.email,onChange:I}),!i&&e.jsx(M,{label:"Password",name:"password",type:"password",value:m.password,onChange:I})]}),e.jsx(b,{className:"font-outfit",variant:"subtitle1",mt:4,mb:2,children:"Module Permissions:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:A.filter(t=>t.key!=="dashboard"&&t.key!=="staffmanagement").map(t=>{var n;return e.jsx(ke,{control:e.jsx(Ne,{checked:((n=m.permissions)==null?void 0:n[t.key])||!1,onChange:T,name:t.key}),label:e.jsx("span",{className:"font-outfit",children:t.label})},t.key)})})]}),i&&w===1&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(M,{label:"New Password",type:"password",name:"newPassword",value:u.newPassword,onChange:D}),e.jsx(M,{label:"Confirm Password",type:"password",name:"changePassword",value:u.changePassword,onChange:D,error:!!C,helperText:C})]})}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[w===0?e.jsx(H,{disabled:!O||P,children:P?i?"Updating...":"Creating...":i?"Update Staff":"Create Staff"}):e.jsx(H,{disabled:!B||P,children:P?"Updating...":"Update Password"}),e.jsx(H,{variant:"secondary",onClick:_,children:"Cancel"})]})]})]})]})},$e=()=>{var Q;const[_,c]=a.useState({id:"",name:"",phone:"",email:"",role:"",createdAt:"",updatedAt:"",permissions:[]}),[i,P]=a.useState(null),[k,N]=a.useState(""),[S,F]=a.useState(0),[x,W]=a.useState(10),[f,w]=a.useState(null),[$,u]=a.useState(""),[z,C]=a.useState(!1),[E,m]=a.useState(null),[V,y]=a.useState(!1),[A,U]=a.useState(!1),[I,D]=a.useState(null),[T,K]=a.useState(null),[O,B]=a.useState(!1),[t,n]=a.useState(""),[o,l]=a.useState(""),[L,oe]=a.useState([]),[He,We]=a.useState(""),h=q(),{staff:ne,permissions:ie,totalItems:ze}=se(s=>s.staff),J=ne.filter(s=>{var r;return((r=s.role)==null?void 0:r.toLowerCase())!=="admin"}),le=J.length;a.useEffect(()=>{const s=setTimeout(()=>{const r={};L.forEach(({id:p,value:d})=>{d&&(p==="isActive"?r[p]=d==="Active":typeof d=="string"&&d.trim()?r[p]=d.trim():r[p]=d)}),h(v({filters:r,search:k,page:S,limit:x}))},500);return()=>clearTimeout(s)},[k,S,x,L,t,o,h]),a.useEffect(()=>{const s=setTimeout(()=>{h(te())},500);return()=>clearTimeout(s)},[h]);const ce=s=>{const r=ie.find(p=>p._id===s);return r?r.label:"Unknown Permission"},Y=a.useRef(null),me=s=>{oe(s),F(0);const r={};s.forEach(({id:d,value:g})=>{g&&(d==="isActive"?r[d]=g==="Active":typeof g=="string"&&g.trim()?r[d]=g.trim():r[d]=g)});const p={filters:r,fromDate:t,toDate:o,page:0,limit:x};Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{h(v(p))},500)},de=async(s,r)=>{N(s),F(0),r&&await h(v({fromDate:t,toDate:o,search:s,exportType:r}))},fe=(s,r)=>{c(s),D(r),U(!0)},ue=s=>{P(s)},G=()=>{P(null)},pe=s=>{m(s),y(!0)},he=async()=>{if(E){try{await h(ve(E)).unwrap(),w("error"),u("Staff User deleted successfully."),C(!0),h(v({search:k,page:S,limit:x}))}catch(s){w("error"),u("Delete failed: "+s),C(!0)}setTimeout(()=>C(!1),3e3),y(!1),m(null)}},ge=()=>{y(!1),m(null)},xe=s=>{K(s),B(!0)},we=async()=>{if(T){try{await h(Ae({_id:T._id,isActive:!T.isActive})).unwrap(),w("success"),u(`Staff ${T.isActive?"deactivated":"activated"} successfully.`),C(!0),h(v({search:k,page:S,limit:x}))}catch(s){w("error"),u("Status toggle failed: "+s),C(!0)}setTimeout(()=>C(!1),3e3),B(!1),K(null)}},je=()=>{B(!1),K(null)};a.useEffect(()=>{if(t&&!o||!t&&o)return;h(v({fromDate:t||void 0,toDate:o||void 0}))},[t,o]);const Se=[{accessorKey:"name",header:"Staff Name",id:"name",filterVariant:"text"},{accessorKey:"phone",header:"Mobile No",id:"phone",filterVariant:"text"},{accessorKey:"email",header:"Email ID",id:"email",filterVariant:"text"},{accessorKey:"isActive",header:"Account Status",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({cell:s})=>s.getValue()?"Active":"Inactive",filterVariant:"select",filterSelectOptions:["Active","Inactive"]},{accessorKey:"createdAt",header:"Registration Date",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({cell:s})=>{const r=s.getValue();return new Date(r).toLocaleDateString("en-IN",{year:"numeric",month:"numeric",day:"numeric"})}},{accessorKey:"updatedAt",header:"Last Login Time",Cell:({row:s})=>{const r=new Date(s.original.updatedAt),p=r.toLocaleDateString("en-IN",{year:"numeric",month:"numeric",day:"numeric"});let d=r.getHours();const g=r.getMinutes(),Ce=d>=12?"PM":"AM";d=d%12||12;const ye=`${d}:${g.toString().padStart(2,"0")} ${Ce}`;return`${p} ${ye}`}},{header:"Actions",Cell:({row:s})=>(q(),e.jsxs(j,{display:"flex",gap:1,children:[e.jsx(Z,{title:"View Staff Details",arrow:!0,children:e.jsx(R,{color:"primary",onClick:()=>ue(s.original),children:e.jsx(Le,{})})}),e.jsx(Z,{title:"Edit Staff",arrow:!0,children:e.jsx(R,{color:"secondary",onClick:()=>fe(s.original,s.index),children:e.jsx(Fe,{})})}),e.jsx(R,{color:"error",onClick:()=>pe(s.original._id),children:e.jsx(De,{})}),e.jsx(Ee,{checked:s.original.isActive,onChange:()=>xe(s.original),tooltipTitle:s.original.isActive?"Deactivate":"Activate"})]}))}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{show:O,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${T!=null&&T.isActive?"deactivate":"activate"} this staff?`,onConfirm:we,onCancel:je,confirmText:"Yes",cancelText:"No"}),e.jsx(X,{show:V,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this staff?",onConfirm:he,onCancel:ge,confirmText:"Yes",cancelText:"No"}),z&&f&&e.jsx("div",{className:"p-4",children:e.jsx(re,{type:f,title:f==="success"?"Success!":f==="error"&&$.toLowerCase().includes("deleted")?"Deleted!":f==="error"?"Error!":"Warning!",message:$,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>C(!1)})}),A?e.jsx(Re,{onCancel:()=>{U(!1),D(null)},editData:I!==null?_:void 0,isEditMode:I!==null}):e.jsx(e.Fragment,{children:e.jsxs(j,{children:[e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(j,{ml:2,children:e.jsxs(b,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Staff Management ",e.jsx(Z,{title:"Create staff accounts, assign and update module permissions, and manage staff login credentials.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.8rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(_e,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:s=>s.stopPropagation()})})]})}),e.jsxs(H,{onClick:()=>{c({id:"",name:"",phone:"",email:"",role:"",createdAt:"",updatedAt:"",permissions:[]}),D(null),U(!0)},children:[e.jsx(Me,{})," Add Staff"]})]}),e.jsx(Ie,{exportType:!0,clickHandler:de,data:J,columns:Se,enableColumnFilters:!0,columnFilters:L,onColumnFiltersChange:me,rowCount:le,pageIndex:S,pageSize:x,onPaginationChange:({pageIndex:s,pageSize:r})=>{F(s),W(r);const p={};L.forEach(({id:d,value:g})=>{g&&(p[d]=d==="isActive"?g==="Active":g)}),h(v({filters:p,fromDate:t,toDate:o,page:s,limit:r}))},fromDate:t,toDate:o,onFromDateChange:n,onToDateChange:l}),e.jsx(Ue,{open:!!i,onClose:G,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"20px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(j,{className:"rounded-xl overflow-hidden",children:[e.jsxs(j,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(b,{className:"font-outfit",variant:"h6",children:"Staff Details"}),e.jsx(R,{sx:{color:"white"},onClick:G,children:e.jsx(ae,{})})]}),e.jsx(Ke,{sx:{p:4},children:i&&e.jsxs(j,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Name:"})," ",i.name]}),e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Mobile No:"})," ",i.phone]}),e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Email:"})," ",i.email]}),e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Registration Date:"})," ",new Date(i.createdAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Last Login Time:"})," ",new Date(i.updatedAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),e.jsxs(b,{className:"font-outfit text-sm",children:[e.jsx("strong",{children:"Module Permissions:"}),e.jsx(j,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,mt:1,children:(Q=i==null?void 0:i.permissions)==null?void 0:Q.filter(s=>s.allowed).map((s,r)=>e.jsx(Be,{className:"font-outfit",label:ce(s.permissionId),color:"primary",size:"small"},r))})]})]})})]})})]})})]})},bs=()=>e.jsx(e.Fragment,{children:e.jsx($e,{})});export{bs as default};
