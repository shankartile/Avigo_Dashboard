import{r as t,c as ae,d as ne,y as oe,j as e,B as x,z as re,A as le,C as ie,D as ce}from"./index-CNh2Ysd7.js";import{F as de,C as me,D as ue,E as fe}from"./DataTable-CBDiE-I1.js";import{D as he}from"./Delete-BKL8mfiA.js";import{V as pe}from"./Visibility-CFK2wX7e.js";import{C as J}from"./Close-CSWdanUp.js";import{A as ge}from"./Add-ONoAddvh.js";import{I as xe}from"./Info-BLOe8JuO.js";import{S as q}from"./SweetAlert-DUVT9XWx.js";import{A as Q}from"./Alert-BBsTbpkb.js";import{B as V}from"./Button-D2SEshHa.js";import{T as we}from"./ToggleSwitch-CRLgVpk1.js";import{I as v}from"./InputField-Cac7SuVh.js";import{T as h}from"./Typography-DxP0RQcB.js";import{I as F}from"./AlertTitle-BBXxFqxI.js";import{T as Se,a as G}from"./Tabs-DWd8sdsH.js";import{T as H}from"./Tooltip-B4POfKz-.js";import{D as je,a as ye}from"./Dialog-CMeqEyOr.js";import{C as Ce}from"./Chip--RBU-Z22.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./DialogTitle-sP3uGIgc.js";import"./Divider-1omdH51K.js";import"./skeleton-H-TAVWvB.js";const be=({onCancel:P,editData:n,isEditMode:m=!1})=>{const[d,T]=t.useState(!1),[b,w]=t.useState(null),[I,S]=t.useState(""),[D,u]=t.useState(!1),[j,K]=t.useState(0),[f,k]=t.useState({newPassword:"",changePassword:""}),[p,_]=t.useState(""),[l,A]=t.useState({role:(n==null?void 0:n.role)||"",name:(n==null?void 0:n.name)||"",phone:(n==null?void 0:n.phone)||"",email:(n==null?void 0:n.email)||"",password:"",permissions:{}}),y=ae(),g=ne(o=>o.societystaff.permissions);t.useEffect(()=>{y(oe())},[y]),t.useEffect(()=>{if(!g.length)return;const o=((n==null?void 0:n.permissions)||[]).reduce((r,c)=>{const a=g.find(W=>W._id===c.permissionId);return a&&(r[a.key]=c.allowed),r},{});A(r=>({...r,permissions:g.reduce((c,a)=>(c[a.key]=a.key==="dashboard"?!0:m&&o[a.key]||!1,c),{})}))},[g,m,n]);const L=(o,r)=>{K(r)},C=o=>{const{name:r,value:c}=o.target;A(a=>({...a,[r]:c}))},R=o=>{const{name:r,value:c}=o.target,a={...f,[r]:c};a.newPassword&&a.changePassword&&a.newPassword!==a.changePassword?_("Password does not match"):_(""),k(a)},N=o=>{const{name:r,checked:c}=o.target;A(a=>({...a,permissions:{...a.permissions,[r]:c}}))},B=async o=>{if(o.preventDefault(),!d){T(!0);try{if(j===0){const r=g.filter(a=>l.permissions[a.key]).map(a=>({permissionId:a._id,allowed:!0}));let c={role:l.role,name:l.name,phone:l.phone,email:l.email,permissions:r};m||(c.password=l.password),m&&(n!=null&&n._id)?(await y(re({_id:n._id,...c})).unwrap(),w("success"),S("Society Staff updated successfully"),u(!0),setTimeout(()=>u(!1),3e3)):(await y(le(c)).unwrap(),w("success"),S("Society Staff added successfully"),u(!0),setTimeout(()=>u(!1),3e3))}else if(j===1){const r={staffId:n._id,newPassword:f.newPassword,confirmPassword:f.changePassword};await y(ie({_id:n._id,formData:{newPassword:f.newPassword,confirmPassword:f.changePassword}})).unwrap(),w("success"),S("Password updated successfully"),u(!0),setTimeout(()=>u(!1),3e3)}u(!0),setTimeout(()=>{P()},2e3),y(ce({search:"",page:0,limit:10}))}catch(r){w("error"),S("Failed: "+(r==null?void 0:r.message)),u(!0)}finally{T(!1)}setTimeout(()=>u(!1),3e3)}},z=l.role.trim()&&l.name.trim()&&l.phone.trim()&&l.email.trim()&&(m||l.password.trim())&&Object.values(l.permissions).some(o=>o),E=f.newPassword.trim()&&f.changePassword.trim();return e.jsxs(e.Fragment,{children:[D&&b&&e.jsx(Q,{type:b,title:b==="success"?"Success!":b==="error"&&I.toLowerCase().includes("deleted")?"Deleted!":b==="error"?"Error!":"Warning!",message:I,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>u(!1)}),e.jsxs(x,{className:"max-w-5xl mx-auto rounded-xl shadow-md mb-6",sx:{backgroundColor:"white"},children:[e.jsxs(x,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",borderTopLeftRadius:12,borderTopRightRadius:12,color:"white"},children:[e.jsx(h,{className:"font-outfit",variant:"h6",children:m?"Update Society User Role":"Assign Society User Role"}),e.jsx(F,{sx:{color:"white"},onClick:P,children:e.jsx(J,{})})]}),m&&e.jsxs(Se,{value:j,onChange:L,variant:"fullWidth",children:[e.jsx(G,{className:"font-outfit",label:"Update User Details"}),e.jsx(G,{className:"font-outfit",label:"Change User Password"})]}),e.jsxs(x,{component:"form",onSubmit:B,px:6,py:4,children:[(!m||j===0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(v,{label:"Role",name:"role",value:l.role,onChange:C}),e.jsx(v,{label:"Society User Name",name:"name",value:l.name,onChange:C}),e.jsx(v,{label:"Mobile Number",name:"phone",value:l.phone,onChange:C}),e.jsx(v,{label:"Email",name:"email",value:l.email,onChange:C}),!m&&e.jsx(v,{label:"Password",name:"password",type:"password",value:l.password,onChange:C})]}),e.jsx(h,{className:"font-outfit",variant:"subtitle1",mt:4,mb:2,children:"Module Permissions:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:g.filter(o=>o.key!=="dashboard"&&o.key!=="society-staff-management").map(o=>{var r;return e.jsx(de,{control:e.jsx(me,{checked:((r=l.permissions)==null?void 0:r[o.key])||!1,onChange:N,name:o.key}),label:e.jsx("span",{className:"font-outfit",children:o.label})},o.key)})})]}),m&&j===1&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(v,{label:"New Password",type:"password",name:"newPassword",value:f.newPassword,onChange:R}),e.jsx(v,{label:"Confirm Password",type:"password",name:"changePassword",value:f.changePassword,onChange:R,error:!!p,helperText:p})]})}),e.jsxs("div",{className:"flex justify-center gap-6 mt-6",children:[j===0?e.jsx(V,{disabled:!z||d,children:d?m?"Updating...":"Creating...":m?"Update Society User":"Create Society User"}):e.jsx(V,{disabled:!E||d,children:d?"Updating...":"Update Password"}),e.jsx(V,{variant:"secondary",onClick:P,children:"Cancel"})]})]})]})]})},Ae=[{_id:"p1",label:"Dashboard Access"},{_id:"p2",label:"Resident Management"},{_id:"p3",label:"Billing Module"}],ve=[{_id:"1",name:"Amit Kulkarni",phone:"9876543210",email:"amit@gmail.com",role:"Treasurer",isActive:!0,createdAt:"2025-01-05T10:30:00",updatedAt:"2025-01-07T09:00:00",permissions:[{permissionId:"p1",allowed:!0},{permissionId:"p2",allowed:!0}]},{_id:"2",name:"Sneha Patil",phone:"9123456789",email:"sneha@gmail.com",role:"Resident",isActive:!1,createdAt:"2025-01-06T11:15:00",updatedAt:"2025-01-08T08:45:00",permissions:[{permissionId:"p3",allowed:!0}]}],Pe=()=>{var $;const[P,n]=t.useState(ve),[m]=t.useState(Ae),[d,T]=t.useState(null),[b,w]=t.useState(!1),[I,S]=t.useState(null),[D,u]=t.useState(null),[j,K]=t.useState(null),[f,k]=t.useState(!1),[p,_]=t.useState(null),[l,A]=t.useState(!1),[y,g]=t.useState(""),[L,C]=t.useState(null),[R,N]=t.useState(!1),[B,z]=t.useState(0),[E,o]=t.useState(10),[r,c]=t.useState([]),[a,W]=t.useState(""),[U,X]=t.useState(""),Y=s=>{var i;return((i=m.find(M=>M._id===s))==null?void 0:i.label)||"Unknown"},O=t.useMemo(()=>P.filter(s=>{var M;const i=new Date(s.createdAt).getTime();return a&&i<new Date(a).setHours(0,0,0,0)||U&&i>new Date(U).setHours(23,59,59,999)?!1:((M=s.role)==null?void 0:M.toLowerCase())!=="admin"}),[P,a,U]),Z=()=>{n(s=>s.filter(i=>i._id!==j)),C("success"),g("Society Staff User deleted successfully."),N(!0),k(!1)},ee=()=>{p&&(n(s=>s.map(i=>i._id===p._id?{...i,isActive:!i.isActive}:i)),C("success"),g(`Society Staff ${p.isActive?"deactivated":"activated"} successfully.`),N(!0),A(!1))},se=(s,i)=>{u(s),S(i),w(!0)},te=[{accessorKey:"name",header:"Society User Name",filterVariant:"text"},{accessorKey:"phone",header:"Mobile No",filterVariant:"text"},{accessorKey:"email",header:"Email ID",filterVariant:"text"},{accessorKey:"role",header:"Role",filterVariant:"text"},{accessorKey:"isActive",header:"Account Status",Cell:({cell:s})=>s.getValue()?"Active":"Inactive",filterVariant:"select",filterSelectOptions:["Active","Inactive"]},{accessorKey:"createdAt",header:"Registration Date",Cell:({cell:s})=>new Date(s.getValue()).toLocaleDateString("en-IN")},{accessorKey:"updatedAt",header:"Last Login Time",Cell:({cell:s})=>new Date(s.getValue()).toLocaleString("en-IN")},{header:"Actions",Cell:({row:s})=>e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(H,{title:"View Staff Details",children:e.jsx(F,{onClick:()=>T(s.original),children:e.jsx(pe,{})})}),e.jsx(H,{title:"Edit Staff",children:e.jsx(F,{onClick:()=>se(s.original,s.index),children:e.jsx(fe,{})})}),e.jsx(F,{color:"error",onClick:()=>{K(s.original._id),k(!0)},children:e.jsx(he,{})}),e.jsx(we,{checked:s.original.isActive,onChange:()=>{_(s.original),A(!0)}})]})}];return e.jsxs(e.Fragment,{children:[R&&L&&e.jsx(Q,{type:L,title:"Success!",message:y,variant:"filled",onClose:()=>N(!1)}),b?e.jsx(be,{onCancel:()=>{w(!1),S(null)},editData:I!==null?D??void 0:void 0,isEditMode:I!==null}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(h,{variant:"h5",fontWeight:500,children:["Role-Based Access Management Module"," ",e.jsx(H,{title:"Manage society staff",children:e.jsx(xe,{sx:{color:"#245492"}})})]}),e.jsxs(V,{onClick:()=>{u(null),S(null),w(!0)},children:[e.jsx(ge,{})," Add Role"]})]}),e.jsx(ue,{data:O,columns:te,enableColumnFilters:!0,columnFilters:r,onColumnFiltersChange:c,rowCount:O.length,pageIndex:B,pageSize:E,onPaginationChange:({pageIndex:s,pageSize:i})=>{z(s),o(i)},fromDate:a,toDate:U,onFromDateChange:W,onToDateChange:X,exportType:!1})]}),e.jsx(je,{open:!!d,onClose:()=>T(null),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"20px"}},children:e.jsxs(x,{className:"rounded-xl overflow-hidden",children:[e.jsxs(x,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(h,{variant:"h6",children:"Society Staff Details"}),e.jsx(F,{sx:{color:"white"},onClick:()=>T(null),children:e.jsx(J,{})})]}),e.jsx(ye,{sx:{p:4},children:d&&e.jsxs(x,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(h,{children:[e.jsx("strong",{children:"Role:"})," ",d.role]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Society Staff Name:"})," ",d.name]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Mobile No:"})," ",d.phone]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Email:"})," ",d.email]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Registration Date:"})," ",new Date(d.createdAt).toLocaleString("en-IN")]}),e.jsxs(h,{children:[e.jsx("strong",{children:"Last Login Time:"})," ",new Date(d.updatedAt).toLocaleString("en-IN")]}),e.jsxs(h,{className:"col-span-2",children:[e.jsx("strong",{children:"Module Permissions:"}),e.jsx(x,{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:1,mt:1,children:($=d.permissions)==null?void 0:$.filter(s=>s.allowed).map((s,i)=>e.jsx(Ce,{label:Y(s.permissionId),size:"small"},i))})]})]})})]})}),e.jsx(q,{show:f,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this society staff?",onConfirm:Z,onCancel:()=>k(!1)}),e.jsx(q,{show:l,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${p!=null&&p.isActive?"deactivate":"activate"} this society staff?`,onConfirm:ee,onCancel:()=>A(!1)})]})},ns=()=>e.jsx(e.Fragment,{children:e.jsx(Pe,{})});export{ns as default};
