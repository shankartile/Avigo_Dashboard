import{r as s,a as ne,c as H,d as y,eS as ce,eT as de,dO as b,j as e,B as d,eU as ue,eV as pe}from"./index-CcNgdVLz.js";import{I as me}from"./Info-BLwzYq-V.js";import{V as ge}from"./Visibility-Bad1pPYX.js";import{C as L}from"./Close-eApB0hKv.js";import{D as fe}from"./DataTable-DIxG5frN.js";import{A as he}from"./Alert-U3gIVFWt.js";import{S as z}from"./SweetAlert-BfCzCAJa.js";import{D as V,a as xe}from"./Dialog-BdfS6Lfy.js";import{D as ye}from"./DialogTitle-BbPUlM9A.js";import{I as S}from"./AlertTitle-C4QpKbd8.js";import{T as u}from"./Typography-BMOygWke.js";import{T as K}from"./Tooltip-C-v54PpA.js";import{C as be}from"./Chip-YFG14ne-.js";import"./createSvgIcon-ClJPFlmG.js";import"./Cancel-CkCQy-6N.js";import"./utils-BtYGnpaM.js";import"./index-CLpR2HuM.js";import"./DateTimeField-CYfYG2Su.js";import"./index-D3LyqDt4.js";import"./useSlotProps-z1QAC-gu.js";import"./CircularProgress-CVM8C023.js";import"./dividerClasses-Bv38dMpn.js";import"./Pagination-DR3bn4wR.js";import"./Divider-BePmc644.js";import"./Tabs-CWf6flOX.js";import"./skeleton-DjwwWlQi.js";import"./Button-B4_V5GRV.js";const Se=()=>{var k,M,B,F,E;const[W,O]=s.useState(!1),[i,Ce]=s.useState({_id:"",title:"",category_id:"",category:"",listings_allowed:"",validity_in_days:"",price:"",description:"",basePlanId:"",productId:"",plan_name:""}),[r,$]=s.useState(null),[je,Te]=s.useState(null),[m,f]=s.useState(null),[C,h]=s.useState(""),[R,a]=s.useState(!1),[we,Pe]=s.useState({title:"",category_id:"",category:"",listings_allowed:0,validity_in_days:0,price:0,basePlanId:"",productId:"",plan_name:"",description:""}),[Y,j]=s.useState(!1),[T,w]=s.useState(null),[Z,P]=s.useState(!1),[p,Q]=s.useState(""),[o,I]=s.useState(0),[l,U]=s.useState(10),[n,_]=s.useState(null),[q,v]=s.useState(!1),[Ie,_e]=s.useState(!1),[x,ve]=s.useState(null),[D,De]=s.useState(0),[A,Ae]=s.useState(10),[Ne,ke]=s.useState(!1),G=ne(),c=H(),{CategoryMaster:J=[]}=y(t=>t.CategoryMaster);J.filter(t=>t.isActive);const{dealerList:Me=[],dealerTotalItems:Be=0}=y(t=>t.Subscription);s.useEffect(()=>{x&&c(ce({subscriptionId:x,page:D,limit:A}))},[x,D,A]),s.useEffect(()=>{const t=setTimeout(()=>{c(de({search:p,page:o,limit:l}))},500);return()=>clearTimeout(t)},[p,o,l]),s.useEffect(()=>{const t=setTimeout(()=>{c(b({search:p,page:o,limit:l}))},500);return()=>clearTimeout(t)},[p,o,l]);const{SubscriptionList:X,totalItems:ee}=y(t=>t.Subscription),te=()=>/[a-zA-Z]/.test(i.description)&&i.description.trim().length>=10;!((k=i.title)!=null&&k.trim())||!((M=i.category_id)!=null&&M.trim())||!((B=i.listings_allowed)!=null&&B.trim())||!((F=i.validity_in_days)!=null&&F.trim())||!te()||(E=i.price)!=null&&E.trim();const se=async()=>{if(T){try{await c(pe(T)).unwrap(),f("error"),h("Subscription deleted successfully."),a(!0),setTimeout(()=>{a(!1)},3e3),c(b({search:p,page:o,limit:l}))}catch(t){f("error"),h("Delete failed: "+t),a(!0),setTimeout(()=>a(!1),3e3)}j(!1),w(null)}},ae=()=>{j(!1),w(null)},ie=async()=>{if(n){try{await c(ue({_id:n._id,isActive:!n.isActive})).unwrap(),f("success"),h(`Subscription ${n.isActive?"deactivated":"activated"} successfully.`),a(!0),c(b({search:p,page:o,limit:l}))}catch(t){f("error"),h("Status toggle failed: "+t),a(!0)}setTimeout(()=>a(!1),3e3),v(!1),_(null)}},re=()=>{v(!1),_(null)},N=()=>{$(null),O(!1)},oe=t=>{Q(t),I(0)},le=[{accessorKey:"plan_name",header:"Plan Name",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{accessorKey:"google_product_id",header:"Category Name",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{header:"Price (₹)",accessorFn:t=>t.price??0,Cell:({cell:t})=>`₹${t.getValue()}`,muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{accessorKey:"listings_allowed",header:"Listings Allowed",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{accessorKey:"validity_in_days",header:"Validity In Days",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{accessorKey:"dealerPurchaseCount",header:"Total Subscribers",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({cell:t})=>e.jsx(d,{display:"flex",justifyContent:"center",children:e.jsx(be,{className:"font-outfit",label:t.getValue(),color:"primary",size:"medium",sx:{fontWeight:500}})})},{accessorKey:"createdAt",header:"Registration Date",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({cell:t})=>{const g=t.getValue();return new Date(g).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}},{header:"Actions",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({row:t})=>{H();const g=t.original;return e.jsx(d,{display:"flex",justifyContent:"center",gap:1,children:e.jsx(K,{title:"Click to view subscribed users",children:e.jsx(S,{color:"primary",onClick:()=>G(`${g._id}/dealers`),children:e.jsx(ge,{})})})})}}];return e.jsxs(e.Fragment,{children:[e.jsx(V,{open:Z,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,disableEnforceFocus:!0,children:e.jsxs(ye,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Preview",e.jsx(S,{onClick:()=>P(!1),sx:{color:"black"},children:e.jsx(L,{})})]})}),e.jsx(z,{show:q,type:"warning",title:"Confirm Status Change",message:`Are you sure you want to ${n!=null&&n.isActive?"deactivate":"activate"} this subscription?`,onConfirm:ie,onCancel:re,confirmText:"Yes",cancelText:"No"}),e.jsx(z,{show:Y,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this subscription?",onConfirm:se,onCancel:ae,confirmText:"Yes",cancelText:"No"}),R&&m&&e.jsx("div",{className:"p-4",children:e.jsx(he,{type:m,title:m==="success"?"Success!":m==="error"&&C.toLowerCase().includes("deleted")?"Deleted!":m==="error"?"Error!":"Warning!",message:C,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>a(!1)})}),W?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(d,{ml:2,children:e.jsxs(u,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Subscription Management  ",e.jsx(K,{title:"Create and manage subscription plans for car, bike, and spare part categories.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:e.jsx(me,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})})}),e.jsx(fe,{clickHandler:oe,data:X,columns:le,rowCount:ee,pageIndex:o,pageSize:l,onPaginationChange:({pageIndex:t,pageSize:g})=>{I(t),U(g)}})]}),e.jsx(V,{open:!!r,onClose:N,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:e.jsxs(d,{className:"rounded-xl overflow-hidden",children:[e.jsxs(d,{sx:{background:"linear-gradient( #255593 103.05%)",height:60,px:4,display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:[e.jsx(u,{className:"font-outfit",variant:"h6",children:"Subscription Details"}),e.jsx(S,{sx:{color:"white"},onClick:N,children:e.jsx(L,{})})]}),e.jsx(xe,{sx:{pb:4},children:r&&e.jsxs(d,{className:"grid grid-cols-2 gap-4",children:[e.jsxs(u,{className:"font-outfit",children:[e.jsx("strong",{children:"Plan Name:"})," ",r.plan_name]}),e.jsxs(u,{className:"font-outfit",children:[e.jsx("strong",{children:"Category:"})," ",r.category]}),e.jsxs(u,{className:"font-outfit",children:[e.jsx("strong",{children:"Listings Allowed:"})," ",r.listings_allowed]}),e.jsxs(u,{className:"font-outfit",children:[e.jsx("strong",{children:"Validity In Days:"})," ",r.validity_in_days]}),e.jsxs(u,{className:"font-outfit",children:[e.jsx("strong",{children:"Price:"})," ",r.price]})]})})]})})]})},nt=()=>e.jsx(e.Fragment,{children:e.jsx(Se,{})});export{nt as default};
