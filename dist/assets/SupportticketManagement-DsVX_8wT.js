import{r as a,E as ae,c as oe,a as ie,d as ne,d_ as d,j as r,B as h,d$ as le}from"./index-CNh2Ysd7.js";import{I as ce}from"./Info-BLOe8JuO.js";import{V as ue}from"./Visibility-CFK2wX7e.js";import{C as pe}from"./Close-CSWdanUp.js";import{I as w}from"./InputField-Cac7SuVh.js";import{D as de}from"./DataTable-CBDiE-I1.js";import{A as R}from"./Alert-BBsTbpkb.js";import{S as me}from"./SweetAlert-DUVT9XWx.js";import{C as fe}from"./Chip--RBU-Z22.js";import{T as V}from"./Tooltip-B4POfKz-.js";import{I as K}from"./AlertTitle-BBXxFqxI.js";import{T as he}from"./Typography-DxP0RQcB.js";import{D as ge,a as ye}from"./Dialog-CMeqEyOr.js";import{D as xe}from"./DialogTitle-sP3uGIgc.js";import"./createSvgIcon-BgVIxfXN.js";import"./Cancel-BLeHB2Qp.js";import"./utils-lR4eRFL7.js";import"./index-5igkt3_T.js";import"./DateTimeField-BSuPXSWe.js";import"./index-BfVZHwAX.js";import"./useSlotProps-Dx6fg7Ph.js";import"./CircularProgress-B1SplcgD.js";import"./dividerClasses-BGxOqTuw.js";import"./Pagination-C_Nq6nsY.js";import"./Divider-1omdH51K.js";import"./Tabs-DWd8sdsH.js";import"./skeleton-H-TAVWvB.js";import"./Button-D2SEshHa.js";const Se=()=>{const[j,U]=a.useState({userId:"",userType:"",subject:"",description:"",attachments:[]}),[Ce,je]=a.useState(null),[be,Te]=a.useState("open"),[we,ke]=a.useState(""),[De,Ie]=a.useState(null),[Fe,Pe]=a.useState(""),[i,k]=a.useState("dealer"),[B,Ae]=a.useState(null),[l,D]=a.useState(null),[g,I]=a.useState(""),[F,f]=a.useState(!1),[P,A]=a.useState(!1),[v,N]=a.useState(null),[z,E]=a.useState(!1),[y,H]=a.useState(""),[x,S]=a.useState(0),[m,W]=a.useState(10),[c,$]=a.useState(""),[u,O]=a.useState(""),[C,Z]=a.useState([]),[ve,Ne]=a.useState(""),[Ee,_]=a.useState(!1),[M,q]=ae(),p=oe(),Y=ie(),{supportticket:G,totalItems:J,totalPages:Me}=ne(t=>t.supportticket);a.useEffect(()=>{const t=setTimeout(()=>{const e={};C.forEach(({id:s,value:o})=>{o&&(s==="isActive"?e[s]=o==="Active":typeof o=="string"&&o.trim()?e[s]=o.trim():e[s]=o)}),p(d({filters:e,search:y,page:x,limit:m,type:i}))},500);return()=>clearTimeout(t)},[y,x,m,i,C,c,u]),a.useEffect(()=>{const t=M.get("type");(t==="dealer"||t==="buyer")&&t!==i&&k(t),_(!0)},[]);const b=a.useRef(null),Q=t=>{Z(t),S(0);const e={};t.forEach(({id:o,value:n})=>{n&&(o==="isActive"?e[o]=n==="Active":typeof n=="string"&&n.trim()?e[o]=n.trim():e[o]=n)});const s={type:i,filters:e,fromDate:c,toDate:u,page:0,limit:m};b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{p(d(s))},500)},T=t=>{const{name:e,value:s}=t.target;U(o=>({...o,[e]:e.includes("percentage")?s.replace(/[^0-9.]/g,""):s}))},X=async()=>{if(v){try{await p(le(v)).unwrap(),D("error"),I("Ticket deleted successfully."),f(!0),setTimeout(()=>f(!1),3e3),p(d({search:y,page:x,limit:m}))}catch(t){D("error"),I("Delete failed: "+t),f(!0),setTimeout(()=>f(!1),3e3)}E(!1),N(null)}},ee=()=>{E(!1),N(null)},te=t=>{const s=sessionStorage.getItem("activeRole")==="staff"?"staff":"superadmin";Y(`/${s}/supportticketmanagement/${t._id}?userType=${t.userType}`)},se=async(t,e)=>{H(t),S(0),e?(await p(d({fromDate:c,toDate:u,search:t,type:i,exportType:e})),await p(d({fromDate:c,toDate:u,search:t,page:0,limit:m,type:i}))):await p(d({search:t,page:0,limit:m,type:i}))};a.useEffect(()=>{if(c&&!u||!c&&u)return;p(d({fromDate:c||void 0,toDate:u||void 0,type:i}))},[c,u]);const L=(t,e=50)=>t?t.length>e?t.slice(0,e)+"...":t:"",re=a.useMemo(()=>{const t=[{accessorKey:"userType",header:"Submitted by",filterVariant:"text"},{accessorFn:e=>{var s;return((s=e.userId)==null?void 0:s.name)||"N/A"},id:"userName",header:"User Name",filterVariant:"text"}];return i==="dealer"?t.push({accessorFn:e=>{var s;return((s=e.userId)==null?void 0:s.email)||"N/A"},id:"userEmail",header:"Email",filterVariant:"text"}):i==="buyer"&&t.push({accessorFn:e=>{var s;return((s=e.userId)==null?void 0:s.phone)||"N/A"},id:"userPhone",header:"Mobile No",filterVariant:"text"}),t.push({accessorKey:"subject",header:"Subject",filterVariant:"text",Cell:({row:e})=>L(e.original.subject,30),muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"}},{accessorKey:"description",header:"Description",filterVariant:"text",Cell:({row:e})=>L(e.original.description,30)},{accessorKey:"createdAt",header:"Ticket Date",Cell:({cell:e})=>{const s=e.getValue();return s?new Date(s).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"}):""}},{accessorKey:"updatedAt",header:"Last Updated",Cell:({cell:e})=>{const s=e.getValue();return s?new Date(s).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"}):""}},{accessorKey:"status",header:"Status",muiTableHeadCellProps:{align:"center"},muiTableBodyCellProps:{align:"center"},Cell:({row:e})=>{const s=String(e.original.status||"").toLowerCase();let o="error";return s==="resolved"?o="success":s==="in progress"?o="warning":s==="open"&&(o="error"),r.jsx(h,{display:"flex",justifyContent:"center",children:r.jsx(fe,{className:"font-outfit",label:e.original.status||"",color:o,size:"small",variant:"outlined"})})},filterVariant:"select",filterSelectOptions:["Resolved","In Progress","Open"],filterFn:(e,s,o)=>String(e.getValue(s)??"").toLowerCase()===(o==null?void 0:o.toLowerCase())},{header:"Actions",Cell:({row:e})=>r.jsx(h,{display:"flex",children:r.jsx(V,{title:"View Details",arrow:!0,children:r.jsx(K,{color:"primary",onClick:()=>te(e.original),children:r.jsx(ue,{})})})})}),t},[i]);return r.jsxs(r.Fragment,{children:[r.jsx(me,{show:z,type:"error",title:"Confirm Deletion",message:"Are you sure you want to delete this coupon?",onConfirm:X,onCancel:ee,confirmText:"Yes",cancelText:"No"}),F&&l&&r.jsx("div",{className:"p-4",children:r.jsx(R,{type:l,title:l==="success"?"Success!":l==="error"&&g.toLowerCase().includes("deleted")?"Deleted!":l==="error"?"Error!":"Warning!",message:g,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)})}),P?r.jsxs(ge,{open:P,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"25px"}},BackdropProps:{sx:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}},children:[r.jsxs(h,{sx:{background:"linear-gradient( #255593 103.05%)",height:25,p:4,position:"relative"},children:[r.jsx(xe,{className:"font-outfit",sx:{color:"white",position:"absolute",top:5},children:B!==null?"Edit Coupon":"Add Coupon"}),r.jsx(K,{sx:{position:"absolute",top:12,right:12},onClick:()=>A(!1),children:r.jsx(pe,{})})]}),r.jsxs(ye,{children:[F&&l&&r.jsx("div",{className:"mb-4",children:r.jsx(R,{type:l,title:l==="success"?"Success!":l==="error"&&g.toLowerCase().includes("deleted")?"Deleted!":l==="error"?"Error!":"Warning!",message:g,variant:"filled",showLink:!1,linkHref:"",linkText:"",onClose:()=>f(!1)})}),r.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(w,{label:"User type",name:"userType",value:j.userType,onChange:T}),r.jsx(w,{label:"Subject",name:"subject",value:j.subject,onChange:T}),r.jsx(w,{label:"Description",name:"description",value:j.description,onChange:T})]})]})]}):r.jsxs(r.Fragment,{children:[r.jsx(h,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:r.jsx(h,{ml:2,children:r.jsxs(he,{variant:"h5",fontWeight:500,className:"font-outfit",children:["Support Ticket Management  ",r.jsx(V,{title:"Manage support tickets raised by dealers and buyers, address their queries, and resolve reported issues.",arrow:!0,slotProps:{popper:{sx:{"& .MuiTooltip-tooltip":{fontSize:"0.9rem",backgroundColor:"#245492",color:"#fff",fontFamily:"Outfit",padding:"8px 12px"},"& .MuiTooltip-arrow":{color:"#245492"}}}},children:r.jsx(ce,{fontSize:"medium",sx:{color:"#245492",cursor:"pointer"},onClick:t=>t.stopPropagation()})})]})})}),r.jsx(de,{columns:re,exportType:!0,clickHandler:se,data:G,enableColumnFilters:!0,columnFilters:C,onColumnFiltersChange:Q,rowCount:J,enableUserTypeFilter:!0,productTypeValue:i,onUserTypeChange:t=>{k(t),S(0);const e=new URLSearchParams(M);e.set("type",t.toLowerCase()),q(e),p(d({search:y,type:t,page:0,limit:m}))},pageIndex:x,pageSize:m,onPaginationChange:({pageIndex:t,pageSize:e})=>{S(t),W(e);const s={};C.forEach(({id:o,value:n})=>{n&&(s[o]=o==="isActive"?n==="Active":n)}),p(d({filters:s,fromDate:c,toDate:u,page:t,limit:e}))},fromDate:c,toDate:u,onFromDateChange:$,onToDateChange:O},i)]})]})},ct=()=>r.jsx(r.Fragment,{children:r.jsx(Se,{})});export{ct as default};
